<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../polymer/lib/utils/debounce.html"><link rel="import" href="../polymer/lib/utils/flattened-nodes-observer.html"><link rel="import" href="../polymer-vis/polymer-vis.html"></head><body><dom-module id="vega-element"><template><style>:host{display:block;}</style><div id="vegaElement"></div><slot id="slot"></slot></template><script>var VegaElement=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'ready',value:function(){var a=this;if(babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),this._vegaReady=window.vega,!window.d3&&!window.vega)return void PolymerVis.loadScript(this.vegaSrc,function(){if(a._vegaReady=window.vega&&!0,'3'!==window.vega.version[0])throw new Error('vega version must be at least 3.0.0')});if(window.d3&&!window.vega){if('4'!==window.d3.version[0])throw new Error('d3 version must be at least 4.0.0');PolymerVis.loadScript(this.vegaCorSrc,function(){if(a._vegaReady=window.vega&&!0,'3'!==window.vega.version[0])throw new Error('vega version must be at least 3.0.0')})}}},{key:'connectedCallback',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'connectedCallback',this).call(this),this._connected=!0,this._observeSlot()}},{key:'disconnectedCallback',value:function(){this._connected=!1,this._observer&&this._observer.disconnect()}},{key:'run',value:function(a){if(this.view)return this.view=this.view.run(a||this.customEncode),this.rendered=!0,this.view}},{key:'parse',value:function(a,b){if(this._vegaReady&&a)try{return vega.parse(a,b)}catch(a){this.dispatchEvent(new CustomEvent('error',{detail:a})),console.warn(a)}}},{key:'compile',value:function(){var a=this,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'none';return this.vegaLiteSpec?new Promise(function(c,d){a.__loadVegaLite(function(){var e=vega[b||a.logLevel]||vega.None;try{var f=window.vl.compile(a.vegaLiteSpec,e).spec;a.vegaSpec=f,c(f)}catch(b){a.dispatchEvent(new CustomEvent('error',{detail:b})),d(b)}})}).catch(function(b){a.dispatchEvent(new CustomEvent('error',{detail:b})),console.warn(b)}):void 0}},{key:'resize',value:function(){return this.view?this.view.resize():void 0}},{key:'debounceRun',value:function(){var a=this;this._debounceJob=Polymer.Debouncer.debounce(this._debounceJob,Polymer.Async.microTask,function(){a.run()})}},{key:'loadJSON',value:function(a){var b=this;if(!this._vegaReady||!a)return Promise.reject('url or vega not ready!');var c=vega.loader();return c.load(a).then(function(a){return JSON.parse(a)}).catch(function(a){b.dispatchEvent(new CustomEvent('error',{detail:a}))})}},{key:'downloadImage',value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'png';this.view&&this.view.toImageURL(b).then(function(a){var c=document.createElement('a');c.setAttribute('href',a),c.setAttribute('target','_blank'),c.setAttribute('download','vega-export.'+b),c.dispatchEvent(new MouseEvent('click'))}).catch(function(b){a.dispatchEvent(new CustomEvent('error',{detail:b}))})}},{key:'_loadTooltipPlugin',value:function(a,b){this.tooltip&&this._tooltipReady&&this.rendered&&a&&window.vegaTooltip.vega(a,b)}},{key:'_loadTooltip',value:function(a){var b=this;this._tooltipReady=window.vegaTooltip&&!0,!this._tooltipReady&&a&&this._vegaReady&&(PolymerVis.loadScript(this.tooltipPluginSrc,function(){b._tooltipReady=window.vegaTooltip&&!0}),PolymerVis.loadStylesheet(this.tooltipPluginCssSrc))}},{key:'_vegaSpecUrlChanged',value:function(a){var b=this;a&&this.loadJSON(a).then(function(a){b.vegaSpec=a}).catch(function(){})}},{key:'_vegaLiteSpecUrlChanged',value:function(a){var b=this;a&&this.loadJSON(a).then(function(a){b.vegaLiteSpec=a}).catch(function(a){b.dispatchEvent(new CustomEvent('error',{detail:a}))})}},{key:'_observeSlot',value:function(){return this._observer?void this._observer.connect():void(this._observer=new Polymer.FlattenedNodesObserver(this.$.slot,this._slotChanged.bind(this)))}},{key:'_bindSlots',value:function(a){var b=this;if(this.view&&a&&this.vegaSpec&&this.rendered){var c=0;a.forEach(function(a){'VEGA-DATA'===a.nodeName&&b.vegaSpec&&(a.name=a.name||b.vegaSpec.data[c].name,c+=1),a.view=b.view,a.rendered=b.rendered})}}},{key:'_slotChanged',value:function(){this.slots=this.shadowRoot.querySelector('slot').assignedNodes({flatten:!0}).filter(function(a){return 0<=a.nodeName.indexOf('VEGA')})}},{key:'_computeView',value:function(a,b){if(this._vegaReady&&a&&this._connected){this.view&&this.view.finalize();var c=vega[c]||vega.None,d=new vega.View(a,{logLevel:c,renderer:this.renderer}).initialize(b?null:this.$.vegaElement);return this.rendered=!1,this.dispatchEvent(new CustomEvent('view-ready',{detail:d})),d}}},{key:'_setLogLevel',value:function(a){if(this.view&&vega[a])return this.view=this.view.logLevel(vega[a]),this.rendered||this.debounceRun(),this.view}},{key:'_setHover',value:function(a,b){if(this.view&&this.hover)return this.view=this.view.hover(a,b),this.rendered||this.debounceRun(),this.view}},{key:'_setRenderer',value:function(a){if(this.view&&a)return this.view=this.view.renderer(a),this.rendered||this.debounceRun(),this.view}},{key:'_updateBackground',value:function(a){this.view&&a&&(this.view.background(a),this.rendered&&this.debounceRun())}},{key:'_updateWidth',value:function(a){this.view&&a&&(this.view.width(a),this.rendered&&this.debounceRun())}},{key:'_updateHeight',value:function(a){this.view&&a&&(this.view.height(a),this.rendered&&this.debounceRun())}},{key:'_updatePadding',value:function(a){this.view&&a&&(this.view.padding(a),this.rendered&&this.debounceRun())}},{key:'__loadVegaLite',value:function(a){var b=this;this._vegaLiteReady=window.vl,window.vl?a():PolymerVis.loadScript(this.vegaLiteSrc,function(){if(b._vegaLiteReady=window.vl&&!0,'3'!==window.vega.version[0])throw new Error('vega version must be at least 3.0.0');a()})}}],[{key:'is',get:function(){return'vega-element'}},{key:'properties',get:function(){return{headless:{type:Boolean},tooltip:{type:Boolean},tooltipOptions:{type:Object,value:void 0},tooltipPluginSrc:{type:String,value:'https://cdnjs.cloudflare.com/ajax/libs/vega-tooltip/0.3.0/vega-tooltip.min.js'},tooltipPluginCssSrc:{type:String,value:'https://cdnjs.cloudflare.com/ajax/libs/vega-tooltip/0.3.0/vega-tooltip.min.css'},vegaSrc:{type:String,value:'https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.2/vega.min.js'},vegaCoreSrc:{type:String,value:'https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.2/vega-core.min.js'},vegaLiteSrc:{type:String,value:'https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-rc3/vega-lite.js'},logLevel:{type:String,value:'None'},renderer:{type:String,value:'canvas'},hover:{type:Boolean},hoverSet:{type:String,value:'hover'},updateSet:{type:String,value:'update'},background:{type:String},view:{type:Object,notify:!0,readOnly:!0,computed:'_computeView(_runtime, headless, _vegaReady, _connected)'},width:{type:Number,notify:!0,reflectToAttribute:!0},height:{type:Number,notify:!0,reflectToAttribute:!0},padding:{type:Object},vegaSpec:{type:Object,notify:!0},vegaLiteSpec:{type:Object,notify:!0},vegaSpecUrl:{type:String},vegaLiteSpecUrl:{type:String},config:{type:Object,value:function(){return{}}},customEncode:{type:String},rendered:{type:Boolean,notify:!0},slots:{type:Array,notify:!0},_runtime:{type:Object,computed:'parse(vegaSpec, config, _vegaReady)'},_vegaReady:{type:Boolean},_tooltipReady:{type:Boolean,value:!1},_connected:{type:Boolean},_debounceJob:{type:Object},_observer:{type:Object}}}},{key:'observers',get:function(){return['_vegaLiteSpecUrlChanged(vegaLiteSpecUrl, _vegaReady)','_vegaSpecUrlChanged(vegaSpecUrl, _vegaReady)','_setLogLevel(logLevel, view)','_setRenderer(renderer, view)','_setHover(hoverSet, updateSet, hover, view)','_updateWidth(width, view)','_updateHeight(height, view)','_updateBackground(background, view)','_updatePadding(padding, view)','_loadTooltip(tooltip, _vegaReady)','_loadTooltipPlugin(view, tooltipOptions, _tooltipReady, rendered)','compile(vegaLiteSpec, logLevel)','_bindSlots(slots, view, rendered, vegaSpec)']}}]),b}(Polymer.Element);window.customElements.define(VegaElement.is,VegaElement);</script></dom-module></body></html>