!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window).vl=t()}(function(){var l=Math.max;return function d(p,e,t){function i(a,o){if(!e[a]){if(!p[a]){var r="function"==typeof require&&require;if(!o&&r)return r(a,!0);if(n)return n(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=e[a]={exports:{}};p[a][0].call(u.exports,function(t){var e=p[a][1][t];return i(e||t)},u,u.exports,d,p,e,t)}return e[a].exports}for(var n="function"==typeof require&&require,a=0;a<t.length;a++)i(t[a]);return i}({1:[function(n,e){var t="undefined"==typeof JSON?n("jsonify"):JSON;e.exports=function(a,r){r||(r={}),"function"==typeof r&&(r={cmp:r});var S=r.space||"";"number"==typeof S&&(S=Array(S+1).join(" "));var d="boolean"==typeof r.cycles&&r.cycles,x=r.replacer||function(a,e){return e},s=r.cmp&&function(o){return function(e){return function(t,l){var s={key:t,value:e[t]},r={key:l,value:e[l]};return o(s,r)}}}(r.cmp),l=[];return function a(e,n,r,c){var u=S?"\n"+Array(c+1).join(S):"",p=S?": ":":";if(r&&r.toJSON&&"function"==typeof r.toJSON&&(r=r.toJSON()),void 0!==(r=x.call(e,n,r))){if("object"!=typeof r||null===r)return t.stringify(r);if(i(r)){for(var m,v=[],g=0;g<r.length;g++)m=a(r,g,r[g],c+1)||t.stringify(null),v.push(u+S+m);return"["+v.join(",")+u+"]"}if(-1!==l.indexOf(r)){if(d)return t.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}l.push(r);for(var h,b=o(r).sort(s&&s(r)),v=[],g=0;g<b.length;g++)if(h=a(r,n=b[g],r[n],c+1),h){var y=t.stringify(n)+p+h;v.push(u+S+y)}return l.splice(l.indexOf(r),1),"{"+v.join(",")+u+"}"}}({"":a},"",a,0)};var i=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},o=Object.keys||function(a){var e=Object.prototype.hasOwnProperty||function(){return!0},t=[];for(var n in a)e.call(a,n)&&t.push(n);return t}},{jsonify:2}],2:[function(a,e,t){t.parse=a("./lib/parse"),t.stringify=a("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(n,e){var h,y,r,_,t={'"':"\"","\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},o=function(t){throw{name:"SyntaxError",message:t,at:h,text:r}},l=function(t){return t&&t!==y&&o("Expected '"+t+"' instead of '"+y+"'"),y=r.charAt(h),h+=1,y},s=function(){var a,e="";for("-"===y&&(e="-",l("-"));"0"<=y&&"9">=y;)e+=y,l();if("."===y)for(e+=".";l()&&"0"<=y&&"9">=y;)e+=y;if("e"===y||"E"===y)for(e+=y,l(),"-"!==y&&"+"!==y||(e+=y,l());"0"<=y&&"9">=y;)e+=y,l();return(a=+e,isFinite(a))?a:void o("Bad number")},c=function(){var a,e,s,n="";if("\""===y)for(;l();){if("\""===y)return l(),n;if("\\"!==y)n+=y;else if(l(),"u"===y){for(s=0,e=0;4>e&&(a=parseInt(l(),16),isFinite(a));e+=1)s=16*s+a;n+=String.fromCharCode(s)}else{if("string"!=typeof t[y])break;n+=t[y]}}o("Bad string")},u=function(){for(;y&&" ">=y;)l()},d=function(){switch(y){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null;}o("Unexpected '"+y+"'")},p=function(){var t=[];if("["===y){if(l("["),u(),"]"===y)return l("]"),t;for(;y;){if(t.push(_()),u(),"]"===y)return l("]"),t;l(","),u()}}o("Bad array")},m=function(){var a,e={};if("{"===y){if(l("{"),u(),"}"===y)return l("}"),e;for(;y;){if(a=c(),u(),l(":"),Object.hasOwnProperty.call(e,a)&&o("Duplicate key \""+a+"\""),e[a]=_(),u(),"}"===y)return l("}"),e;l(","),u()}}o("Bad object")};_=function(){switch(u(),y){case"{":return m();case"[":return p();case"\"":return c();case"-":return s();default:return"0"<=y&&"9">=y?s():d();}},e.exports=function(a,l){var e;return r=a,h=0,y=" ",e=_(),u(),y&&o("Syntax error"),"function"==typeof l?function t(e,n){var i,s,a=e[n];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(void 0===(s=t(a,i))?delete a[i]:a[i]=s);return l.call(e,n,a)}({"":e},""):e}},{}],4:[function(n,e){function m(a){return t.lastIndex=0,t.test(a)?"\""+a.replace(t,function(a){var e=i[a];return"string"==typeof e?e:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+"\"":"\""+a+"\""}function d(i,e){var t,n,l,u,c,g=r,f=e[i];switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(i)),"function"==typeof o&&(f=o.call(e,i,f)),typeof f){case"string":return m(f);case"number":return isFinite(f)?f+"":"null";case"boolean":case"null":return f+"";case"object":if(!f)return"null";if(r+=a,c=[],"[object Array]"===Object.prototype.toString.apply(f)){for(u=f.length,t=0;t<u;t+=1)c[t]=d(t,f)||"null";return l=0===c.length?"[]":r?"[\n"+r+c.join(",\n"+r)+"\n"+g+"]":"["+c.join(",")+"]",r=g,l}if(o&&"object"==typeof o)for(u=o.length,t=0;t<u;t+=1)"string"==typeof(n=o[t])&&(l=d(n,f))&&c.push(m(n)+(r?": ":":")+l);else for(n in f)Object.prototype.hasOwnProperty.call(f,n)&&(l=d(n,f))&&c.push(m(n)+(r?": ":":")+l);return l=0===c.length?"{}":r?"{\n"+r+c.join(",\n"+r)+"\n"+g+"}":"{"+c.join(",")+"}",r=g,l;}}var r,a,o,t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"":"\\b","	":"\\t","\n":"\\n","":"\\f","\r":"\\r",'"':"\\\"","\\":"\\\\"};e.exports=function(l,s,c){var p;if(r="",a="","number"==typeof c)for(p=0;p<c;p+=1)a+=" ";else"string"==typeof c&&(a=c);if(o=s,s&&"function"!=typeof s&&("object"!=typeof s||"number"!=typeof s.length))throw new Error("JSON.stringify");return d("",{"":l})}},{}],5:[function(n,e){function t(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(a){if(c===setTimeout)return setTimeout(a,0);if((c===t||!c)&&setTimeout)return c=setTimeout,setTimeout(a,0);try{return c(a,0)}catch(e){try{return c.call(null,a,0)}catch(e){return c.call(this,a,0)}}}function a(t){if(y===clearTimeout)return clearTimeout(t);if((y===i||!y)&&clearTimeout)return y=clearTimeout,clearTimeout(t);try{return y(t)}catch(e){try{return y.call(null,t)}catch(e){return y.call(this,t)}}}function o(){g&&p&&(g=!1,p.length?m=p.concat(m):b=-1,m.length&&s())}function s(){if(!g){var n=r(o);g=!0;for(var e=m.length;e;){for(p=m,m=[];++b<e;)p&&p[b].run();b=-1,e=m.length}p=null,g=!1,a(n)}}function l(a,e){this.fun=a,this.array=e}function u(){}var c,y,_=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:t}catch(a){c=t}try{y="function"==typeof clearTimeout?clearTimeout:i}catch(t){y=i}}();var p,m=[],g=!1,b=-1;_.nextTick=function(a){var e=Array(arguments.length-1);if(1<arguments.length)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];m.push(new l(a,e)),1!==m.length||g||r(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},_.title="browser",_.browser=!0,_.env={},_.argv=[],_.version="",_.versions={},_.on=u,_.addListener=u,_.once=u,_.off=u,_.removeListener=u,_.removeAllListeners=u,_.emit=u,_.prependListener=u,_.prependOnceListener=u,_.listeners=function(){return[]},_.binding=function(){throw new Error("process.binding is not supported")},_.cwd=function(){return"/"},_.chdir=function(){throw new Error("process.chdir is not supported")},_.umask=function(){return 0}},{}],6:[function(a,o){(function(_){var b,n,i,r,a,S,s,l,u,c,x,d,p,m,g,h,v;!function(a){function n(a,e){return"function"==typeof Object.create?Object.defineProperty(a,"__esModule",{value:!0}):a.__esModule=!0,function(t,n){return a[t]=e?e(t,n):n}}var i="object"==typeof _?_:"object"==typeof self?self:"object"==typeof this?this:{};a("object"==typeof o&&"object"==typeof o.exports?n(i,n(o.exports)):n(i))}(function(o){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=e}||function(a,e){for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t])};b=function(t,e){function a(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},n=Object.assign||function(a){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t],e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a},i=function(a,e){var t={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&0>e.indexOf(n)&&(t[n]=a[n]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(a);i<n.length;i++)0>e.indexOf(n[i])&&(t[n[i]]=a[n[i]]);return t},r=function(l,e,t,n){var i,r=arguments.length,a=3>r?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(l,e,t,n);else for(var o=l.length-1;0<=o;o--)(i=l[o])&&(a=(3>r?i(a):3<r?i(e,t,a):i(e,t))||a);return 3<r&&a&&Object.defineProperty(e,t,a),a},a=function(a,e){return function(t,n){e(t,n,a)}},S=function(a,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,e)},s=function(d,e,t,n){return new(t||(t=Promise))(function(i,r){function a(t){try{s(n.next(t))}catch(t){r(t)}}function o(t){try{s(n.throw(t))}catch(t){r(t)}}function s(n){n.done?i(n.value):new t(function(e){e(n.value)}).then(a,o)}s((n=n.apply(d,e||[])).next())})},l=function(d,e){function t(a){return function(e){return n([a,e])}}function n(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(a=r[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=0<a.length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue;}t=e.call(d,s)}catch(a){t=[6,a],r=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var i,r,a,c,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},u=function(a,e){for(var t in a)e.hasOwnProperty(t)||(e[t]=a[t])},c=function(a){var i="function"==typeof Symbol&&a[Symbol.iterator],t=0;return i?i.call(a):{next:function(){return a&&t>=a.length&&(a=void 0),{value:a&&a[t++],done:!a}}}},x=function(l,e){var t="function"==typeof Symbol&&l[Symbol.iterator];if(!t)return l;var s,i,r=t.call(l),a=[];try{for(;(void 0===e||0<e--)&&!(s=r.next()).done;)a.push(s.value)}catch(t){i={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(i)throw i.error}}return a},d=function(){for(var a=[],e=0;e<arguments.length;e++)a=a.concat(x(arguments[e]));return a},p=function(t){return this instanceof p?(this.v=t,this):new p(t)},m=function(d,e,t){function n(a){r[a]&&(l[a]=function(e){return new Promise(function(t,n){1<c.push([a,e,t,n])||m(a,e)})})}function m(a,e){try{i(r[a](e))}catch(t){s(c[0][3],t)}}function i(t){t.value instanceof p?Promise.resolve(t.value.v).then(a,o):s(c[0][2],t)}function a(t){m("next",t)}function o(t){m("throw",t)}function s(a,e){a(e),c.shift(),c.length&&m(c[0][0],c[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,r=t.apply(d,e||[]),c=[];return l={},n("next"),n("throw"),n("return"),l[Symbol.asyncIterator]=function(){return this},l},g=function(a){function e(e,s){a[e]&&(o[e]=function(t){return(l=!l)?{value:p(a[e](t)),done:"return"===e}:s?s(t):t})}var o,l;return o={},e("next"),e("throw",function(t){throw t}),e("return"),o[Symbol.iterator]=function(){return this},o},h=function(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=a[Symbol.asyncIterator];return e?e.call(a):"function"==typeof c?c(a):a[Symbol.iterator]()},v=function(a,e){return Object.defineProperty?Object.defineProperty(a,"raw",{value:e}):a.raw=e,a},o("__extends",b),o("__assign",n),o("__rest",i),o("__decorate",r),o("__param",a),o("__metadata",S),o("__awaiter",s),o("__generator",l),o("__exportStar",u),o("__values",c),o("__read",x),o("__spread",d),o("__await",p),o("__asyncGenerator",m),o("__asyncDelegator",g),o("__asyncValues",h),o("__makeTemplateObject",v)})}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}],7:[function(a,e){e.exports="function"==typeof Object.create?function(a,n){a.super_=n,a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,e){a.super_=e;var t=function(){};t.prototype=e.prototype,a.prototype=new t,a.prototype.constructor=a}},{}],8:[function(a,e){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],9:[function(M,e,R){(function(n,t){function I(n,e){var t={seen:[],stylize:a};return 3<=arguments.length&&(t.depth=arguments[2]),4<=arguments.length&&(t.colors=arguments[3]),m(e)?t.showHidden=e:e&&R._extend(t,e),h(t.showHidden)&&(t.showHidden=!1),h(t.depth)&&(t.depth=2),h(t.colors)&&(t.colors=!1),h(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=r),F(t,n,t.depth)}function r(a,e){var t=I.styles[e];return t?"\x1B["+I.colors[t][0]+"m"+a+"\x1B["+I.colors[t][1]+"m":a}function a(t){return t}function L(a){var n={};return a.forEach(function(t){n[t]=!0}),n}function F(m,e,t){if(m.customInspect&&e&&E(e.inspect)&&e.inspect!==R.inspect&&(!e.constructor||e.constructor.prototype!==e)){var n=e.inspect(t,m);return f(n)||(n=F(m,n,t)),n}var i=l(m,e);if(i)return i;var a=Object.keys(e),o=L(a);if(m.showHidden&&(a=Object.getOwnPropertyNames(e)),x(e)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return s(e);if(0===a.length){if(E(e)){var r=e.name?": "+e.name:"";return m.stylize("[Function"+r+"]","special")}if(y(e))return m.stylize(RegExp.prototype.toString.call(e),"regexp");if(U(e))return m.stylize(Date.prototype.toString.call(e),"date");if(x(e))return s(e)}var g="",h=!1,_=["{","}"];if(p(e)&&(h=!0,_=["[","]"]),E(e)&&(g=" [Function"+(e.name?": "+e.name:"")+"]"),y(e)&&(g=" "+RegExp.prototype.toString.call(e)),U(e)&&(g=" "+Date.prototype.toUTCString.call(e)),x(e)&&(g=" "+s(e)),0===a.length&&(!h||0==e.length))return _[0]+g+_[1];if(0>t)return y(e)?m.stylize(RegExp.prototype.toString.call(e),"regexp"):m.stylize("[Object]","special");m.seen.push(e);var S;return S=h?c(m,e,t,o,a):a.map(function(a){return u(m,e,t,o,a,h)}),m.seen.pop(),d(S,g,_)}function l(a,e){if(h(e))return a.stylize("undefined","undefined");if(f(e)){var t="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\"")+"'";return a.stylize(t,"string")}return i(e)?a.stylize(""+e,"number"):m(e)?a.stylize(""+e,"boolean"):g(e)?a.stylize("null","null"):void 0}function s(t){return"["+Error.prototype.toString.call(t)+"]"}function c(l,e,t,n,i){for(var d=[],a=0,o=e.length;a<o;++a)v(e,a+"")?d.push(u(l,e,t,n,a+"",!0)):d.push("");return i.forEach(function(a){a.match(/^\d+$/)||d.push(u(l,e,t,n,a,!0))}),d}function u(l,e,t,n,i,r){var a,o,s;if((s=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?o=s.set?l.stylize("[Getter/Setter]","special"):l.stylize("[Getter]","special"):s.set&&(o=l.stylize("[Setter]","special")),v(n,i)||(a="["+i+"]"),o||(0>l.seen.indexOf(s.value)?-1<(o=g(t)?F(l,s.value,null):F(l,s.value,t-1)).indexOf("\n")&&(o=r?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n")):o=l.stylize("[Circular]","special")),h(a)){if(r&&i.match(/^\d+$/))return o;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=l.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,"\"").replace(/(^"|"$)/g,"'"),a=l.stylize(a,"string"))}return a+": "+o}function d(a,e,t){var n=0;return 60<a.reduce(function(a,e){return n++,0<=e.indexOf("\n")&&n++,a+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?t[0]+(""===e?"":e+"\n ")+" "+a.join(",\n  ")+" "+t[1]:t[0]+e+" "+a.join(", ")+" "+t[1]}function p(t){return Array.isArray(t)}function m(t){return"boolean"==typeof t}function g(t){return null===t}function i(t){return"number"==typeof t}function f(t){return"string"==typeof t}function h(t){return void 0===t}function y(t){return _(t)&&"[object RegExp]"===b(t)}function _(t){return"object"==typeof t&&null!==t}function U(t){return _(t)&&"[object Date]"===b(t)}function x(t){return _(t)&&("[object Error]"===b(t)||t instanceof Error)}function E(t){return"function"==typeof t}function b(t){return Object.prototype.toString.call(t)}function S(t){return 10>t?"0"+t.toString(10):t.toString(10)}function e(){var a=new Date,e=[S(a.getHours()),S(a.getMinutes()),S(a.getSeconds())].join(":");return[a.getDate(),D[a.getMonth()],e].join(" ")}function v(a,e){return Object.prototype.hasOwnProperty.call(a,e)}var N=/%[sdj%]/g;R.format=function(l){if(!f(l)){for(var e=[],t=0;t<arguments.length;t++)e.push(I(arguments[t]));return e.join(" ")}for(var t=1,n=arguments,i=n.length,a=(l+"").replace(N,function(a){if("%%"===a)return"%";if(t>=i)return a;switch(a){case"%s":return n[t++]+"";case"%d":return+n[t++];case"%j":try{return JSON.stringify(n[t++])}catch(t){return"[Circular]"}default:return a;}}),o=n[t];t<i;o=n[++t])a+=g(o)||!_(o)?" "+o:" "+I(o);return a},R.deprecate=function(i,e){if(h(t.process))return function(){return R.deprecate(i,e).apply(this,arguments)};if(!0===n.noDeprecation)return i;var o=!1;return function(){if(!o){if(n.throwDeprecation)throw new Error(e);n.traceDeprecation?console.trace(e):console.error(e),o=!0}return i.apply(this,arguments)}};var T,k={};R.debuglog=function(a){if(h(T)&&(T=n.env.NODE_DEBUG||""),a=a.toUpperCase(),!k[a])if(new RegExp("\\b"+a+"\\b","i").test(T)){var e=n.pid;k[a]=function(){var n=R.format.apply(R,arguments);console.error("%s %d: %s",a,e,n)}}else k[a]=function(){};return k[a]},R.inspect=I,I.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},I.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},R.isArray=p,R.isBoolean=m,R.isNull=g,R.isNullOrUndefined=function(t){return null==t},R.isNumber=i,R.isString=f,R.isSymbol=function(t){return"symbol"==typeof t},R.isUndefined=h,R.isRegExp=y,R.isObject=_,R.isDate=U,R.isError=x,R.isFunction=E,R.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},R.isBuffer=M("./support/isBuffer");var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];R.log=function(){console.log("%s - %s",e(),R.format.apply(R,arguments))},R.inherits=M("inherits"),R._extend=function(a,e){if(!e||!_(e))return a;for(var o=Object.keys(e),n=o.length;n--;)a[o[n]]=e[o[n]];return a}}).call(this,M("_process"),"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"./support/isBuffer":8,_process:5,inherits:7}],10:[function(a,o,t){!function(a,e){e("object"==typeof t&&void 0!==o?t:a.vega=a.vega||{})}(this,function(c){"use strict";function S(t){return o.hasOwnProperty(t)}function x(l,e,t,d,i){for(var r,a=0,c=l.length;e<c;++e){if(r=l[e],!a&&r===t)return e;i&&0<=i.indexOf(r)?--a:d&&0<=d.indexOf(r)&&++a}return e}function E(n){for(var e=[],t=0,o=n.length,l=0;l<o;)l=x(n,l,g,N+d,u+p),e.push(n.substring(t,l).trim()),t=++l;if(0===e.length)throw"Empty event selector: "+n;return e}function i(n){return"["===n[0]?t(n):a(n)}function t(n){var e,l,d=n.length,o=1;if((o=x(n,o,u,N,u))===d)throw"Empty between selector: "+n;if(2!==(e=E(n.substring(1,o))).length)throw"Between selector must have two elements: "+n;if((n=n.slice(o+1).trim())[0]!==r)throw"Expected '>' after between selector: "+n;return e=e.map(i),(l=i(n.slice(1).trim())).between?{between:e,stream:l}:(l.between=e,l)}function a(t){var e,i,r={source:s},a=[],g=[0,0],b=0,c=0,h=t.length,E=0;if(t[h-1]===p){if(!(0<=(E=t.lastIndexOf(d))))throw"Unmatched right brace: "+t;try{g=n(t.substring(E+1,h-1))}catch(e){throw"Invalid throttle specification: "+t}h=(t=t.slice(0,E).trim()).length,E=0}if(!h)throw t;if(t[0]===f&&(b=++E),(e=x(t,E,m))<h&&(a.push(t.substring(c,e).trim()),c=E=++e),(E=x(t,E,N))===h)a.push(t.substring(c,h).trim());else if(a.push(t.substring(c,E).trim()),i=[],(c=++E)===h)throw"Unmatched left bracket: "+t;for(;E<h;){if((E=x(t,E,u))===h)throw"Unmatched left bracket: "+t;if(i.push(t.substring(c,E).trim()),E<h-1&&t[++E]!==N)throw"Expected left bracket: "+t;c=++E}if(!(h=a.length)||v.test(a[h-1]))throw"Invalid event selector: "+t;return 1<h?(r.type=a[1],b?r.markname=a[0].slice(1):S(a[0])?r.marktype=a[0]:r.source=a[0]):r.type=a[0],"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1)),null!=i&&(r.filter=i),g[0]&&(r.throttle=g[0]),g[1]&&(r.debounce=g[1]),r}function n(a){var e=a.split(g);if(!a.length||2<e.length)throw a;return e.map(function(e){var i=+e;if(i!=i)throw a;return i})}var s,o,N="[",u="]",d="{",p="}",m=":",g=",",f="@",r=">",v=/[[\]{}]/,h={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};c.selector=function(a,e,t){return s=e||"view",o=t||h,E(a.trim()).map(i)},Object.defineProperty(c,"__esModule",{value:!0})})},{}],11:[function(a,o,t){!function(a,e){e("object"==typeof t&&void 0!==o?t:a.vega=a.vega||{})}(this,function(P){"use strict";function M(t){return null==t?null:t.fields}function R(a){return t(a)?"["+a.map(R)+"]":d(a)||p(a)?JSON.stringify(a).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):a}function e(a,e,t){var n=[e].concat([].slice.call(t));console[a].apply(console,n)}function I(a){return function(e){return a*Math.exp(e)}}function r(a){return function(e){return Math.log(a*e)}}function a(a){return function(e){var n=Math.pow;return 0>e?-n(-e,a):n(e,a)}}function i(l,e,t,n){var i=t(l[0]),s=t(x(l)),a=(s-i)*e;return[n(i-a),n(s-a)]}function o(l,e,t,n,i){var r=n(l[0]),a=n(x(l)),o=null==e?(r+a)/2:n(e);return[i(o+(r-o)*t),i(o+(a-o)*t)]}function n(t){return D(t)?t:k(t)?t:Date.parse(t)}var u=Math.ceil,s=Math.sign,L=function(a,e,t){return a.fields=e||[],a.fname=t,a},c=function(t){throw Error(t)},f=function(d){function e(){r.push(l+d.substring(t,n)),l="",t=n+1}var t,n,i,r=[],a=null,o=0,s=d.length,l="";for(d+="",t=n=0;n<s;++n)if("\\"===(i=d[n]))l+=d.substring(t,n),t=++n;else if(i===a)e(),a=null,o=-1;else{if(a)continue;t===o&&"\""===i?(t=n+1,a=i):t===o&&"'"===i?(t=n+1,a=i):"."!==i||o?"["===i?(n>t&&e(),o=t=n+1):"]"===i&&(o||c("Access path missing open bracket: "+d),0<o&&e(),o=0,t=n+1):n>t?e():t=n+1}return o&&c("Access path missing closing bracket: "+d),a&&c("Access path missing closing quote: "+d),n>t&&(n++,e()),r},t=Array.isArray,d=function(t){return t===Object(t)},p=function(t){return"string"==typeof t},m=function(a,e){var t=f(a),n="return _["+t.map(R).join("][")+"];";return L(Function("_",n),[a=1===t.length?t[0]:a],e||a)},g=[],h=m("id"),y=L(function(t){return t},g,"identity"),b=L(function(){return 0},g,"zero"),_=L(function(){return 1},g,"one"),S=L(function(){return!0},g,"true"),v=L(function(){return!1},g,"false"),x=function(t){return t[t.length-1]},E=function(t){return null==t||""===t?null:+t},N=function(a){return null==a?[]:t(a)?a:[a]},O=function(t){return"function"==typeof t},T={},k=function(t){return"[object Date]"===Object.prototype.toString.call(t)},D=function(t){return"number"==typeof t},C=function(a,e){for(var t="";0<=--e;)t+=a;return t};P.accessor=L,P.accessorName=function(t){return null==t?null:t.fname},P.accessorFields=M,P.id=h,P.identity=y,P.zero=b,P.one=_,P.truthy=S,P.falsy=v,P.logger=function(a){var n=a||0;return{level:function(t){return arguments.length?(n=+t,this):n},error:function(){return 1<=n&&e("error","ERROR",arguments),this},warn:function(){return 2<=n&&e("warn","WARN",arguments),this},info:function(){return 3<=n&&e("log","INFO",arguments),this},debug:function(){return 4<=n&&e("log","DEBUG",arguments),this}}},P.None=0,P.Error=1,P.Warn=2,P.Info=3,P.Debug=4,P.panLinear=function(a,e){return i(a,e,E,y)},P.panLog=function(a,e){var t=s(a[0]);return i(a,e,r(t),I(t))},P.panPow=function(o,e,t){return i(o,e,a(t),a(1/t))},P.zoomLinear=function(a,e,t){return o(a,e,t,E,y)},P.zoomLog=function(a,e,t){var n=s(a[0]);return o(a,e,t,r(n),I(n))},P.zoomPow=function(l,e,t,n){return o(l,e,t,a(n),a(1/n))},P.array=N,P.compare=function(t,e){var n,i,a,o,s,l,r,d,c,p=[],u=(t=N(t)).map(function(a,e){return null==a?null:(p.push(e),O(a)?a:f(a).map(R).join("]["))}),m=p.length-1,g=N(e),h="var u,v;return ";if(0>m)return null;for(i=0;i<=m;++i)a=u[n=p[i]],O(a)?(o="(u=this."+(l="f"+n)+"(a))",s="(v=this."+l+"(b))",(r=r||{})[l]=a):(o="(u=a["+a+"])",s="(v=b["+a+"])"),l="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"===g[n]?(c=-1,d=1):(c=1,d=-1),h+="("+o+"<"+s+"||u==null)&&v!=null?"+d+":(u>v||v==null)&&u!=null?"+c+":"+l+"!==u&&v===v?"+d+":v!==v&&u===u?"+c+(n<m?":":":0");return a=Function("a","b",h+";"),r&&(a=a.bind(r)),t=t.reduce(function(a,e){return O(e)?(M(e)||[]).forEach(function(e){a[e]=1}):null!=e&&(a[e+""]=1),a},{}),L(a,Object.keys(t))},P.constant=function(t){return O(t)?t:function(){return t}},P.debounce=function(a,e){function o(){e(i),n=i=null}var n,i;return function(e){i=e,n&&clearTimeout(n),n=setTimeout(o,a)}},P.error=c,P.extend=function(a){for(var e,t,n=1,i=arguments.length;n<i;++n)for(t in e=arguments[n],e)a[t]=e[t];return a},P.extentIndex=function(d,e){var t,n,i,r,a,o=-1,s=d.length;if(null==e){for(;++o<s;)if(null!=(n=d[o])&&n>=n){t=i=n;break}for(r=a=o;++o<s;)null!=(n=d[o])&&(t>n&&(t=n,r=o),i<n&&(i=n,a=o))}else{for(;++o<s;)if(null!=(n=e(d[o],o,d))&&n>=n){t=i=n;break}for(r=a=o;++o<s;)null!=(n=e(d[o],o,d))&&(t>n&&(t=n,r=o),i<n&&(i=n,a=o))}return[r,a]},P.fastmap=function(a){function o(t){return s.hasOwnProperty(t)&&s[t]!==T}var l,n,s={};return l={size:0,empty:0,object:s,has:o,get:function(t){return o(t)?s[t]:void 0},set:function(t,e){return o(t)||(++l.size,s[t]===T&&--l.empty),s[t]=e,this},delete:function(t){return o(t)&&(--l.size,++l.empty,s[t]=T),this},clear:function(){l.size=l.empty=0,l.object=s={}},test:function(t){return arguments.length?(n=t,l):n},clean:function(){var i,e,t={},a=0;for(i in s)(e=s[i])===T||n&&n(e)||(t[i]=e,++a);l.size=a,l.empty=0,l.object=s=t}},a&&Object.keys(a).forEach(function(e){l.set(e,a[e])}),l},P.field=m,P.inherits=function(a,e){var t=a.prototype=Object.create(e.prototype);return t.constructor=a,t},P.isArray=t,P.isBoolean=function(t){return"boolean"==typeof t},P.isDate=k,P.isFunction=O,P.isNumber=D,P.isObject=d,P.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},P.isString=p,P.key=function(a,n){a&&(a=n?N(a).map(function(t){return t.replace(/\\(.)/g,"$1")}):N(a));var e=a&&a.length?Function("_","return ''+"+a.map(function(t){return"_["+(n?R(t):f(t).map(R).join("]["))+"]"}).join("+'|'+")+";"):function(){return""};return L(e,a,"key")},P.merge=function(d,e,t,n){var i=e.length,c=t.length;if(!c)return e;if(!i)return t;for(var p=n||new e.constructor(i+c),o=0,s=0,l=0;o<i&&s<c;++l)p[l]=0<d(e[o],t[s])?t[s++]:e[o++];for(;o<i;++o,++l)p[l]=e[o];for(;s<c;++s,++l)p[l]=t[s];return p},P.pad=function(l,e,t,n){var i=t||" ",s=l+"",a=e-s.length;return 0>=a?s:"left"===n?C(i,a)+s:"center"===n?C(i,~~(a/2))+s+C(i,u(a/2)):s+C(i,a)},P.peek=x,P.repeat=C,P.splitAccessPath=f,P.stringValue=R,P.toBoolean=function(t){return null==t||""===t?null:t&&"false"!==t&&"0"!==t&&t},P.toDate=function(a,e){return e=e||n,null==a||""===a?null:e(a)},P.toNumber=E,P.toString=function(t){return null==t||""===t?null:t+""},P.toSet=function(a){for(var e={},t=0,n=a.length;t<n;++t)e[a[t]]=1;return e},P.truncate=function(d,e,t,n){var i=null==n?"\u2026":n,r=d+"",a=r.length,o=l(0,e-i.length);return a<=e?r:"left"===t?i+r.slice(a-o):"center"===t?r.slice(0,u(o/2))+i+r.slice(a-~~(o/2)):r.slice(0,o)+i},P.visitArray=function(o,e,t){if(o){var n,i=0,l=o.length;if(e)for(;i<l;++i)(n=e(o[i]))&&t(n,i,o);else o.forEach(t)}},Object.defineProperty(P,"__esModule",{value:!0})})},{}],12:[function(a,e){e.exports={name:"vega-lite",author:"Jeffrey Heer, Dominik Moritz, Kanit \"Ham\" Wongsuphasawat",version:"2.0.1",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"build/src/index.js",types:"typings/vega-lite.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{pretsc:"mkdir -p build && rm -rf build/*/** && cp package.json build/",tsc:"tsc",prebuild:"mkdir -p build/site build/test-gallery",build:"npm run build:only","build:only":"npm run tsc && cp package.json build && browserify src/index.ts -p tsify -d -s vl | exorcist build/vega-lite.js.map > build/vega-lite.js",postbuild:"node node_modules/uglify-js/bin/uglifyjs build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && npm run schema","build:examples":"npm run data && npm run build:only && npm run build:examples-only","build:examples-only":"npm run build:example && npm run build:examples-normalized","build:examples-normalized":"rm -f examples/specs/normalized/*.vl.json && scripts/build-normalized-examples","build:example":"TZ=America/Los_Angeles scripts/build-examples.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"browserify site/static/main.ts -p [tsify -p site] -d | exorcist build/site/main.js.map > build/site/main.js","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > build/test-gallery/main.js","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f vega-lite.* & find -E src test site examples -regex '.*\\.(js|js.map|d.ts)' -delete && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' -type f -exec rm -f {} +",data:"rsync -r node_modules/vega-datasets/data/* data",link:"npm link && npm link vega-lite",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",prestart:"npm run data && npm run build && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'build/test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",preschema:"npm run prebuild",schema:"ts-json-schema-generator --path tsconfig.json --type TopLevelExtendedSpec > build/vega-lite-schema.json && npm run renameschema && cp build/vega-lite-schema.json _data/",renameschema:"scripts/rename-schema.sh",presite:"npm run prebuild && npm run data && npm run build:site && npm run build:toc && npm run build:versions && scripts/create-example-pages",site:"bundle exec jekyll serve",lint:"tslint -p .",test:"npm run build:only && npm run test:only && npm run test:runtime && npm run lint",posttest:"npm run schema && npm run data && npm run mocha:examples","test:nocompile":"npm run test:only && npm run test:runtime && npm run lint && npm run mocha:examples","test:only":"nyc --reporter=html --reporter=text-summary npm run mocha:test","test:runtime":"TZ=America/Los_Angeles wdio wdio.conf.js","test:runtime:generate":"rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true npm run test:runtime","test:debug":"npm run tsc && mocha --recursive --debug-brk --inspect build/test","test:debug-examples":"npm run tsc && npm run schema && mocha --recursive --debug-brk --inspect build/examples","mocha:test":"mocha --require source-map-support/register --reporter dot --recursive build/test","mocha:examples":"mocha --require source-map-support/register --reporter dot --recursive build/examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","watch:build":"watchify src/index.ts -p tsify -v -d -s vl -o 'exorcist build/vega-lite.js.map > build/vega-lite.js'","watch:tsc":"npm run tsc -- -w","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:nocompile' # already ran schema in build"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^4.0.4","@types/d3":"^4.11.0","@types/highlight.js":"^9.1.10","@types/json-stable-stringify":"^1.0.32","@types/mkdirp":"^0.5.1","@types/mocha":"^2.2.43","@types/node":"^8.0.47","@types/webdriverio":"^4.8.6",ajv:"^5.3.0","browser-sync":"^2.18.13",browserify:"^14.5.0","browserify-shim":"^3.8.14",chai:"^4.1.2",cheerio:"^1.0.0-rc.2",chromedriver:"^2.33.2",codecov:"^3.0.0",d3:"^4.11.0",exorcist:"^1.0.0","highlight.js":"^9.12.0",mkdirp:"^0.5.1",mocha:"^4.0.1",nodemon:"^1.12.1",nyc:"^11.2.1","source-map-support":"^0.5.0","svg2png-many":"^0.0.7","ts-json-schema-generator":"^0.15.0",tslint:"5.4.3","ts-node":"^3.3.0",tsify:"^3.0.3","tslint-eslint-rules":"^4.1.1",typescript:"^2.6.1","uglify-js":"^3.1.5",vega:"^3.0.7","vega-datasets":"^1.11.0","vega-embed":"^3.0.0-rc7","vega-tooltip":"^0.4.4",watchify:"^3.9.0","wdio-chromedriver-service":"^0.1.1","wdio-dot-reporter":"0.0.9","wdio-mocha-framework":"^0.5.11","wdio-static-server-service":"^1.0.1",webdriverio:"^4.8.0","yaml-front-matter":"^3.4.0"},dependencies:{"json-stable-stringify":"^1.0.1",tslib:"^1.8.0","vega-event-selector":"^2.0.0","vega-util":"^1.6.2",yargs:"^10.0.3"}}},{}],13:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("./util"),i={values:1,count:1,valid:1,missing:1,distinct:1,sum:1,mean:1,average:1,variance:1,variancep:1,stdev:1,stdevp:1,median:1,q1:1,q3:1,ci0:1,ci1:1,min:1,max:1,argmin:1,argmax:1};t.AGGREGATE_OPS=n.flagKeys(i),t.isAggregateOp=function(t){return!!i[t]},t.COUNTING_OPS=["count","valid","missing","distinct"],t.isCountingAggregateOp=function(a){return a&&n.contains(t.COUNTING_OPS,a)},t.SUM_OPS=["count","sum","distinct","valid","missing"],t.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],t.SHARED_DOMAIN_OP_INDEX=n.toSet(t.SHARED_DOMAIN_OPS)},{"./util":119}],14:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l("tslib"),i=l("./util");t.AXIS_PROPERTY_TYPE={grid:"grid",labelOverlap:"main",offset:"main",title:"main"};var r={orient:1,domain:1,format:1,grid:1,labelBound:1,labelFlush:1,labelPadding:1,labels:1,labelOverlap:1,maxExtent:1,minExtent:1,offset:1,position:1,tickCount:1,ticks:1,tickSize:1,title:1,titlePadding:1,values:1,zindex:1},a=n.__assign({},r,{encoding:1,labelAngle:1,titleMaxLength:1}),o=n.__assign({scale:1},r,{gridScale:1,encode:1});t.isAxisProperty=function(t){return!!a[t]},t.VG_AXIS_PROPERTIES=i.flagKeys(o),t.AXIS_PROPERTIES=i.flagKeys(a)},{"./util":119,tslib:6}],15:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("./channel"),i=a("./util");t.binToString=function(a){return i.isBoolean(a)?"bin":"bin"+i.keys(a).map(function(e){return("_"+e+"_"+a[e]).replace(",","_")}).join("")},t.autoMaxBins=function(t){return t===n.ROW||t===n.COLUMN||t===n.SIZE||t===n.COLOR||t===n.OPACITY||t===n.SHAPE?6:10}},{"./channel":16,"./util":119}],16:[function(m,e,t){"use strict";function n(a){return a===t.X||a===t.Y||a===t.COLOR||a===t.DETAIL||a===t.TOOLTIP||a===t.ORDER||a===t.OPACITY||a===t.ROW||a===t.COLUMN?{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0}:a===t.X2||a===t.Y2?{rule:!0,bar:!0,rect:!0,area:!0}:a===t.SIZE?{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0}:a===t.SHAPE?{point:!0}:a===t.TEXT?{text:!0}:void 0}Object.defineProperty(t,"__esModule",{value:!0});var i,r=m("tslib"),a=m("./util");!function(t){t.ROW="row",t.COLUMN="column",t.X="x",t.Y="y",t.X2="x2",t.Y2="y2",t.COLOR="color",t.SHAPE="shape",t.SIZE="size",t.OPACITY="opacity",t.TEXT="text",t.ORDER="order",t.DETAIL="detail",t.TOOLTIP="tooltip"}(i=t.Channel||(t.Channel={})),t.X=i.X,t.Y=i.Y,t.X2=i.X2,t.Y2=i.Y2,t.ROW=i.ROW,t.COLUMN=i.COLUMN,t.SHAPE=i.SHAPE,t.SIZE=i.SIZE,t.COLOR=i.COLOR,t.TEXT=i.TEXT,t.DETAIL=i.DETAIL,t.ORDER=i.ORDER,t.OPACITY=i.OPACITY,t.TOOLTIP=i.TOOLTIP;var o={x:1,y:1,x2:1,y2:1,size:1,shape:1,color:1,order:1,opacity:1,text:1,detail:1,tooltip:1},s=r.__assign({},o,{row:1,column:1});t.CHANNELS=a.flagKeys(s),s.order,s.detail;var l=r.__rest(s,["order","detail"]);t.SINGLE_DEF_CHANNELS=a.flagKeys(l),t.isChannel=function(t){return!!s[t]},t.UNIT_CHANNELS=a.flagKeys(o);var u=r.__rest(o,["x","y","x2","y2"]);t.NONPOSITION_CHANNELS=a.flagKeys(u);var c={x:1,y:1};t.POSITION_SCALE_CHANNELS=a.flagKeys(c),u.text,u.tooltip,u.detail,u.order;var g=r.__rest(u,["text","tooltip","detail","order"]);t.NONPOSITION_SCALE_CHANNELS=a.flagKeys(g);var d=r.__assign({},c,g);t.SCALE_CHANNELS=a.flagKeys(d),t.isScaleChannel=function(t){return!!d[t]},t.supportMark=function(a,e){return e in n(a)},t.getSupportedMark=n,t.rangeType=function(a){switch(a){case t.X:case t.Y:case t.SIZE:case t.OPACITY:case t.X2:case t.Y2:return"continuous";case t.ROW:case t.COLUMN:case t.SHAPE:case t.TEXT:case t.TOOLTIP:return"discrete";case t.COLOR:return"flexible";case t.DETAIL:case t.ORDER:return;}throw new Error("getSupportedRole not implemented for "+a)}},{"./util":119,tslib:6}],17:[function(o,e,t){"use strict";function n(a){return function(e,t){return t[a]&&e.push(t[a].combine()),e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n("main"),l=n("grid");t.assembleAxes=function(t){return[].concat(t.x?[].concat(t.x.reduce(i,[]),t.x.reduce(l,[])):[],t.y?[].concat(t.y.reduce(i,[]),t.y.reduce(l,[])):[])}},{}],18:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("tslib"),i=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return n.__extends(e,a),e}(a("../split").Split);t.AxisComponentPart=i},{"../split":90,tslib:6}],19:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAxisConfig=function(l,e,t,n,i){void 0===n&&(n="");for(var r,s=0,a=("band"===i?["axisBand"]:[]).concat(["x"===t?"axisX":"axisY","axis"+n.substr(0,1).toUpperCase()+n.substr(1),"axis"]);s<a.length;s++)if(r=a[s],e[r]&&void 0!==e[r][l])return e[r][l]}},{}],20:[function(p,e,t){"use strict";function _(i,e,t){return void 0===i.labelAngle?e===a.X&&s.contains([l.NOMINAL,l.ORDINAL],t.type)?270:void 0:(i.labelAngle%360+360)%360}function n(a,e){if(0<a){if(180<a%360)return"top"===e?"left":"right";if(180>a%360)return"top"===e?"right":"left"}else if(0>a)return n(a%360+360,e)}Object.defineProperty(t,"__esModule",{value:!0});var i=p("tslib"),a=p("../../channel"),r=p("../../fielddef"),o=p("../../scale"),l=p("../../type"),s=p("../../util"),c=p("../common"),f=p("./config");t.labels=function(a,e,t,l){var d=a.fieldDef(e)||("x"===e?a.fieldDef("x2"):"y"===e?a.fieldDef("y2"):void 0),u=a.axis(e),p=a.config,m={};if(r.isTimeFieldDef(d)){var g=a.getScaleComponent(e).get("type")===o.ScaleType.UTC;m.text={signal:c.timeFormatExpression("datum.value",d.timeUnit,u.format,p.axis.shortTimeLabels,p.timeFormat,g)}}var h=f.getAxisConfig("labelAngle",a.config,e,l,a.getScaleComponent(e).get("type"));if(void 0===h&&(h=_(u,e,d))&&(m.angle={value:h}),void 0!==h&&"x"===e){var b=n(h,l);b&&(m.align={value:b}),s.contains([90,270],h)&&(m.baseline={value:"middle"})}return m=i.__assign({},m,t),0===s.keys(m).length?void 0:m},t.labelAngle=_,t.labelAlign=n},{"../../channel":16,"../../fielddef":101,"../../scale":109,"../../type":118,"../../util":119,"../common":25,"./config":19,tslib:6}],21:[function(N,e,t){"use strict";function T(r,d){if(!r)return d.map(function(t){return s.__assign({},t.main?{main:t.main.clone()}:{},t.grid?{grid:t.grid.clone()}:{})});if(r.length===d.length){for(var t=r.length,p=0;p<t;p++){var m=r[p].main,g=d[p].main;if(!!m!=!!g)return;if(m&&g){var f=m.getWithExplicit("orient"),h=g.getWithExplicit("orient");if(f.explicit&&h.explicit&&f.value!==h.value)return;r[p].main=n(m,g)}var l=r[p].grid,y=d[p].grid;if(!!l!=!!y)return;l&&y&&(r[p].grid=n(l,y))}return r}}function n(a,e){for(var t=0,n=d.VG_AXIS_PROPERTIES;t<n.length;t++)!function(o){var t=g.mergeValuesWithExplicit(a.getWithExplicit(o),e.getWithExplicit(o),o,"axis",function(a,e){return"title"===o?u.titleMerger(a,e):"gridScale"===o?{explicit:a.explicit,value:a.value||e.value}:g.defaultTieBreaker(a,e,o,"axis")});a.setWithExplicit(o,t)}(n[t]);return a}function i(t){return!1===t||null===t}function k(a){return p.some(b,function(e){return D(a,e)})}function D(a,e){return"axis"===e||("grid"===e||"title"===e?!!a.get(e):!i(a.get(e)))}function o(n,e){return a(n,e,!0)}function l(n,e){return a(n,e,!1)}function a(u,e,t){var n=e.axis(u),m=new f.AxisComponentPart;d.VG_AXIS_PROPERTIES.forEach(function(i){var a=c(i,n,u,e,t);if(void 0!==a){var o="values"===i?!!n.values:"encode"===i?!!n.encoding||!!n.labelAngle:a===n[i],s=h.getAxisConfig(i,e.config,u,m.get("orient"),e.getScaleComponent(u).get("type"));(o||void 0===s||t)&&m.set(i,a,o)}});var l=n.encoding||{},a=b.reduce(function(t,a){if(!D(m,a))return t;var n="labels"===a?y.labels(e,u,l.labels||{},m.get("orient")):l[a]||{};return void 0!==n&&0<p.keys(n).length&&(t[a]={update:n}),t},{});return 0<p.keys(a).length&&m.set("encode",a,!!n.encoding||!!n.labelAngle),m}function c(c,e,t,n,i){var p=n.fieldDef(t);if((!i||"main"!==d.AXIS_PROPERTY_TYPE[c])&&(i||"grid"!==d.AXIS_PROPERTY_TYPE[c])){switch(c){case"scale":return n.scaleName(t);case"gridScale":return _.gridScale(n,t,i);case"domain":return _.domain(c,e,i,t);case"format":return u.numberFormat(p,e.format,n.config);case"grid":return a=n.getScaleComponent(t).get("type"),u.getSpecifiedOrDefaultValue(e.grid,_.grid(a,p));case"labels":return!i&&e.labels;case"labelFlush":return _.labelFlush(p,t,e,i);case"labelOverlap":return a=n.getScaleComponent(t).get("type"),_.labelOverlap(p,e,t,a);case"minExtent":return _.minMaxExtent(e.minExtent,i);case"maxExtent":return _.minMaxExtent(e.maxExtent,i);case"orient":return u.getSpecifiedOrDefaultValue(e.orient,_.orient(t));case"tickCount":var a=n.getScaleComponent(t).get("type"),o="x"===t?"width":"y"===t?"height":void 0,s=o?n.getSizeSignalRef(o):void 0;return u.getSpecifiedOrDefaultValue(e.tickCount,_.tickCount(t,p,a,s));case"ticks":return _.ticks(c,e,i,t);case"title":return u.getSpecifiedOrDefaultValue(e.title,_.title(e.titleMaxLength,p,n.config));case"values":return _.values(e,n,p);case"zindex":return u.getSpecifiedOrDefaultValue(e.zindex,_.zindex(i));}return d.isAxisProperty(c)?e[c]:void 0}}Object.defineProperty(t,"__esModule",{value:!0});var s=N("tslib"),d=N("../../axis"),r=N("../../channel"),p=N("../../util"),u=N("../common"),m=N("../resolve"),g=N("../split"),f=N("./component"),h=N("./config"),y=N("./encode"),_=N("./properties"),b=["domain","grid","labels","ticks","title"];t.parseUnitAxis=function(s){return r.POSITION_SCALE_CHANNELS.reduce(function(e,t){if(s.axis(t)){var n={},i=l(t,s);i&&k(i)&&(n.main=i);var r=o(t,s);r&&k(r)&&(n.grid=r),e[t]=[n]}return e},{})};var S={bottom:"top",top:"bottom",left:"right",right:"left"};t.parseLayerAxis=function(l){for(var e=l.component,d=e.axes,n=e.resolve,c={top:0,bottom:0,right:0,left:0},t=0,a=l.children;t<a.length;t++)!function(e){e.parseAxisAndHeader(),p.keys(e.component.axes).forEach(function(t){n.axis[t]=m.parseGuideResolve(l.component.resolve,t),"shared"===n.axis[t]&&(d[t]=T(d[t],e.component.axes[t]),d[t]||(n.axis[t]="independent",delete d[t]))})}(a[t]);["x","y"].forEach(function(e){for(var t,a=0,i=l.children;a<i.length;a++)t=i[a],t.component.axes[e]&&("independent"===n.axis[e]&&(d[e]=(d[e]||[]).concat(t.component.axes[e]),t.component.axes[e].forEach(function(a){var e=a.main.getWithExplicit("orient"),t=e.value,n=e.explicit;if(0<c[t]&&!n){var o=S[t];c[t]>c[o]&&a.main.set("orient",o,!1)}c[t]++})),delete t.component.axes[e])})},t.parseGridAxis=o,t.parseMainAxis=l},{"../../axis":14,"../../channel":16,"../../util":119,"../common":25,"../resolve":70,"../split":90,"./component":18,"./config":19,"./encode":20,"./properties":22,tslib:6}],22:[function(d,e,t){"use strict";function n(a,e,t){return!t&&e[a]}Object.defineProperty(t,"__esModule",{value:!0});var i=d("../../bin"),r=d("../../channel"),p=d("../../datetime"),a=d("../../fielddef"),o=d("../../log"),l=d("../../scale"),s=d("../../type"),c=d("../../util");t.domainAndTicks=n,t.domain=n,t.ticks=n,t.grid=function(a,e){return!l.hasDiscreteDomain(a)&&!e.bin},t.gridScale=function(a,e,t){if(t){var n="x"===e?"y":"x";if(a.getScaleComponent(n))return a.scaleName(n)}},t.labelFlush=function(a,e,t,n){if(!n)return void 0===t.labelFlush?"x"===e&&c.contains(["quantitative","temporal"],a.type)||void 0:t.labelFlush},t.labelOverlap=function(a,e,t,n){return void 0===e.labelOverlap?"nominal"===a.type?void 0:"log"!==n||"greedy":e.labelOverlap},t.minMaxExtent=function(a,e){return e?0:a},t.orient=function(t){switch(t){case r.X:return"bottom";case r.Y:return"left";}throw new Error(o.message.INVALID_CHANNEL_FOR_AXIS)},t.tickCount=function(a,e,t,n){if(!l.hasDiscreteDomain(t)&&"log"!==t&&!c.contains(["month","hours","day","quarter"],e.timeUnit))return e.bin?{signal:"ceil("+n.signal+"/20)"}:{signal:"ceil("+n.signal+"/40)"}},t.title=function(o,e,t){var n=a.title(e,t);return o?c.truncate(n,o):n},t.values=function(o,e,t){var n=o.values;if(o.values&&p.isDateTime(n[0]))return n.map(function(t){return{signal:p.dateTimeExpr(t,!0)}});if(!n&&t.bin&&t.type===s.QUANTITATIVE){var l=e.getName(i.binToString(t.bin)+"_"+t.field+"_bins");return{signal:"sequence("+l+".start, "+l+".stop + "+l+".step, "+l+".step)"}}return n},t.zindex=function(t){return t?0:1}},{"../../bin":15,"../../channel":16,"../../datetime":98,"../../fielddef":101,"../../log":106,"../../scale":109,"../../type":118,"../../util":119}],23:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=l("tslib"),n=l("../util"),i=l("./data/parse"),a=l("./layoutsize/assemble"),o=function(o){function e(e,l,n,i,s){return o.call(this,e,l,n,i,s)||this}return d.__extends(e,o),e.prototype.parseData=function(){this.component.data=i.parseData(this),this.children.forEach(function(t){t.parseData()})},e.prototype.parseSelection=function(){var a=this;this.component.selection={};for(var e=0,t=this.children;e<t.length;e++)!function(e){e.parseSelection(),n.keys(e.component.selection).forEach(function(t){a.component.selection[t]=e.component.selection[t]})}(t[e])},e.prototype.parseMarkGroup=function(){for(var a=0,e=this.children;a<e.length;a++)e[a].parseMarkGroup()},e.prototype.parseAxisAndHeader=function(){for(var a=0,e=this.children;a<e.length;a++)e[a].parseAxisAndHeader()},e.prototype.assembleSelectionTopLevelSignals=function(t){return this.children.reduce(function(a,e){return e.assembleSelectionTopLevelSignals(a)},t)},e.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(t){return t.assembleSelectionSignals()}),[]},e.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(a,e){return a.concat(e.assembleLayoutSignals())},a.assembleLayoutSignals(this))},e.prototype.assembleSelectionData=function(){return this.children.reduce(function(a,e){return e.assembleSelectionData(a)},[])},e.prototype.assembleMarks=function(){return this.children.map(function(a){var e=a.assembleTitle(),i=a.assembleGroupStyle(),o=a.assembleLayoutSize();return d.__assign({type:"group",name:a.getName("group")},e?{title:e}:{},i?{style:i}:{},o?{encode:{update:o}}:{},a.assembleGroup())})},e}(l("./model").Model);t.BaseConcatModel=o},{"../util":119,"./data/parse":41,"./layoutsize/assemble":48,"./model":67,tslib:6}],24:[function(d,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=d("../log"),i=d("../spec"),r=d("./concat"),a=d("./facet"),o=d("./layer"),s=d("./repeat"),l=d("./unit");t.buildModel=function(u,e,t,n,c,g,d){if(i.isFacetSpec(u))return new a.FacetModel(u,e,t,c,g);if(i.isLayerSpec(u))return new o.LayerModel(u,e,t,n,c,g,d);if(i.isUnitSpec(u))return new l.UnitModel(u,e,t,n,c,g,d);if(i.isRepeatSpec(u))return new s.RepeatModel(u,e,t,c,g);if(i.isConcatSpec(u))return new r.ConcatModel(u,e,t,c,g);throw new Error(m.message.INVALID_SPEC)}},{"../log":106,"../spec":112,"./concat":27,"./facet":45,"./layer":46,"./repeat":68,"./unit":91}],25:[function(h,e,t){"use strict";function y(t){return[].concat(t.type,t.style||[])}function n(i,e,t){var n=t.mark[i],d=t[e.type];void 0!==d[i]&&(n=d[i]);for(var a=0,o=y(e);a<o.length;a++){var s=o[a],l=t.style[s],p=i;l&&void 0!==l[p]&&(n=l[p])}return n}function _(a,e,t){if(a.type===d.QUANTITATIVE)return e||t.numberFormat}function a(a,e){return"format("+a+", \""+(e||"")+"\")"}function o(i,e,t){return a(i,e||t.numberFormat)}function b(a,e,t,n){return a+" === null || isNaN("+a+") ? \"null\" : "+o(a,t,n)+" + \" - \" + "+o(e,t,n)}function l(l,e,d,n,i,r){if(!e||d){var a=d||i;return r?"utcFormat("+l+", '"+a+"')":"timeFormat("+l+", '"+a+"')"}return s.formatExpression(e,l,n,r)}Object.defineProperty(t,"__esModule",{value:!0});var i=h("../channel"),c=h("../fielddef"),r=h("../scale"),s=h("../timeunit"),d=h("../type"),p=h("../util");t.applyConfig=function(l,e,t){for(var n=0,i=t;n<i.length;n++){var s=i[n],a=e[s];void 0!==a&&(l[s]={value:a})}return l},t.applyMarkConfig=function(l,e,t){for(var r=0,i=t;r<i.length;r++){var a=i[r],o=n(a,e.markDef,e.config);void 0!==o&&(l[a]={value:o})}return l},t.getStyles=y,t.getMarkConfig=n,t.formatSignalRef=function(o,e,t,d){var i=_(o,e,d);if(o.bin)return{signal:b(c.field(o,{expr:t}),c.field(o,{expr:t,binSuffix:"end"}),i,d)};if("quantitative"===o.type)return{signal:""+a(c.field(o,{expr:t}),i)};if(c.isTimeFieldDef(o)){var p=c.isScaleFieldDef(o)&&o.scale&&o.scale.type===r.ScaleType.UTC;return{signal:l(c.field(o,{expr:t}),o.timeUnit,e,d.text.shortTimeLabels,d.timeFormat,p)}}return{signal:"''+"+c.field(o,{expr:t})}},t.getSpecifiedOrDefaultValue=function(a,e){return void 0===a?e:a},t.numberFormat=_,t.numberFormatExpr=o,t.binFormatExpression=b,t.timeFormatExpression=l,t.sortParams=function(a,i){return(p.isArray(a)?a:[a]).reduce(function(t,e){return t.field.push(c.field(e,i)),t.order.push(e.sort||"ascending"),t},{field:[],order:[]})},t.titleMerger=function(a,e){return{explicit:a.explicit,value:a.value===e.value?a.value:a.value+", "+e.value}},t.binRequiresRange=function(a,e){return a.bin?i.isScaleChannel(e)&&p.contains(["ordinal","nominal"],a.type):(console.warn("Only use this method with binned field defs"),!1)}},{"../channel":16,"../fielddef":101,"../scale":109,"../timeunit":114,"../type":118,"../util":119}],26:[function(g,e,t){"use strict";function h(a,e,t){return y.__assign({autosize:1===c.keys(t).length&&t.type?t.type:t},r.extractTopLevelProperties(e),r.extractTopLevelProperties(a))}function i(o,l){var e=o.config?_.stripAndRedirectConfig(o.config):void 0,t=o.assembleTitle(),d=o.assembleGroupStyle(),c=o.assembleLayoutSignals();return c=c.filter(function(t){return"width"!==t.name&&"height"!==t.name||void 0===t.value||(l[t.name]=+t.value,!1)}),{spec:y.__assign({$schema:"https://vega.github.io/schema/vega/v3.0.json"},o.description?{description:o.description}:{},l,t?{title:t}:{},d?{style:d}:{},{data:[].concat(o.assembleSelectionData([]),a.assembleRootData(o.component.data))},o.assembleGroup(c.concat(o.assembleSelectionTopLevelSignals([]))),e?{config:e}:{})}}Object.defineProperty(t,"__esModule",{value:!0});var y=g("tslib"),_=g("../config"),o=g("../fielddef"),s=g("../log"),l=g("../spec"),r=g("../toplevelprops"),c=g("../util"),u=g("./buildmodel"),a=g("./data/assemble"),d=g("./data/optimize");t.compile=function(m,e){void 0===e&&(e={}),e.logger&&s.set(e.logger),e.fieldTitle&&o.setTitleFormatter(e.fieldTitle);try{var t=_.initConfig(c.mergeDeep({},e.config,m.config)),n=l.normalize(m,t),a=r.normalizeAutoSize(m.autosize,t.autosize,l.isLayerSpec(n)||l.isUnitSpec(n)),p=u.buildModel(n,null,"",void 0,void 0,t,"fit"===a.type);return p.parse(),d.optimizeDataflow(p.component.data),i(p,h(m,t,a))}finally{e.logger&&s.reset(),e.fieldTitle&&o.resetTitleFormatter()}}},{"../config":96,"../fielddef":101,"../log":106,"../spec":112,"../toplevelprops":116,"../util":119,"./buildmodel":24,"./data/assemble":29,"./data/optimize":39,tslib:6}],27:[function(d,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d("tslib"),c=d("../log"),r=d("../spec"),a=d("./baseconcat"),i=d("./buildmodel"),o=d("./layoutsize/parse"),l=function(a){function e(e,s,n,d,o){var l=a.call(this,e,s,n,o,e.resolve)||this;return l.type="concat",e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&c.warn(c.message.CONCAT_CANNOT_SHARE_AXIS),l.isVConcat=r.isVConcatSpec(e),l.children=(r.isVConcatSpec(e)?e.vconcat:e.hconcat).map(function(a,e){return i.buildModel(a,l,l.getName("concat_"+e),void 0,d,o,!1)}),l}return n.__extends(e,a),e.prototype.parseLayoutSize=function(){o.parseConcatLayoutSize(this)},e.prototype.parseAxisGroup=function(){return null},e.prototype.assembleLayout=function(){return n.__assign({padding:{row:10,column:10},offset:10},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})},e}(a.BaseConcatModel);t.ConcatModel=l},{"../log":106,"../spec":112,"./baseconcat":23,"./buildmodel":24,"./layoutsize/parse":49,tslib:6}],28:[function(d,e,t){"use strict";function p(a,e,t){return t.bin?(a[o.field(t,{})]=!0,a[o.field(t,{binSuffix:"end"})]=!0,l.binRequiresRange(t,e)&&(a[o.field(t,{binSuffix:"range"})]=!0)):a[o.field(t)]=!0,a}function n(a,e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];for(var i in n)n.hasOwnProperty(i)&&(t in a?a[t][i]=n[i]:a[t]={op:n[i]})}}Object.defineProperty(t,"__esModule",{value:!0});var i=d("tslib"),m=d("../../channel"),o=d("../../fielddef"),a=d("../../log"),s=d("../../util"),l=d("../common"),r=function(l){function d(e,a){var n=l.call(this)||this;return n.dimensions=e,n.measures=a,n}return i.__extends(d,l),d.prototype.clone=function(){return new d(i.__assign({},this.dimensions),s.duplicate(this.measures))},d.makeFromEncoding=function(i){var t=!1;i.forEachFieldDef(function(a){a.aggregate&&(t=!0)});var e={},l={};return t?(i.forEachFieldDef(function(a,t){a.aggregate?"count"===a.aggregate?(e["*"]=e["*"]||{},e["*"].count=o.field(a,{aggregate:"count"})):(e[a.field]=e[a.field]||{},e[a.field][a.aggregate]=o.field(a),m.isScaleChannel(t)&&"unaggregated"===i.scaleDomain(t)&&(e[a.field].min=o.field(a,{aggregate:"min"}),e[a.field].max=o.field(a,{aggregate:"max"}))):p(l,t,a)}),0===s.keys(l).length+s.keys(e).length?null:new d(l,e)):null},d.makeFromTransform=function(t){for(var e={},n={},i=0,r=t.aggregate;i<r.length;i++)(a=r[i]).op&&("count"===a.op?(n["*"]=n["*"]||{},n["*"].count=a.as||o.field(a)):(n[a.field]=n[a.field]||{},n[a.field][a.op]=a.as||o.field(a)));for(var a,c=0,p=t.groupby;c<p.length;c++)a=p[c],e[a]=!0;return 0===s.keys(e).length+s.keys(n).length?null:new d(e,n)},d.prototype.merge=function(t){s.differ(this.dimensions,t.dimensions)?a.debug("different dimensions, cannot merge"):(n(this.measures,t.measures),t.remove())},d.prototype.addDimensions=function(a){var n=this;a.forEach(function(t){return n.dimensions[t]=!0})},d.prototype.dependentFields=function(){var a={};return s.keys(this.dimensions).forEach(function(e){return a[e]=!0}),s.keys(this.measures).forEach(function(e){return a[e]=!0}),a},d.prototype.producedFields=function(){var a=this,i={};return s.keys(this.measures).forEach(function(t){s.keys(a.measures[t]).forEach(function(a){i[a+"_"+t]=!0})}),i},d.prototype.assemble=function(){var o=this,e=[],l=[],d=[];return s.keys(this.measures).forEach(function(t){s.keys(o.measures[t]).forEach(function(n){d.push(o.measures[t][n]),e.push(n),l.push(t)})}),{type:"aggregate",groupby:s.keys(this.dimensions),ops:e,fields:l,as:d}},d}(d("./dataflow").DataFlowNode);t.AggregateNode=r},{"../../channel":16,"../../fielddef":101,"../../log":106,"../../util":119,"../common":25,"./dataflow":32,tslib:6}],29:[function(_,e,t){"use strict";function S(b){function _(t,n){if(t instanceof h.SourceNode&&(r.isUrlData(t.data)||(b.push(n),n=i={name:null,source:n.name,transform:[]})),t instanceof p.ParseNode&&(t.parent instanceof h.SourceNode&&!n.source?n.format=x.__assign({},n.format||{},{parse:t.assembleFormatParse()}):n.transform=n.transform.concat(t.assembleTransforms())),t instanceof c.FacetNode)return n.name||(n.name="data_"+e++),!n.source||0<n.transform.length?(b.push(n),t.data=n.name):t.data=n.source,void t.assemble().forEach(function(e){return b.push(e)});if((t instanceof f.FilterNode||t instanceof l.CalculateNode||t instanceof a.AggregateNode||t instanceof g.LookupNode||t instanceof m.IdentifierNode)&&n.transform.push(t.assemble()),(t instanceof d.FilterInvalidNode||t instanceof s.BinNode||t instanceof y.TimeUnitNode||t instanceof v.StackNode)&&(n.transform=n.transform.concat(t.assemble())),t instanceof a.AggregateNode&&(n.name||(n.name="data_"+e++)),t instanceof u.OutputNode)if(n.source&&0===n.transform.length)t.setSource(n.source);else if(t.parent instanceof u.OutputNode)t.setSource(n.name);else if(n.name||(n.name="data_"+e++),t.setSource(n.name),1===t.numChildren()){b.push(n);var i={name:null,source:n.name,transform:[]};n=i}switch(t.numChildren()){case 0:t instanceof u.OutputNode&&(!n.source||0<n.transform.length)&&b.push(n);break;case 1:_(t.children[0],n);break;default:n.name||(n.name="data_"+e++);var o=n.name;!n.source||0<n.transform.length?b.push(n):o=n.source,t.children.forEach(function(t){_(t,{name:null,source:o,transform:[]})});}}var e=0;return _}Object.defineProperty(t,"__esModule",{value:!0});var x=_("tslib"),r=_("../../data"),i=_("../../util"),a=_("./aggregate"),s=_("./bin"),l=_("./calculate"),u=_("./dataflow"),c=_("./facet"),f=_("./filter"),d=_("./filterinvalid"),p=_("./formatparse"),m=_("./indentifier"),g=_("./lookup"),h=_("./source"),v=_("./stack"),y=_("./timeunit");t.assembleFacetData=function(a){var e=[],i=S(e);return a.children.forEach(function(e){return i(e,{source:a.name,name:null,transform:[]})}),e},t.assembleRootData=function(o){var e=i.vals(o.sources),t=[],n=S(t),r=0;e.forEach(function(a){a.hasName()||(a.dataName="source_"+r++);var e=a.assemble();n(a,e)}),t.forEach(function(t){0===t.transform.length&&delete t.transform}),t.sort(function(a,e){return 0===(a.transform||[]).length?-1:0===(e.transform||[]).length?1:0});for(var a=0,s=t;a<s.length;a++)for(var l,d=0,p=s[a].transform||[];d<p.length;d++)l=p[d],"lookup"===l.type&&(l.from=o.outputNodes[l.from].getSource());return t}},{"../../data":97,"../../util":119,"./aggregate":28,"./bin":30,"./calculate":31,"./dataflow":32,"./facet":33,"./filter":34,"./filterinvalid":35,"./formatparse":36,"./indentifier":37,"./lookup":38,"./source":42,"./stack":43,"./timeunit":44,tslib:6}],30:[function(h,e,t){"use strict";function y(l,e,t,n){if(d.binRequiresRange(e,t)){var p=c.isUnitModel(l)?l.axis(t)||l.legend(t)||{}:{},r=s.field(e,{expr:"datum"}),a=s.field(e,{expr:"datum",binSuffix:"end"});return{formulaAs:s.field(e,{binSuffix:"range"}),formula:d.binFormatExpression(r,a,p.format,n)}}return{}}function _(n,e){return a.binToString(n)+"_"+e}function i(t){return!!t.model}function r(a,e){if(i(a)){var t=a.model;return{signal:t.getName(e+"_bins"),extentSignal:t.getName(e+"_extent")}}return a}function o(t){return"as"in t}function b(p,e){var t=o(p)?[p.as,p.as+"_end"]:[s.field(p,{}),s.field(p,{binSuffix:"end"})];var u=s.normalizeBin(p.bin,void 0)||{},m=_(u,p.field),g=r(e,m),f=g.signal,h=g.extentSignal;return{key:m,binComponent:S.__assign({bin:u,field:p.field,as:t},f?{signal:f}:{},h?{extentSignal:h}:{})}}Object.defineProperty(t,"__esModule",{value:!0});var S=h("tslib"),a=h("../../bin"),s=h("../../fielddef"),l=h("../../util"),d=h("../common"),c=h("../model"),n=function(a){function s(e){var i=a.call(this)||this;return i.bins=e,i}return S.__extends(s,a),s.prototype.clone=function(){return new s(l.duplicate(this.bins))},s.makeBinFromEncoding=function(i){var t=i.reduceFieldDef(function(l,t,n){if(t.bin){var r=b(t,{model:i}),a=r.key,o=r.binComponent;l[a]=S.__assign({},o,l[a],y(i,t,n,i.config))}return l},{});return 0===l.keys(t).length?null:new s(t)},s.makeFromTransform=function(t,e){var n=b(t,e),i=n.key,l=n.binComponent;return new s((a={},a[i]=l,a));var a},s.prototype.merge=function(t){this.bins=S.__assign({},this.bins,t.bins),t.remove()},s.prototype.producedFields=function(){var a={};return l.vals(this.bins).forEach(function(e){e.as.forEach(function(e){return a[e]=!0})}),a},s.prototype.dependentFields=function(){var a={};return l.vals(this.bins).forEach(function(e){a[e.field]=!0}),a},s.prototype.assemble=function(){return l.flatten(l.vals(this.bins).map(function(a){var e=[],t=S.__assign({type:"bin",field:a.field,as:a.as,signal:a.signal},a.bin);return!a.bin.extent&&a.extentSignal&&(e.push({type:"extent",field:a.field,signal:a.extentSignal}),t.extent={signal:a.extentSignal}),e.push(t),a.formula&&e.push({type:"formula",expr:a.formula,as:a.formulaAs}),e}))},s}(h("./dataflow").DataFlowNode);t.BinNode=n},{"../../bin":15,"../../fielddef":101,"../../util":119,"../common":25,"../model":67,"./dataflow":32,tslib:6}],31:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("tslib"),i=o("../../util"),l=function(a){function e(e){var i=a.call(this)||this;return i.transform=e,i}return n.__extends(e,a),e.prototype.clone=function(){return new e(i.duplicate(this.transform))},e.prototype.producedFields=function(){var t={};return t[this.transform.as]=!0,t},e.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},e}(o("./dataflow").DataFlowNode);t.CalculateNode=l},{"../../util":119,"./dataflow":32,tslib:6}],32:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("tslib"),i=function(){function t(t){this.debugName=t,this._children=[],this._parent=null}return t.prototype.clone=function(){throw new Error("Cannot clone node")},t.prototype.producedFields=function(){return{}},t.prototype.dependentFields=function(){return{}},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t,t.addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return this._children.length},t.prototype.addChild=function(t){this._children.push(t)},t.prototype.removeChild=function(t){this._children.splice(this._children.indexOf(t),1)},t.prototype.remove=function(){for(var a=0,e=this._children;a<e.length;a++)e[a].parent=this._parent;this._parent.removeChild(this)},t.prototype.insertAsParentOf=function(a){var e=a.parent;e.removeChild(this),this.parent=e,a.parent=this},t.prototype.swapWithParent=function(){for(var a=this._parent,e=a.parent,t=0,n=this._children;t<n.length;t++)n[t].parent=a;this._children=[],a.removeChild(this),a.parent.removeChild(a),this.parent=e,a.parent=this},t}();t.DataFlowNode=i;var l=function(a){function e(e,o,n){var i=a.call(this,e)||this;return i.type=o,i.refCounts=n,i._source=i._name=e,!i.refCounts||i._name in i.refCounts||(i.refCounts[i._name]=0),i}return n.__extends(e,a),e.prototype.clone=function(){var t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t},e.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},e.prototype.isRequired=function(){return!!this.refCounts[this._name]},e.prototype.setSource=function(t){this._source=t},e}(i);t.OutputNode=l},{tslib:6}],33:[function(d,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=d("tslib"),p=d("../../channel"),n=d("../../log"),a=d("../../scale"),o=d("../../vega.schema"),s=d("../scale/domain"),i=function(l){function e(e,o,n){var i=l.call(this)||this;return i.model=e,i.name=o,i.data=n,e.facet.column&&(i.columnFields=[e.field(p.COLUMN)],i.columnName=e.getName("column_domain"),e.fieldDef(p.COLUMN).bin&&i.columnFields.push(e.field(p.COLUMN,{binSuffix:"end"}))),e.facet.row&&(i.rowFields=[e.field(p.ROW)],i.rowName=e.getName("row_domain"),e.fieldDef(p.ROW).bin&&i.rowFields.push(e.field(p.ROW,{binSuffix:"end"}))),i.childModel=e.child,i}return c.__extends(e,l),Object.defineProperty(e.prototype,"fields",{get:function(){var t=[];return this.columnFields&&(t=t.concat(this.columnFields)),this.rowFields&&(t=t.concat(this.rowFields)),t},enumerable:!0,configurable:!0}),e.prototype.getSource=function(){return this.name},e.prototype.getChildIndependentFieldsWithStep=function(){for(var l={},e=0,t=["x","y"];e<t.length;e++){var p=t[e],i=this.childModel.component.scales[p];if(i&&!i.merged){var r=i.get("type"),u=i.get("range");if(a.hasDiscreteDomain(r)&&o.isVgRangeStep(u)){var c=s.assembleDomain(this.childModel,p),m=s.getFieldFromDomain(c);m?l[p]=m:n.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return l},e.prototype.assembleRowColumnData=function(i,e,t){var n={},o="row"===i?"y":"x";return t[o]&&(n=e?{fields:["distinct_"+t[o]],ops:["max"],as:["distinct_"+t[o]]}:{fields:[t[o]],ops:["distinct"]}),{name:"row"===i?this.rowName:this.columnName,source:e||this.data,transform:[c.__assign({type:"aggregate",groupby:"row"===i?this.rowFields:this.columnFields},n)]}},e.prototype.assemble=function(){var a=[],e=null,o=this.getChildIndependentFieldsWithStep();if(this.columnName&&this.rowName&&(o.x||o.y)){e="cross_"+this.columnName+"_"+this.rowName;var n=[].concat(o.x?[o.x]:[],o.y?[o.y]:[]),l=n.map(function(){return"distinct"});a.push({name:e,source:this.data,transform:[{type:"aggregate",groupby:this.columnFields.concat(this.rowFields),fields:n,ops:l}]})}return this.columnName&&a.push(this.assembleRowColumnData("column",e,o)),this.rowName&&a.push(this.assembleRowColumnData("row",e,o)),a},e}(d("./dataflow").DataFlowNode);t.FacetNode=i},{"../../channel":16,"../../log":106,"../../scale":109,"../../vega.schema":121,"../scale/domain":73,"./dataflow":32,tslib:6}],34:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l("tslib"),s=l("../../filter"),i=l("../../util"),a=function(a){function e(e,o){var n=a.call(this)||this;return n.model=e,n.filter=o,n.expr=s.expression(n.model,n.filter,n),n}return n.__extends(e,a),e.prototype.clone=function(){return new e(this.model,i.duplicate(this.filter))},e.prototype.assemble=function(){return{type:"filter",expr:this.expr}},e}(l("./dataflow").DataFlowNode);t.FilterNode=a},{"../../filter":102,"../../util":119,"./dataflow":32,tslib:6}],35:[function(d,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d("tslib"),c=d("../../channel"),p=d("../../fielddef"),i=d("../../scale"),a=d("../../util"),o=function(o){function l(e){var a=o.call(this)||this;return a.fieldDefs=e,a}return n.__extends(l,o),l.prototype.clone=function(){return new l(n.__assign({},this.fieldDefs))},l.make=function(o){if("filter"!==o.config.invalidValues)return null;var e=o.reduceFieldDef(function(e,t,n){var l=c.isScaleChannel(n)&&o.getScaleComponent(n);if(l){var a=l.get("type");i.hasContinuousDomain(a)&&!t.aggregate&&(e[t.field]=t)}return e},{});return a.keys(e).length?new l(e):null},Object.defineProperty(l.prototype,"filter",{get:function(){return this.fieldDefs},enumerable:!0,configurable:!0}),l.prototype.assemble=function(){var o=this,e=a.keys(this.filter).reduce(function(e,t){var a=o.fieldDefs[t],n=p.field(a,{expr:"datum"});return null!==a&&(e.push(n+" !== null"),e.push("!isNaN("+n+")")),e},[]);return 0<e.length?{type:"filter",expr:e.join(" && ")}:null},l}(d("./dataflow").DataFlowNode);t.FilterInvalidNode=o},{"../../channel":16,"../../fielddef":101,"../../scale":109,"../../util":119,"./dataflow":32,tslib:6}],36:[function(m,e,t){"use strict";function g(a,e){var t="datum"+c.accessPath(a);if("number"===e)return"toNumber("+t+")";if("boolean"===e)return"toBoolean("+t+")";if("string"===e)return"toString("+t+")";if("date"===e)return"toDate("+t+")";if(0===e.indexOf("date:"))return"timeParse("+t+","+(n=e.slice(5,e.length))+")";if(0===e.indexOf("utc:")){var n=e.slice(4,e.length);return"utcParse("+t+","+n+")"}return o.warn(o.message.unrecognizedParse(e)),null}Object.defineProperty(t,"__esModule",{value:!0});var n=m("tslib"),r=m("../../aggregate"),a=m("../../fielddef"),i=m("../../filter"),o=m("../../log"),l=m("../../logical"),s=m("../../transform"),c=m("../../util"),u=m("../model"),d=function(d){function f(e){var a=d.call(this)||this;return a._parse={},a._parse=e,a}return n.__extends(f,d),f.prototype.clone=function(){return new f(c.duplicate(this.parse))},f.make=function(t){var d={},n={};(t.transforms||[]).forEach(function(t){s.isCalculate(t)?n[t.as]=!0:s.isFilter(t)&&l.forEachLeave(t.filter,function(t){(i.isEqualFilter(t)||i.isRangeFilter(t)||i.isOneOfFilter(t))&&t.timeUnit&&(d[t.field]="date")})},{}),(u.isUnitModel(t)||u.isFacetModel(t))&&t.forEachFieldDef(function(t){if(a.isTimeFieldDef(t))d[t.field]="date";else if(a.isNumberFieldDef(t)){if(n[t.field]||r.isCountingAggregateOp(t.aggregate))return;d[t.field]="number"}});var e=t.data;if(e&&e.format&&e.format.parse){var g=e.format.parse;c.keys(g).forEach(function(t){d[t]=g[t]})}var p=t.component.data.ancestorParse;return c.keys(p).forEach(function(t){d[t]===p[t]?delete d[t]:o.warn(o.message.differentParse(t,d[t],p[t]))}),0===c.keys(d).length?null:new f(d)},Object.defineProperty(f.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),f.prototype.merge=function(t){this._parse=n.__assign({},this._parse,t.parse),t.remove()},f.prototype.assembleFormatParse=function(){return this._parse},f.prototype.producedFields=function(){return c.toSet(c.keys(this.parse))},f.prototype.dependentFields=function(){return c.toSet(c.keys(this.parse))},f.prototype.assembleTransforms=function(){var a=this;return c.keys(this._parse).map(function(e){var i=g(e,a._parse[e]);return i?{type:"formula",expr:i,as:e}:null}).filter(function(t){return null!==t})},f}(m("./dataflow").DataFlowNode);t.ParseNode=d},{"../../aggregate":13,"../../fielddef":101,"../../filter":102,"../../log":106,"../../logical":107,"../../transform":117,"../../util":119,"../model":67,"./dataflow":32,tslib:6}],37:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("tslib"),i=o("../../selection"),l=function(a){function e(){return a.call(this)||this}return n.__extends(e,a),e.prototype.clone=function(){return new e},e.prototype.producedFields=function(){return t={},t[i.SELECTION_ID]=!0,t;var t},e.prototype.assemble=function(){return{type:"identifier",as:i.SELECTION_ID}},e}(o("./dataflow").DataFlowNode);t.IdentifierNode=l},{"../../selection":110,"./dataflow":32,tslib:6}],38:[function(d,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d("tslib"),i=d("vega-util"),r=d("../../log"),p=d("./dataflow"),o=d("./source"),a=function(a){function s(e,o){var n=a.call(this)||this;return n.transform=e,n.secondary=o,n}return n.__extends(s,a),s.make=function(t,e,n){var i=t.component.data.sources,r=new o.SourceNode(e.from.data),a=i[r.hash()];a||(i[r.hash()]=r,a=r);var l=t.getName("lookup_"+n),d=new p.OutputNode(l,"lookup",t.component.data.outputNodeRefCounts);return d.parent=a,t.component.data.outputNodes[l]=d,new s(e,d.getSource())},s.prototype.producedFields=function(){return i.toSet(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},s.prototype.assemble=function(){var a;if(this.transform.from.fields)a=n.__assign({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var e=this.transform.as;i.isString(e)||(r.warn(r.message.NO_FIELDS_NEEDS_AS),e="_lookup"),a={as:[e]}}return n.__assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},a,this.transform.default?{default:this.transform.default}:{})},s}(p.DataFlowNode);t.LookupNode=a},{"../../log":106,"./dataflow":32,"./source":42,tslib:6,"vega-util":11}],39:[function(h,e,t){"use strict";function n(n){function e(o){if(!(o instanceof f.FacetNode)){var i=o.clone();if(i instanceof c.OutputNode){var s=t.FACET_SCALE_PREFIX+i.getSource();i.setSource(s),n.model.component.data.outputNodes[s]=i}else(i instanceof u.AggregateNode||i instanceof m.StackNode)&&i.addDimensions(n.fields);return l.flatten(o.children.map(e)).forEach(function(t){return t.parent=i}),[i]}return l.flatten(o.children.map(e))}return e}function i(a){if(!(a instanceof f.FacetNode))a.children.forEach(i);else if(1!==a.numChildren()||a.children[0]instanceof c.OutputNode)r(a.model.component.data.main),l.flatten(a.children.map(n(a))).forEach(function(e){return e.parent=a.model.component.data.main});else{var e=a.children[0];(e instanceof u.AggregateNode||e instanceof m.StackNode)&&e.addDimensions(a.fields),e.swapWithParent(),i(a)}}function r(a){if(a instanceof c.OutputNode&&a.type===s.MAIN&&1===a.numChildren()){var e=a.children[0];e instanceof f.FacetNode||(e.swapWithParent(),r(a))}}function a(t){t instanceof d.FilterInvalidNode&&l.every(l.vals(t.filter),function(t){return null===t})&&t.remove(),t instanceof c.OutputNode&&!t.isRequired()&&t.remove(),t.children.forEach(a)}function o(a){function i(a){0===a.numChildren()?t.push(a):a.children.forEach(i)}var t=[];return a.forEach(i),t}Object.defineProperty(t,"__esModule",{value:!0});var s=h("../../data"),l=h("../../util"),u=h("./aggregate"),c=h("./dataflow"),f=h("./facet"),d=h("./filterinvalid"),p=h("./optimizers"),m=h("./stack");t.FACET_SCALE_PREFIX="scale_",t.optimizeDataflow=function(n){var e=l.vals(n.sources);e.forEach(a),o(e=e.filter(function(t){return 0<t.numChildren()})).forEach(p.iterateFromLeaves(p.removeUnusedSubtrees)),o(e=e.filter(function(t){return 0<t.numChildren()})).forEach(p.iterateFromLeaves(p.moveParseUp)),o(e).forEach(p.removeDuplicateTimeUnits),e.forEach(i),l.keys(n.sources).forEach(function(e){0===n.sources[e].numChildren()&&delete n.sources[e]})}},{"../../data":97,"../../util":119,"./aggregate":28,"./dataflow":32,"./facet":33,"./filterinvalid":35,"./optimizers":40,"./stack":43}],40:[function(d,e,t){"use strict";function n(a){function e(t){if(!(t instanceof s.SourceNode)){var n=t.parent;a(t)&&e(n)}}return e}Object.defineProperty(t,"__esModule",{value:!0});var i=d("tslib"),r=d("../../util"),a=d("./dataflow"),o=d("./formatparse"),s=d("./source"),l=d("./timeunit");t.iterateFromLeaves=n,t.moveParseUp=function(a){var e=a.parent;if(a instanceof o.ParseNode){if(e instanceof s.SourceNode)return!1;if(1<e.numChildren())return!0;if(e instanceof o.ParseNode)e.merge(a);else{if(r.hasIntersection(e.producedFields(),a.dependentFields()))return!0;a.swapWithParent()}}return!0},t.removeUnusedSubtrees=function(t){return!(t instanceof a.OutputNode||0<t.numChildren()||(t.remove(),0))},t.removeDuplicateTimeUnits=function(a){var o={};return n(function(t){if(t instanceof l.TimeUnitNode){var e=t.producedFields();r.keys(e).every(function(t){return!!o[t]})?t.remove():o=i.__assign({},o,e)}return!0})(a)}},{"../../util":119,"./dataflow":32,"./formatparse":36,"./source":42,"./timeunit":44,tslib:6}],41:[function(k,e,t){"use strict";function U(a,e){if(a.data||!a.parent){var t=new v.SourceNode(a.data),n=t.hash();return n in e?e[n]:(e[n]=t,t)}return a.parent.component.data.facetRoot?a.parent.component.data.facetRoot:a.parent.component.data.main}function n(f){function y(t){i?t.parent?p.insertAsParentOf(t):t.parent=p:i=t.parent||t,p=t}var t,p,i=null,v=0;return f.transforms.forEach(function(n){if(c.isCalculate(n))t=new g.CalculateNode(n);else if(c.isFilter(n)){var i={},r=n.filter,x=null;l.isEqualFilter(r)?x=r.equal:l.isRangeFilter(r)?x=r.range[0]:l.isOneOfFilter(r)&&(x=(r.oneOf||r.in)[0]),x&&(o.isDateTime(x)?i[r.field]="date":a.isNumber(x)?i[r.field]="number":a.isString(x)&&(i[r.field]="string")),0<u.keys(i).length&&y(new b.ParseNode(i)),t=new h.FilterNode(f,n.filter)}else if(c.isBin(n))t=m.BinNode.makeFromTransform(n,{model:f});else if(c.isTimeUnit(n))t=E.TimeUnitNode.makeFromTransform(n);else if(c.isAggregate(n))t=d.AggregateNode.makeFromTransform(n),H.requiresSelectionId(f)&&(y(t),t=new S.IdentifierNode);else{if(!c.isLookup(n))return void s.warn(s.message.invalidTransformIgnored(n));t=_.LookupNode.make(f,n,v++)}y(t)}),{first:i,last:t}}Object.defineProperty(t,"__esModule",{value:!0});var i=k("tslib"),a=k("vega-util"),r=k("../../data"),o=k("../../datetime"),l=k("../../filter"),s=k("../../log"),c=k("../../transform"),u=k("../../util"),z=k("../model"),H=k("../selection/selection"),d=k("./aggregate"),m=k("./bin"),g=k("./calculate"),p=k("./dataflow"),f=k("./facet"),h=k("./filter"),y=k("./filterinvalid"),b=k("./formatparse"),S=k("./indentifier"),_=k("./lookup"),v=k("./source"),x=k("./stack"),E=k("./timeunit");t.parseTransformArray=n,t.parseData=function(a){var e=U(a,a.component.data.sources),t=a.component.data.outputNodes,s=a.component.data.outputNodeRefCounts,g=e;H.requiresSelectionId(a)&&!a.parent&&((D=new S.IdentifierNode).parent=g,g=D);var l=a.parent&&z.isLayerModel(a.parent);if((z.isUnitModel(a)||z.isFacetModel(a))&&l&&(v=m.BinNode.makeBinFromEncoding(a))&&(v.parent=g,g=v),0<a.transforms.length){var h=n(a),c=h.first,T=h.last;c.parent=g,g=T}var w=b.ParseNode.make(a);if(w&&(w.parent=g,g=w),z.isUnitModel(a)||z.isFacetModel(a)){if(!l){var v=m.BinNode.makeBinFromEncoding(a);v&&(v.parent=g,g=v)}var _=E.TimeUnitNode.makeFromEncoding(a);_&&(_.parent=g,g=_)}var O=a.getName(r.RAW),N=new p.OutputNode(O,r.RAW,s);if(t[O]=N,N.parent=g,g=N,z.isUnitModel(a)){var j=d.AggregateNode.makeFromEncoding(a);if(j&&(j.parent=g,g=j,H.requiresSelectionId(a))){var D=new S.IdentifierNode;D.parent=g,g=D}var C=x.StackNode.make(a);C&&(C.parent=g,g=C)}if(z.isUnitModel(a)){var A=y.FilterInvalidNode.make(a);A&&(A.parent=g,g=A)}var P=a.getName(r.MAIN),M=new p.OutputNode(P,r.MAIN,s);t[P]=M,M.parent=g,g=M;var B=null;if(z.isFacetModel(a)){var W=a.getName("facet");B=new f.FacetNode(a,W,M.getSource()),t[W]=B,B.parent=g,g=B}var L=i.__assign({},a.component.data.ancestorParse,w?w.parse:{});return i.__assign({},a.component.data,{outputNodes:t,outputNodeRefCounts:s,raw:N,main:M,facetRoot:B,ancestorParse:L})}},{"../../data":97,"../../datetime":98,"../../filter":102,"../../log":106,"../../transform":117,"../../util":119,"../model":67,"../selection/selection":80,"./aggregate":28,"./bin":30,"./calculate":31,"./dataflow":32,"./facet":33,"./filter":34,"./filterinvalid":35,"./formatparse":36,"./indentifier":37,"./lookup":38,"./source":42,"./stack":43,"./timeunit":44,tslib:6,"vega-util":11}],42:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=l("tslib"),i=l("../../data"),n=l("../../util"),a=function(a){function e(e){var r=a.call(this)||this;if(e=e||{name:"source"},i.isInlineData(e))r._data={values:e.values};else if(!i.isUrlData(e))i.isNamedData(e)&&(r._name=e.name,r._data={});else if(r._data={url:e.url},e.format||(e.format={}),!e.format||!e.format.type){var c=/(?:\.([^.]+))?$/.exec(e.url)[1];n.contains(["json","csv","tsv","topojson"],c)||(c="json"),e.format.type=c}if(!i.isNamedData(e)&&e.format){var o=e.format,s=(o.parse,d.__rest(o,["parse"]));r._data.format=s}return r}return d.__extends(e,a),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.hasName=function(){return!!this._name},Object.defineProperty(e.prototype,"dataName",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{set:function(){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),e.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},e.prototype.hash=function(){return i.isInlineData(this._data)?(this._hash||(this._hash=n.hash(this._data)),this._hash):i.isUrlData(this._data)?n.hash([this._data.url,this._data.format]):this._name},e.prototype.assemble=function(){return d.__assign({name:this._name},this._data,{transform:[]})},e}(l("./dataflow").DataFlowNode);t.SourceNode=a},{"../../data":97,"../../util":119,"./dataflow":32,tslib:6}],43:[function(d,e,t){"use strict";function c(t){return t.stack.stackBy.reduce(function(o,e){var t=e.fieldDef,n=a.field(t);return n&&o.push(n),o},[])}Object.defineProperty(t,"__esModule",{value:!0});var n=d("tslib"),i=d("vega-util"),a=d("../../fielddef"),o=d("../../util"),p=d("../common"),l=function(l){function d(e){var a=l.call(this)||this;return a._stack=e,a}return n.__extends(d,l),d.prototype.clone=function(){return new d(o.duplicate(this._stack))},d.make=function(t){var e=t.stack;if(!e)return null;var i;e.groupbyChannel&&(i=t.fieldDef(e.groupbyChannel));var l,u=c(t),m=t.encoding.order;return l=m?p.sortParams(m):u.reduce(function(a,e){return a.field.push(e),a.order.push("descending"),a},{field:[],order:[]}),new d({dimensionFieldDef:i,field:t.field(e.fieldChannel),facetby:[],stackby:u,sort:l,offset:e.offset,impute:e.impute})},Object.defineProperty(d.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),d.prototype.addDimensions=function(t){this._stack.facetby=this._stack.facetby.concat(t)},d.prototype.dependentFields=function(){var a={};a[this._stack.field]=!0,this.getGroupbyFields().forEach(function(e){return a[e]=!0}),this._stack.facetby.forEach(function(e){return a[e]=!0});var e=this._stack.sort.field;return i.isArray(e)?e.forEach(function(e){return a[e]=!0}):a[e]=!0,a},d.prototype.producedFields=function(){var t={};return t[this._stack.field+"_start"]=!0,t[this._stack.field+"_end"]=!0,t},d.prototype.getGroupbyFields=function(){var i=this._stack,e=i.dimensionFieldDef,t=i.impute;return e?e.bin?t?[a.field(e,{binSuffix:"mid"})]:[a.field(e,{}),a.field(e,{binSuffix:"end"})]:[a.field(e)]:[]},d.prototype.assemble=function(){var o=[],e=this._stack,t=e.facetby,n=e.field,d=e.dimensionFieldDef,r=e.impute,p=e.offset,m=e.sort,g=e.stackby;if(r&&d){var f=d?a.field(d,{binSuffix:"mid"}):void 0;d.bin&&o.push({type:"formula",expr:"("+a.field(d,{expr:"datum"})+"+"+a.field(d,{expr:"datum",binSuffix:"end"})+")/2",as:f}),o.push({type:"impute",field:n,groupby:g,key:f,method:"value",value:0})}return o.push({type:"stack",groupby:this.getGroupbyFields().concat(t),field:n,sort:m,as:[n+"_start",n+"_end"],offset:p}),o},d}(d("./dataflow").DataFlowNode);t.StackNode=l},{"../../fielddef":101,"../../util":119,"../common":25,"./dataflow":32,tslib:6,"vega-util":11}],44:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l("tslib"),i=l("../../fielddef"),r=l("../../timeunit"),a=l("../../util"),o=function(o){function l(e){var a=o.call(this)||this;return a.formula=e,a}return n.__extends(l,o),l.prototype.clone=function(){return new l(a.duplicate(this.formula))},l.makeFromEncoding=function(t){var e=t.reduceFieldDef(function(a,e){if(e.timeUnit){var t=i.field(e);a[t]={as:t,timeUnit:e.timeUnit,field:e.field}}return a},{});return 0===a.keys(e).length?null:new l(e)},l.makeFromTransform=function(t){return new l((e={},e[t.field]={as:t.as,timeUnit:t.timeUnit,field:t.field},e));var e},l.prototype.merge=function(t){this.formula=n.__assign({},this.formula,t.formula),t.remove()},l.prototype.producedFields=function(){var n={};return a.vals(this.formula).forEach(function(e){n[e.as]=!0}),n},l.prototype.dependentFields=function(){var n={};return a.vals(this.formula).forEach(function(e){n[e.field]=!0}),n},l.prototype.assemble=function(){return a.vals(this.formula).map(function(t){return{type:"formula",as:t.as,expr:r.fieldExpr(t.timeUnit,t.field)}})},l}(l("./dataflow").DataFlowNode);t.TimeUnitNode=o},{"../../fielddef":101,"../../timeunit":114,"../../util":119,"./dataflow":32,tslib:6}],45:[function(S,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var x=S("tslib"),i=S("../channel"),n=S("../encoding"),E=S("../fielddef"),o=S("../log"),s=S("../scale"),a=S("../util"),l=S("../vega.schema"),c=S("./buildmodel"),r=S("./data/assemble"),d=S("./data/parse"),p=S("./layout/header"),u=S("./layoutsize/parse"),m=S("./model"),g=S("./repeater"),h=S("./resolve"),f=S("./scale/domain"),y=function(m){function y(e,l,n,i,r){var a=m.call(this,e,l,n,r,e.resolve)||this;a.type="facet",a.child=c.buildModel(e.spec,a,a.getName("child"),void 0,i,r,!1),a.children=[a.child];var o=g.replaceRepeaterInFacet(e.facet,i);return a.facet=a.initFacet(o),a}return x.__extends(y,m),y.prototype.initFacet=function(t){return n.reduce(t,function(l,e,t){return a.contains([i.ROW,i.COLUMN],t)?void 0===e.field?(o.warn(o.message.emptyFieldDef(e,t)),l):(l[t]=E.normalize(e,t),l):(o.warn(o.message.incompatibleChannel(t,"facet")),l)},{})},y.prototype.channelHasField=function(t){return!!this.facet[t]},y.prototype.fieldDef=function(t){return this.facet[t]},y.prototype.parseData=function(){this.component.data=d.parseData(this),this.child.parseData()},y.prototype.parseLayoutSize=function(){u.parseChildrenLayoutSize(this)},y.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},y.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()},y.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},y.prototype.parseHeader=function(a){if(this.channelHasField(a)){var e=this.facet[a],o=e.header||{},n=void 0===o.title?E.title(e,this.config):o.title;this.child.component.layoutHeaders[a].title&&(n+=" / "+this.child.component.layoutHeaders[a].title,this.child.component.layoutHeaders[a].title=null),this.component.layoutHeaders[a]={title:n,facetFieldDef:e,header:[this.makeHeaderComponent(a,!0)]}}},y.prototype.makeHeaderComponent=function(a,e){var i="row"===a?"height":"width";return{labels:e,sizeSignal:this.child.component.layoutSize.get(i)?this.child.getSizeSignalRef(i):void 0,axes:[]}},y.prototype.mergeChildAxis=function(d){var e=this.child;if(e.component.axes[d]){var t=this.component,n=t.layoutHeaders,i=t.resolve;if(i.axis[d]=h.parseGuideResolve(i,d),"shared"===i.axis[d])for(var r="x"===d?"column":"row",a=n[r],o=0,s=e.component.axes[d];o<s.length;o++){var l=s[o],u=l.main,c=p.getHeaderType(u.get("orient"));a[c]=a[c]||[this.makeHeaderComponent(r,!1)],a[c][0].axes.push(u.combine()),delete l.main}}},y.prototype.assembleSelectionTopLevelSignals=function(t){return this.child.assembleSelectionTopLevelSignals(t)},y.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},y.prototype.assembleSelectionData=function(t){return this.child.assembleSelectionData(t)},y.prototype.getLayoutBandMixins=function(l){for(var e={},t="header"===l?"headerBand":"footerBand",n=0,i=["row","column"];n<i.length;n++){var r=i[n],a=this.component.layoutHeaders[r][l];if(a&&a[0]){var o="row"===r?"height":"width";this.child.component.layoutSize.get(o)||(e[t]=e[t]||{},e[t][r]=.5)}}return e},y.prototype.assembleLayout=function(){var t=this.channelHasField("column")?this.columnDistinctSignal():1;return x.__assign({padding:{row:10,column:10}},this.getLayoutBandMixins("header"),this.getLayoutBandMixins("footer"),{offset:10,columns:t,bounds:"full",align:"all"})},y.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},y.prototype.columnDistinctSignal=function(){return this.parent&&this.parent instanceof y?void 0:{signal:"length(data('"+this.getName("column_domain")+"'))"}},y.prototype.assembleGroup=function(e){return this.parent&&this.parent instanceof y?x.__assign({},this.channelHasField("column")?{encode:{update:{columns:{field:E.field(this.facet.column,{prefix:"distinct"})}}}}:{},m.prototype.assembleGroup.call(this,e)):m.prototype.assembleGroup.call(this,e)},y.prototype.getCardinalityAggregateForChild=function(){var t=[],c=[];if(this.child instanceof y)this.child.channelHasField("column")&&(t.push(E.field(this.child.facet.column)),c.push("distinct"));else for(var g=0,i=["x","y"];g<i.length;g++){var r=i[g],a=this.child.component.scales[r];if(a&&!a.merged){var u=a.get("type"),h=a.get("range");if(s.hasDiscreteDomain(u)&&l.isVgRangeStep(h)){var d=f.assembleDomain(this.child,r),p=f.getFieldFromDomain(d);p?(t.push(p),c.push("distinct")):o.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return t.length?{fields:t,ops:c}:void 0},y.prototype.assembleMarks=function(){var d=this,e=d.child,t=d.facet,n=this.component.data.facetRoot,a=r.assembleFacetData(n),g=this.channelHasField(i.ROW),s=this.channelHasField(i.COLUMN),l=e.assembleLayoutSize(),h={};g&&s&&(h.aggregate={cross:!0});var c=this.getCardinalityAggregateForChild();c&&(h.aggregate=x.__assign({},h.aggregate,c));var f=e.assembleTitle(),y=e.assembleGroupStyle();return[x.__assign({name:this.getName("cell"),type:"group"},f?{title:f}:{},y?{style:y}:{},{from:{facet:x.__assign({name:n.name,data:n.data,groupby:[].concat(g?[this.field(i.ROW)]:[],s?[this.field(i.COLUMN)]:[])},h)},sort:{field:[].concat(g?[this.field(i.ROW,{expr:"datum"})]:[],s?[this.field(i.COLUMN,{expr:"datum"})]:[]),order:[].concat(g?[t.row.sort||"ascending"]:[],s?[t.column.sort||"ascending"]:[])}},0<a.length?{data:a}:{},l?{encode:{update:l}}:{},e.assembleGroup())]},y.prototype.getMapping=function(){return this.facet},y}(m.ModelWithField);t.FacetModel=y},{"../channel":16,"../encoding":99,"../fielddef":101,"../log":106,"../scale":109,"../util":119,"../vega.schema":121,"./buildmodel":24,"./data/assemble":29,"./data/parse":41,"./layout/header":47,"./layoutsize/parse":49,"./model":67,"./repeater":69,"./resolve":70,"./scale/domain":73,tslib:6}],46:[function(h,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=h("tslib"),i=h("../log"),r=h("../spec"),a=h("../util"),n=h("./axis/parse"),o=h("./data/parse"),l=h("./layoutsize/assemble"),s=h("./layoutsize/parse"),c=h("./legend/assemble"),u=h("./model"),d=h("./selection/selection"),_=h("./unit"),p=function(m){function g(e,t,a,n,o,l,s){var c=m.call(this,e,t,a,l,e.resolve)||this;c.type="layer";var d=y.__assign({},n,e.width?{width:e.width}:{},e.height?{height:e.height}:{});return c.initSize(d),c.children=e.layer.map(function(t,e){if(r.isLayerSpec(t))return new g(t,c,c.getName("layer_"+e),d,o,l,s);if(r.isUnitSpec(t))return new _.UnitModel(t,c,c.getName("layer_"+e),d,o,l,s);throw new Error(i.message.INVALID_SPEC)}),c}return y.__extends(g,m),g.prototype.parseData=function(){this.component.data=o.parseData(this);for(var a=0,e=this.children;a<e.length;a++)e[a].parseData()},g.prototype.parseLayoutSize=function(){s.parseLayerLayoutSize(this)},g.prototype.parseSelection=function(){var i=this;this.component.selection={};for(var e=0,t=this.children;e<t.length;e++)!function(e){e.parseSelection(),a.keys(e.component.selection).forEach(function(t){i.component.selection[t]=e.component.selection[t]})}(t[e])},g.prototype.parseMarkGroup=function(){for(var a=0,e=this.children;a<e.length;a++)e[a].parseMarkGroup()},g.prototype.parseAxisAndHeader=function(){n.parseLayerAxis(this)},g.prototype.assembleSelectionTopLevelSignals=function(t){return this.children.reduce(function(a,e){return e.assembleSelectionTopLevelSignals(a)},t)},g.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(a,e){return a.concat(e.assembleSelectionSignals())},[])},g.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(a,e){return a.concat(e.assembleLayoutSignals())},l.assembleLayoutSignals(this))},g.prototype.assembleSelectionData=function(){return this.children.reduce(function(a,e){return e.assembleSelectionData(a)},[])},g.prototype.assembleTitle=function(){var e=m.prototype.assembleTitle.call(this);if(e)return e;for(var t=0,a=this.children;t<a.length;t++)if(e=a[t].assembleTitle())return e},g.prototype.assembleLayout=function(){return null},g.prototype.assembleMarks=function(){return d.assembleLayerSelectionMarks(this,a.flatten(this.children.map(function(t){return t.assembleMarks()})))},g.prototype.assembleLegends=function(){return this.children.reduce(function(a,e){return a.concat(e.assembleLegends())},c.assembleLegends(this))},g}(u.Model);t.LayerModel=p},{"../log":106,"../spec":112,"../util":119,"./axis/parse":21,"./data/parse":41,"./layoutsize/assemble":48,"./layoutsize/parse":49,"./legend/assemble":50,"./model":67,"./selection/selection":80,"./unit":91,tslib:6}],47:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=o("tslib"),i=o("../../fielddef"),n=o("../common");t.HEADER_CHANNELS=["row","column"],t.HEADER_TYPES=["header","footer"],t.getHeaderType=function(t){return"top"===t||"left"===t?"header":"footer"},t.getTitleGroup=function(a,e){var t=a.component.layoutHeaders[e].title,i="row"===e?"vertical":void 0;return{name:a.getName(e+"_title"),role:e+"-title",type:"group",marks:[{type:"text",role:e+"-title-text",style:"guide-title",encode:{update:g.__assign({align:{value:"center"},text:{value:t}},"vertical"===i?{angle:{value:270}}:{})}}]}},t.getHeaderGroup=function(a,e,t,r,o){if(o){var s=null;if(r.facetFieldDef&&o.labels){var h=r.facetFieldDef,u=h.header?h.header.format:void 0;s={text:n.formatSignalRef(h,u,"parent",a.config),offset:10,orient:"row"===e?"left":"top",style:"guide-label",encode:{update:g.__assign({fontWeight:{value:"normal"},angle:{value:0},fontSize:{value:10}},"row"===e?{align:{value:"right"},baseline:{value:"middle"}}:{})}}}var c=o.axes,y=c&&0<c.length;if(s||y){var d="row"===e?"height":"width";return g.__assign({name:a.getName(e+"_"+t),type:"group",role:e+"-"+t},r.facetFieldDef?{from:{data:a.getName(e+"_domain")},sort:{field:i.field(r.facetFieldDef,{expr:"datum"}),order:r.facetFieldDef.header&&r.facetFieldDef.sort||"ascending"}}:{},s?{title:s}:{},o.sizeSignal?{encode:{update:(p={},p[d]=o.sizeSignal,p)}}:{},y?{axes:c}:{})}}return null;var p}},{"../../fielddef":101,"../common":25,tslib:6}],48:[function(d,e,t){"use strict";function n(l,e){var t="width"===e?"x":"y",n=l.component.layoutSize.get(e);if(!n||"merged"===n)return[];var m=l.getSizeSignalRef(e).signal;if("range-step"===n){var g=l.getScaleComponent(t);if(g){var c=g.get("type"),f=g.get("range");if(a.hasDiscreteDomain(c)&&o.isVgRangeStep(f)){var d=l.scaleName(t);return s.isFacetModel(l.parent)&&"independent"===l.parent.component.resolve.scale[t]?[i(d,f)]:[i(d,f),{name:m,update:r(d,g,"domain('"+d+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}return[{name:m,value:n}]}function i(a,e){return{name:a+"_step",value:e.step}}function r(l,e,t){var n=e.get("type"),i=e.get("padding"),s=e.get("paddingOuter");s=void 0===s?i:s;var r=e.get("paddingInner");return r="band"===n?void 0===r?i:r:1,"bandspace("+t+", "+r+", "+s+") * "+l+"_step"}Object.defineProperty(t,"__esModule",{value:!0});var a=d("../../scale"),o=d("../../vega.schema"),s=d("../model");t.assembleLayoutSignals=function(t){return[].concat(n(t,"width"),n(t,"height"))},t.sizeSignals=n,t.sizeExpr=r},{"../../scale":109,"../../vega.schema":121,"../model":67}],49:[function(d,e,t){"use strict";function n(a){i(a);var e=a.component.layoutSize;e.setWithExplicit("width",r(a,"width")),e.setWithExplicit("height",r(a,"height"))}function i(a){for(var e=0,t=a.children;e<t.length;e++)t[e].parseLayoutSize()}function r(p,e){for(var t,n="width"===e?"x":"y",i=p.component.resolve,r=0,u=p.children;r<u.length;r++){var m=(l=u[r]).component.layoutSize.getWithExplicit(e),s=i.scale[n];if("independent"===s&&"range-step"===m.value){t=void 0;break}if(t){if("independent"===s&&t.value!==m.value){t=void 0;break}t=o.mergeValuesWithExplicit(t,m,e,"",o.defaultTieBreaker)}else t=m}if(t){for(var l,d=0,c=p.children;d<c.length;d++)l=c[d],p.renameLayoutSize(l.getName(e),p.getName(e)),l.component.layoutSize.set(e,"merged",!1);return t}return{explicit:!1,value:void 0}}function a(l,e){var t="width"===e?"x":"y",n=l.config,i=l.getScaleComponent(t);if(i){var r=i.get("type"),a=i.get("range");return c.hasDiscreteDomain(r)&&s.isVgRangeStep(a)?"range-step":n.view[e]}return"width"===e&&"text"===l.mark()?n.scale.textXRangeStep:n.scale.rangeStep||c.defaultScaleConfig.rangeStep}Object.defineProperty(t,"__esModule",{value:!0});var c=d("../../scale"),s=d("../../vega.schema"),o=d("../split");t.parseLayerLayoutSize=n,t.parseRepeatLayoutSize=n,t.parseConcatLayoutSize=function(a){i(a);var e=a.component.layoutSize,t=a.isVConcat?"width":"height";e.setWithExplicit(t,r(a,t))},t.parseChildrenLayoutSize=i,t.parseUnitLayoutSize=function(o){var e=o.component.layoutSize;if(!e.explicit.width){var t=a(o,"width");e.set("width",t,!1)}if(!e.explicit.height){var n=a(o,"height");e.set("height",n,!1)}}},{"../../scale":109,"../../vega.schema":121,"../split":90}],50:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=o("json-stable-stringify"),i=o("../../util"),p=o("./parse");t.assembleLegends=function(a){var e=a.component.legends,t={};return i.keys(e).forEach(function(n){var i=a.getScaleComponent(n),o=d(i.domains);if(t[o])for(var s,r=0,l=t[o];r<l.length;r++)s=l[r],p.mergeLegendComponent(s,e[n])||t[o].push(e[n]);else t[o]=[e[n].clone()]}),i.flatten(i.vals(t)).map(function(t){return t.combine()})}},{"../../util":119,"./parse":53,"json-stable-stringify":1}],51:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("tslib"),i=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return n.__extends(e,a),e}(a("../split").Split);t.LegendComponent=i},{"../split":90,tslib:6}],52:[function(p,e,t){"use strict";function m(i){if(a.isValueDef(i)){if(a.hasConditionalValueDef(i)){var e=n.isArray(i.condition)?i.condition.map(function(t){return t.value}):[i.condition.value];return l.apply(null,[i.value].concat(e))}return i.value}}Object.defineProperty(t,"__esModule",{value:!0});var _=p("tslib"),n=p("vega-util"),i=p("../../channel"),a=p("../../fielddef"),o=p("../../mark"),s=p("../../scale"),r=p("../../util"),c=p("../common"),u=p("../mark/mixins");t.symbols=function(l,e,t,n,s){if("gradient"!==s){var d={},p=t.mark();switch(p){case o.BAR:case o.TICK:case o.TEXT:d.shape={value:"square"};break;case o.CIRCLE:case o.SQUARE:d.shape={value:p};break;case o.POINT:case o.LINE:case o.AREA:}var f=t.markDef.filled,g=n===i.COLOR?r.without(o.FILL_STROKE_CONFIG,[f?"fill":"stroke","strokeDash","strokeDashOffset"]):o.FILL_STROKE_CONFIG;if(g=r.without(g,["strokeDash","strokeDashOffset"]),c.applyMarkConfig(d,t,g),n!==i.COLOR){var h=u.color(t);h.fill&&(h.fill.field||"transparent"===h.fill.value)&&delete h.fill,h.stroke&&(h.stroke.field||"transparent"===h.stroke.value)&&delete h.stroke,d=_.__assign({},d,h)}if(n!==i.SHAPE){var S=t.encoding.shape;a.isValueDef(S)&&(d.shape={value:S.value})}if(n!==i.OPACITY){var y=m(t.encoding.opacity);y&&(d.opacity={value:y})}return d=_.__assign({},d,e),0<r.keys(d).length?d:void 0}},t.gradient=function(i,e,t,n,a){var o={};if("gradient"===a){var s=m(t.encoding.opacity);s&&(o.opacity={value:s})}return o=_.__assign({},o,e),0<r.keys(o).length?o:void 0},t.labels=function(u,e,t,n){var i=t.legend(n),o=t.config,l={};if(a.isTimeFieldDef(u)){var d=t.getScaleComponent(n).get("type")===s.ScaleType.UTC;e=_.__assign({text:{signal:c.timeFormatExpression("datum.value",u.timeUnit,i.format,o.legend.shortTimeLabels,o.timeFormat,d)}},e)}return l=_.__assign({},l,e),0<r.keys(l).length?l:void 0}},{"../../channel":16,"../../fielddef":101,"../../mark":108,"../../scale":109,"../../util":119,"../common":25,"../mark/mixins":60,tslib:6,"vega-util":11}],53:[function(x,e,t){"use strict";function E(t){t.component.legends=r.isUnitModel(t)?n(t):i(t)}function n(i){return[l.COLOR,l.SIZE,l.SHAPE,l.OPACITY].reduce(function(e,t){return i.legend(t)&&(e[t]=a(i,t)),e},{})}function N(a,e){switch(e){case l.COLOR:var t=a.scaleName(l.COLOR);return a.markDef.filled?{fill:t}:{stroke:t};case l.SIZE:return{size:a.scaleName(l.SIZE)};case l.SHAPE:return{shape:a.scaleName(l.SHAPE)};case l.OPACITY:return{opacity:a.scaleName(l.OPACITY)};}return null}function a(p,e){var t=p.fieldDef(e),s=p.legend(e),u=new f.LegendComponent({},N(p,e));c.LEGEND_PROPERTIES.forEach(function(t){var n=T(t,s,e,p);if(void 0!==n){var a="values"===t?!!s.values:n===s[t];(a||void 0===p.config.legend[t])&&u.set(t,n,a)}});var n=s.encoding||{},a=["labels","legend","title","symbols","gradient"].reduce(function(o,i){var a=h[i]?h[i](t,n[i],p,e,u.get("type")):n[i];return void 0!==a&&0<d.keys(a).length&&(o[i]={update:a}),o},{});return 0<d.keys(a).length&&u.set("encode",a,!!s.encoding),u}function T(a,e,t,n){var i=n.fieldDef(t);return"format"===a?p.numberFormat(i,e.format,n.config):"title"===a?p.getSpecifiedOrDefaultValue(e.title,s.title(i,n.config)):"values"===a?y.values(e):"type"===a?p.getSpecifiedOrDefaultValue(e.type,y.type(i.type,t,n.getScaleComponent(t).get("type"))):e[a]}function i(l){for(var e=l.component,s=e.legends,c=e.resolve,t=0,a=l.children;t<a.length;t++)!function(e){E(e),d.keys(e.component.legends).forEach(function(t){c.legend[t]=u.parseGuideResolve(l.component.resolve,t),"shared"===c.legend[t]&&(s[t]=o(s[t],e.component.legends[t]),s[t]||(c.legend[t]="independent",delete s[t]))})}(a[t]);return d.keys(s).forEach(function(e){for(var t,a=0,n=l.children;a<n.length;a++)t=n[a],t.component.legends[e]&&"shared"===c.legend[e]&&delete t.component.legends[e]}),s}function o(l,s){if(!l)return s.clone();var t=l.getWithExplicit("orient"),n=s.getWithExplicit("orient");if(!t.explicit||!n.explicit||t.value===n.value){for(var i=!1,r=0,a=c.VG_LEGEND_PROPERTIES;r<a.length;r++)!function(a){var e=g.mergeValuesWithExplicit(l.getWithExplicit(a),s.getWithExplicit(a),a,"legend",function(n,e){return"title"===a?p.titleMerger(n,e):"type"===a?(i=!0,m.makeImplicit("symbol")):g.defaultTieBreaker(n,e,a,"legend")});l.setWithExplicit(a,e)}(a[r]);return i&&(((l.implicit||{}).encode||{}).gradient&&d.deleteNestedProperty(l.implicit,["encode","gradient"]),((l.explicit||{}).encode||{}).gradient&&d.deleteNestedProperty(l.explicit,["encode","gradient"])),l}}Object.defineProperty(t,"__esModule",{value:!0});var l=x("../../channel"),s=x("../../fielddef"),c=x("../../legend"),d=x("../../util"),p=x("../common"),r=x("../model"),u=x("../resolve"),m=x("../split"),g=x("../split"),f=x("./component"),h=x("./encode"),y=x("./properties");t.parseLegend=E,t.parseLegendForChannel=a,t.mergeLegendComponent=o},{"../../channel":16,"../../fielddef":101,"../../legend":105,"../../util":119,"../common":25,"../model":67,"../resolve":70,"../split":90,"./component":51,"./encode":52,"./properties":54}],54:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l("../../channel"),n=l("../../datetime"),i=l("../../scale"),a=l("../../util");t.values=function(a){var e=a.values;return e&&n.isDateTime(e[0])?e.map(function(t){return{signal:n.dateTimeExpr(t,!0)}}):e},t.type=function(o,e,t){if(e===s.COLOR&&("quantitative"===o&&!i.isBinScale(t)||"temporal"===o&&a.contains(["time","utc"],t)))return"gradient"}},{"../../channel":16,"../../datetime":98,"../../scale":109,"../../util":119}],55:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("tslib"),i=a("./mixins");t.area={vgMark:"area",encodeEntry:function(t){return n.__assign({},i.markDefProperties(t.markDef),i.pointPosition("x",t,"zeroOrMin"),i.pointPosition("y",t,"zeroOrMin"),i.pointPosition2(t,"zeroOrMin"),i.color(t),i.text(t,"tooltip"),i.nonPosition("opacity",t))}}},{"./mixins":60,tslib:6}],56:[function(g,e,t){"use strict";function n(t){var e=t.config,n=t.width,o=t.markDef.orient,r=t.encoding.size,m=t.encoding.x,c=t.scaleName(_.X),d=t.getScaleComponent(_.X);if("horizontal"===o)return a.__assign({},f.pointPosition("x",t,"zeroOrMin"),f.pointPosition2(t,"zeroOrMin"));if(l.isFieldDef(m)){var g=d.get("type");if(m.bin&&!r&&!u.hasDiscreteDomain(g))return f.binnedPosition(m,"x",t.scaleName("x"),e.bar.binSpacing,d.get("reverse"));if(g===u.ScaleType.BAND)return f.bandPosition(m,"x",t)}return f.centeredBandPosition("x",t,a.__assign({},p.mid(n)),y(c,d,e))}function i(t){var e=t.config,n=t.encoding,i=t.height,o=t.markDef.orient,s=n.size,m=n.y,d=t.scaleName(_.Y),g=t.getScaleComponent(_.Y);if("vertical"===o)return a.__assign({},f.pointPosition("y",t,"zeroOrMin"),f.pointPosition2(t,"zeroOrMin"));if(l.isFieldDef(m)){var h=g.get("type");if(m.bin&&!s&&!u.hasDiscreteDomain(h))return f.binnedPosition(m,"y",t.scaleName("y"),e.bar.binSpacing,g.get("reverse"));if(h===u.ScaleType.BAND)return f.bandPosition(m,"y",t)}return f.centeredBandPosition("y",t,p.mid(i),y(d,g,e))}function y(a,e,t){if(t.bar.discreteBandSize)return{value:t.bar.discreteBandSize};if(e){var n=e.get("type");if(n!==u.ScaleType.POINT)return n===u.ScaleType.BAND?p.band(a):{value:t.bar.continuousBandSize};var i=e.get("range");if(c.isVgRangeStep(i)&&o.isNumber(i.step))return{value:i.step-1};s.warn(s.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return t.scale.rangeStep&&null!==t.scale.rangeStep?{value:t.scale.rangeStep-1}:{value:20}}Object.defineProperty(t,"__esModule",{value:!0});var a=g("tslib"),o=g("vega-util"),_=g("../../channel"),l=g("../../fielddef"),s=g("../../log"),u=g("../../scale"),c=g("../../vega.schema"),f=g("./mixins"),p=g("./valueref");t.bar={vgMark:"rect",encodeEntry:function(t){return t.stack,a.__assign({},f.markDefProperties(t.markDef,!0),n(t),i(t),f.color(t),f.text(t,"tooltip"),f.nonPosition("opacity",t))}}},{"../../channel":16,"../../fielddef":101,"../../log":106,"../../scale":109,"../../vega.schema":121,"./mixins":60,"./valueref":66,tslib:6,"vega-util":11}],57:[function(m,e,t){"use strict";function n(a,e){if(s.contains([u.POINT,u.TICK,u.CIRCLE,u.SQUARE],a)&&!i.isAggregate(e))return .7}function g(a,e){var t=d.getMarkConfig("filled",a,e),n=a.type;return void 0===t?n!==u.POINT&&n!==u.LINE&&n!==u.RULE:t}function r(c,e,t){switch(c){case u.POINT:case u.CIRCLE:case u.SQUARE:case u.TEXT:case u.RECT:return;}var n=e.y2,i=e.x2;switch(c){case u.RULE:case u.BAR:case u.AREA:if(n)return"vertical";if(i)return"horizontal";if(c===u.RULE){if(e.x&&!e.y)return"vertical";if(e.y&&!e.x)return"horizontal"}case u.LINE:case u.TICK:var r=h.isFieldDef(e.x)&&h.isContinuous(e.x),g=h.isFieldDef(e.y)&&h.isContinuous(e.y);if(r&&!g)return"tick"===c?"vertical":"horizontal";if(!r&&g)return"tick"===c?"horizontal":"vertical";if(r&&g){var f=e.x,s=e.y,d=f.type===o.TEMPORAL,y=s.type===o.TEMPORAL;return d&&!y?"tick"===c?"horizontal":"vertical":!d&&y?"tick"===c?"vertical":"horizontal":!f.aggregate&&s.aggregate?"tick"===c?"horizontal":"vertical":f.aggregate&&!s.aggregate?"tick"===c?"vertical":"horizontal":t||(c===u.LINE&&e.order||l.warn(l.message.unclearOrientContinuous(c)),"vertical")}return void l.warn(l.message.unclearOrientDiscreteOrEmpty(c));}return"vertical"}Object.defineProperty(t,"__esModule",{value:!0});var a=m("tslib"),i=m("../../encoding"),h=m("../../fielddef"),l=m("../../log"),u=m("../../mark"),o=m("../../type"),s=m("../../util"),d=m("../common");t.normalizeMarkDef=function(o,c,t){var n=u.isMarkDef(o)?a.__assign({},o):{type:o},i=n.orient||d.getMarkConfig("orient",n,t);return n.orient=r(n.type,c,i),void 0!==i&&i!==n.orient&&l.warn(l.message.orientOverridden(n.orient,i)),void 0===n.filled&&(n.filled=g(n,t)),n},t.initEncoding=function(i,e,t,l){var s=d.getMarkConfig("opacity",i,l);if(!e.opacity&&void 0===s){var a=n(i.type,e);void 0!==a&&(e.opacity={value:a})}return e}},{"../../encoding":99,"../../fielddef":101,"../../log":106,"../../mark":108,"../../type":118,"../../util":119,"../common":25,tslib:6}],58:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o("tslib"),i=o("./mixins"),s=o("./valueref");t.line={vgMark:"line",encodeEntry:function(a){var e=a.width,t=a.height;return l.__assign({},i.markDefProperties(a.markDef,!0),i.pointPosition("x",a,s.mid(e)),i.pointPosition("y",a,s.mid(t)),i.color(a),i.text(a,"tooltip"),i.nonPosition("opacity",a),i.nonPosition("size",a,{vgChannel:"strokeWidth"}))}}},{"./mixins":60,"./valueref":66,tslib:6}],59:[function(k,e,t){"use strict";function n(l){var e=l.mark(),t=r(l),d=void 0===l.markDef.clip?o(l):!!l.markDef.clip,p=g.getStyles(l.markDef),m=D(l),f=[s.__assign({name:l.getName("marks"),type:E[e].vgMark},d?{clip:!0}:{},p?{style:p}:{},m?{sort:m}:{},{from:{data:(0<t.length?N:"")+l.requestDataName(C.MAIN)},encode:{update:E[e].encodeEntry(l)}})];return 0<t.length?[{name:l.getName("pathgroup"),type:"group",from:{facet:{name:N+l.requestDataName(C.MAIN),data:l.requestDataName(C.MAIN),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:f}]:f}function D(a){if("line"===a.mark()&&a.channelHasField("order"))return g.sortParams(a.encoding.order,{expr:"datum"});var e="horizontal"===a.markDef.orient?"y":"x",t=a.sort(e),n=u.isSortField(t)?d.field({aggregate:c.isAggregate(a.encoding)?t.op:void 0,field:t.field},{expr:"datum"}):a.field(e,{binSuffix:a.stack&&a.stack.impute?"mid":void 0,expr:"datum"});return n?{field:n,order:"descending"}:void 0}function i(a){var e=a.mark(),t=g.getStyles(a.markDef),l=void 0===a.markDef.clip?o(a):!!a.markDef.clip,i=[];return i.push(s.__assign({name:a.getName("marks"),type:E[e].vgMark},l?{clip:!0}:{},t?{style:t}:{},{from:{data:a.requestDataName(C.MAIN)},encode:{update:E[e].encodeEntry(a)}})),i}function r(o){return l.NONPOSITION_CHANNELS.reduce(function(l,e){var t=o.encoding;if("order"===e)return l;if("detail"===e){var n=t[e];n&&(a.isArray(n)?n:[n]).forEach(function(t){t.aggregate||l.push(d.field(t,{}))})}else{var i=d.getFieldDef(t[e]);i&&!i.aggregate&&l.push(d.field(i,{}))}return l},[])}function o(a){var e=a.getScaleComponent("x"),t=a.getScaleComponent("y");return!!(e&&e.get("domainRaw")||t&&t.get("domainRaw"))}Object.defineProperty(t,"__esModule",{value:!0});var s=k("tslib"),a=k("vega-util"),l=k("../../channel"),C=k("../../data"),c=k("../../encoding"),d=k("../../fielddef"),p=k("../../mark"),u=k("../../sort"),m=k("../../util"),g=k("../common"),f=k("./area"),h=k("./bar"),y=k("./line"),_=k("./point"),b=k("./rect"),S=k("./rule"),v=k("./text"),x=k("./tick"),E={area:f.area,bar:h.bar,line:y.line,point:_.point,text:v.text,tick:x.tick,rect:b.rect,rule:S.rule,circle:_.circle,square:_.square};t.parseMarkGroup=function(t){return m.contains([p.LINE,p.AREA],t.mark())?n(t):i(t)};var N="faceted_path_";t.getPathSort=D},{"../../channel":16,"../../data":97,"../../encoding":99,"../../fielddef":101,"../../mark":108,"../../sort":111,"../../util":119,"../common":25,"./area":55,"./bar":56,"./line":58,"./point":61,"./rect":62,"./rule":63,"./text":64,"./tick":65,tslib:6,"vega-util":11}],60:[function(g,e,t){"use strict";function h(l,e,t){void 0===t&&(t={});var n=t.defaultValue,r=t.vgChannel,a=t.defaultRef||(void 0===n?void 0:{value:n}),o=e.encoding[l];return y(e,o,r||l,function(t){return d.midPoint(l,t,e.scaleName(l),e.getScaleComponent(l),null,a)})}function y(s,e,t,d){var n=e&&e.condition,i=d(e);if(n){var a=(o.isArray(n)?n:[n]).map(function(e){var t=d(e);return _.__assign({test:r.predicate(s,e.selection)},t)});return l={},l[t]=a.concat(void 0===i?[]:[i]),l}return void 0===i?{}:(p={},p[t]=i,p);var l,p}function i(l,e,t,n){var i=e.encoding,r=e.stack,c=d.stackable(l,i[l],e.scaleName(l),e.getScaleComponent(l),r,t);return o={},o[n||l]=c,o;var o}Object.defineProperty(t,"__esModule",{value:!0});var _=g("tslib"),o=g("vega-util"),b=g("../../fielddef"),l=g("../../log"),a=g("../../util"),n=g("../../vega.schema"),s=g("../common"),r=g("../selection/selection"),d=g("./valueref");t.color=function(i){var e=i.config,t=i.markDef.filled?"fill":"stroke",o=h("color",i,{vgChannel:t,defaultValue:i.markDef[t]||i.markDef.color||s.getMarkConfig(t,i.markDef,e)||s.getMarkConfig("color",i.markDef,e)});return!o.fill&&a.contains(["bar","point","circle","square"],i.mark())&&(o.fill={value:"transparent"}),o},t.markDefProperties=function(a,e){return n.VG_MARK_CONFIGS.reduce(function(t,n){return!a[n]||e&&"orient"===n||(t[n]={value:a[n]}),t},{})},t.valueIfDefined=function(a,e){return void 0===e?void 0:(i={},i[a]={value:e},i);var i},t.nonPosition=h,t.text=function(a,e){void 0===e&&(e="text");var t=a.encoding[e];return y(a,t,e,function(e){return d.text(e,a.config)})},t.bandPosition=function(i,e,t){var n=t.scaleName(e),o="x"===e?"width":"height";if(t.encoding.size)if(t.markDef.orient){var r=(s={},s[e+"c"]=d.fieldRef(i,n,{},{band:.5}),s);if(b.getFieldDef(t.encoding.size))l.warn(l.message.cannotUseSizeFieldWithBandSize(e));else if(b.isValueDef(t.encoding.size))return _.__assign({},r,h("size",t,{vgChannel:o}))}else l.warn(l.message.cannotApplySizeToNonOrientedMark(t.markDef.type));return c={},c[e]=d.fieldRef(i,n,{binSuffix:"range"}),c[o]=d.band(n),c;var s,c},t.centeredBandPosition=function(a,e,t,n){var o="x"===a?"xc":"yc",s="x"===a?"width":"height";return _.__assign({},i(a,e,t,o),h("size",e,{defaultRef:n,vgChannel:s}))},t.binnedPosition=function(a,e,t,n,i){return"x"===e?{x2:d.bin(a,t,"start",i?0:n),x:d.bin(a,t,"end",i?n:0)}:{y2:d.bin(a,t,"start",i?n:0),y:d.bin(a,t,"end",i?0:n)}},t.pointPosition=i,t.pointPosition2=function(c,e,t){var n=c.encoding,i=c.markDef,r=c.stack,a="x2"===(t=t||("horizontal"===i.orient?"x2":"y2"))?"x":"y",o=d.stackable2(t,n[a],n[t],c.scaleName(a),c.getScaleComponent(a),r,e);return s={},s[t]=o,s;var s}},{"../../fielddef":101,"../../log":106,"../../util":119,"../../vega.schema":121,"../common":25,"../selection/selection":80,"./valueref":66,tslib:6,"vega-util":11}],61:[function(d,e,t){"use strict";function n(a,e){var t=a.config,n=a.width,l=a.height;return r.__assign({},p.markDefProperties(a.markDef,!0),p.pointPosition("x",a,s.mid(n)),p.pointPosition("y",a,s.mid(l)),p.color(a),p.text(a,"tooltip"),p.nonPosition("size",a),c(a,t,e),p.nonPosition("opacity",a))}function c(i,e,t){return t?{shape:{value:t}}:p.nonPosition("shape",i,{defaultValue:a.getMarkConfig("shape",i.markDef,e)})}Object.defineProperty(t,"__esModule",{value:!0});var r=d("tslib"),a=d("../common"),p=d("./mixins"),s=d("./valueref");t.shapeMixins=c,t.point={vgMark:"symbol",encodeEntry:function(t){return n(t)}},t.circle={vgMark:"symbol",encodeEntry:function(t){return n(t,"circle")}},t.square={vgMark:"symbol",encodeEntry:function(t){return n(t,"square")}}},{"../common":25,"./mixins":60,"./valueref":66,tslib:6}],62:[function(d,e,t){"use strict";function n(d){var e=d.encoding.x,t=d.encoding.x2,m=d.getScaleComponent(a.X),g=m?m.get("type"):void 0;if(o.isFieldDef(e)&&e.bin&&!t)return c.binnedPosition(e,"x",d.scaleName("x"),0,m.get("reverse"));if(o.isFieldDef(e)&&m&&u.hasDiscreteDomain(g)){if(g===u.ScaleType.BAND)return c.bandPosition(e,"x",d);throw new Error(s.message.scaleTypeNotWorkWithMark(l.RECT,g))}return p.__assign({},c.pointPosition("x",d,"zeroOrMax"),c.pointPosition2(d,"zeroOrMin","x2"))}function i(d){var e=d.encoding.y,t=d.encoding.y2,m=d.getScaleComponent(a.Y),i=m?m.get("type"):void 0;if(o.isFieldDef(e)&&e.bin&&!t)return c.binnedPosition(e,"y",d.scaleName("y"),0,m.get("reverse"));if(o.isFieldDef(e)&&m&&u.hasDiscreteDomain(i)){if(i===u.ScaleType.BAND)return c.bandPosition(e,"y",d);throw new Error(s.message.scaleTypeNotWorkWithMark(l.RECT,i))}return p.__assign({},c.pointPosition("y",d,"zeroOrMax"),c.pointPosition2(d,"zeroOrMin","y2"))}Object.defineProperty(t,"__esModule",{value:!0});var p=d("tslib"),a=d("../../channel"),o=d("../../fielddef"),s=d("../../log"),l=d("../../mark"),u=d("../../scale"),c=d("./mixins");t.rect={vgMark:"rect",encodeEntry:function(t){return p.__assign({},c.markDefProperties(t.markDef,!0),n(t),i(t),c.color(t),c.text(t,"tooltip"),c.nonPosition("opacity",t))}}},{"../../channel":16,"../../fielddef":101,"../../log":106,"../../mark":108,"../../scale":109,"./mixins":60,tslib:6}],63:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o("tslib"),i=o("./mixins"),r=o("./valueref");t.rule={vgMark:"rule",encodeEntry:function(a){a.config;var e=a.markDef,t=a.width,n=a.height,o=e.orient;return a.encoding.x||a.encoding.y?l.__assign({},i.markDefProperties(a.markDef,!0),i.pointPosition("x",a,"horizontal"===o?"zeroOrMin":r.mid(t)),i.pointPosition("y",a,"vertical"===o?"zeroOrMin":r.mid(n)),i.pointPosition2(a,"zeroOrMax"),i.color(a),i.text(a,"tooltip"),i.nonPosition("opacity",a),i.nonPosition("size",a,{vgChannel:"strokeWidth"})):{}}}},{"./mixins":60,"./valueref":66,tslib:6}],64:[function(p,e,t){"use strict";function m(a,e){return n.isFieldDef(e)&&e.type===l.QUANTITATIVE?{field:{group:"width"},offset:-5}:{value:a.scale.textXRangeStep/2}}function i(i,e,t){if(void 0===(i.align||s.getMarkConfig("align",i,t)))return o.channelHasField(e,a.X)?"center":"right"}Object.defineProperty(t,"__esModule",{value:!0});var r=p("tslib"),a=p("../../channel"),o=p("../../encoding"),n=p("../../fielddef"),l=p("../../type"),s=p("../common"),c=p("./mixins"),u=p("./valueref");t.text={vgMark:"text",encodeEntry:function(a){var e=a.config,t=a.encoding,n=a.height,o=t.text;return r.__assign({},c.markDefProperties(a.markDef,!0),c.pointPosition("x",a,m(e,o)),c.pointPosition("y",a,u.mid(n)),c.text(a),c.color(a),c.text(a,"tooltip"),c.nonPosition("opacity",a),c.nonPosition("size",a,{vgChannel:"fontSize"}),c.valueIfDefined("align",i(a.markDef,t,e)))}}},{"../../channel":16,"../../encoding":99,"../../fielddef":101,"../../type":118,"../common":25,"./mixins":60,"./valueref":66,tslib:6}],65:[function(l,e,t){"use strict";function p(a){var e=a.config,t=a.markDef.orient,n=a.getScaleComponent("horizontal"===t?"x":"y");if(void 0!==e.tick.bandSize)return e.tick.bandSize;var l=n?n.get("range"):void 0,s=l&&d.isVgRangeStep(l)?l.step:e.scale.rangeStep;if("number"!=typeof s)throw new Error("Function does not handle non-numeric rangeStep");return s/1.5}Object.defineProperty(t,"__esModule",{value:!0});var i=l("tslib"),d=l("../../vega.schema"),r=l("./mixins"),o=l("./valueref");t.tick={vgMark:"rect",encodeEntry:function(s){var e=s.config,t=s.markDef,n=s.width,a=s.height,l=t.orient,u="horizontal"===l?"width":"height",m="horizontal"===l?"height":"width";return i.__assign({},r.markDefProperties(s.markDef,!0),r.pointPosition("x",s,o.mid(n),"xc"),r.pointPosition("y",s,o.mid(a),"yc"),r.nonPosition("size",s,{defaultValue:p(s),vgChannel:u}),(g={},g[m]={value:e.tick.thickness},g),r.color(s),r.nonPosition("opacity",s));var g}}},{"../../vega.schema":121,"./mixins":60,"./valueref":66,tslib:6}],66:[function(h,e,t){"use strict";function y(o,e,l,n){var s={scale:e,field:u.field(o,l)};return n?a.__assign({},s,n):s}function i(a,e){return{signal:"(scale(\""+e+"\", "+u.field(a,{expr:"datum"})+") + scale(\""+e+"\", "+u.field(a,{binSuffix:"end",expr:"datum"})+"))/2"}}function _(g,e,t,n,f,_){if(e){if(u.isFieldDef(e)){if(e.bin)return p.contains(["x","y"],g)&&"quantitative"===e.type?f&&f.impute?y(e,t,{binSuffix:"mid"}):i(e,t):y(e,t,m.binRequiresRange(e,g)?{binSuffix:"range"}:{});var h=n.get("type");return d.hasDiscreteDomain(h)?"band"===h?y(e,t,{binSuffix:"range"},{band:.5}):y(e,t,{binSuffix:"range"}):y(e,t,{})}if(u.isValueDef(e))return{value:e.value};throw new Error("A channel definition has neither field nor value.")}if("zeroOrMin"===_){if(g===c.X||g===c.X2)return r(t,n);if(g===c.Y||g===c.Y2)return s(t,n);throw new Error("Unsupported channel "+g+" for base function")}if("zeroOrMax"===_){if(g===c.X||g===c.X2)return o(t,n);if(g===c.Y||g===c.Y2)return l(t,n);throw new Error("Unsupported channel "+g+" for base function")}return _}function r(a,n){return a&&!p.contains([d.ScaleType.LOG,d.ScaleType.TIME,d.ScaleType.UTC],n.get("type"))&&!1!==n.get("zero")?{scale:a,value:0}:{value:0}}function o(a,n){return a&&!p.contains([d.ScaleType.LOG,d.ScaleType.TIME,d.ScaleType.UTC],n.get("type"))&&!1!==n.get("zero")?{scale:a,value:0}:{field:{group:"width"}}}function s(a,n){return a&&!p.contains([d.ScaleType.LOG,d.ScaleType.TIME,d.ScaleType.UTC],n.get("type"))&&!1!==n.get("zero")?{scale:a,value:0}:{field:{group:"height"}}}function l(a,n){return a&&!p.contains([d.ScaleType.LOG,d.ScaleType.TIME,d.ScaleType.UTC],n.get("type"))&&!1!==n.get("zero")?{scale:a,value:0}:{value:0}}Object.defineProperty(t,"__esModule",{value:!0});var a=h("tslib"),c=h("../../channel"),u=h("../../fielddef"),d=h("../../scale"),p=h("../../util"),m=h("../common");t.stackable=function(a,e,t,n,i,o){return u.isFieldDef(e)&&i&&a===i.fieldChannel?y(e,t,{suffix:"end"}):_(a,e,t,n,i,o)},t.stackable2=function(a,e,t,n,i,o,s){return u.isFieldDef(e)&&o&&a.charAt(0)===o.fieldChannel.charAt(0)?y(e,n,{suffix:"start"}):_(a,t,n,i,o,s)},t.bin=function(a,e,t,n){return y(a,e,{binSuffix:"start"===t?void 0:"end"},n?{offset:n}:{})},t.fieldRef=y,t.band=function(a,n){return void 0===n&&(n=!0),{scale:a,band:n}},t.midPoint=_,t.text=function(a,e){if(a){if(u.isFieldDef(a))return m.formatSignalRef(a,a.format,"datum",e);if(u.isValueDef(a))return{value:a.value}}},t.mid=function(t){return a.__assign({},t,{mult:.5})}},{"../../channel":16,"../../fielddef":101,"../../scale":109,"../../util":119,"../common":25,tslib:6}],67:[function(k,e,t){"use strict";function D(t){return t&&"unit"===t.type}function C(t){return t&&"facet"===t.type}Object.defineProperty(t,"__esModule",{value:!0});var A=k("tslib"),a=k("vega-util"),n=k("../channel"),i=k("../encoding"),s=k("../fielddef"),r=k("../log"),c=k("../scale"),o=k("../title"),l=k("../transform"),d=k("../util"),p=k("../vega.schema"),u=k("./axis/assemble"),g=k("./layout/header"),m=k("./layoutsize/assemble"),f=k("./legend/assemble"),h=k("./legend/parse"),y=k("./scale/assemble"),_=k("./scale/domain"),b=k("./scale/parse"),S=k("./split"),v=function(){function t(){this.nameMap={}}return t.prototype.rename=function(a,e){this.nameMap[a]=e},t.prototype.has=function(t){return void 0!==this.nameMap[t]},t.prototype.get=function(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t},t}();t.NameMap=v,t.isUnitModel=D,t.isFacetModel=C,t.isRepeatModel=function(t){return t&&"repeat"===t.type},t.isConcatModel=function(t){return t&&"concat"===t.type},t.isLayerModel=function(t){return t&&"layer"===t.type};var x=function(){function t(o,d,t,n,i){var r=this;this.children=[],this.correctDataNames=function(t){return t.from&&t.from.data&&(t.from.data=r.lookupDataSource(t.from.data)),t.from&&t.from.facet&&t.from.facet.data&&(t.from.facet.data=r.lookupDataSource(t.from.facet.data)),t},this.parent=d,this.config=n,this.name=o.name||t,this.title=a.isString(o.title)?{text:o.title}:o.title,this.scaleNameMap=d?d.scaleNameMap:new v,this.layoutSizeNameMap=d?d.layoutSizeNameMap:new v,this.data=o.data,this.description=o.description,this.transforms=l.normalizeTransform(o.transform||[]),this.component={data:{sources:d?d.component.data.sources:{},outputNodes:d?d.component.data.outputNodes:{},outputNodeRefCounts:d?d.component.data.outputNodeRefCounts:{},ancestorParse:d?A.__assign({},d.component.data.ancestorParse):{}},layoutSize:new S.Split,layoutHeaders:{row:{},column:{}},mark:null,resolve:A.__assign({scale:{},axis:{},legend:{}},i||{}),selection:null,scales:null,axes:{},legends:{}}}return Object.defineProperty(t.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:!0,configurable:!0}),t.prototype.initSize=function(a){var e=a.width,t=a.height;e&&this.component.layoutSize.set("width",e,!0),t&&this.component.layoutSize.set("height",t,!0)},t.prototype.parse=function(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSize(),this.parseSelection(),this.parseData(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},t.prototype.parseScale=function(){b.parseScale(this)},t.prototype.renameTopLevelLayoutSize=function(){"width"!==this.getName("width")&&this.renameLayoutSize(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameLayoutSize(this.getName("height"),"height")},t.prototype.parseLegend=function(){h.parseLegend(this)},t.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return"cell"},t.prototype.assembleLayoutSize=function(){if("unit"===this.type||"layer"===this.type)return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},t.prototype.assembleHeaderMarks=function(){for(var h=this.component.layoutHeaders,e=[],t=0,n=g.HEADER_CHANNELS;t<n.length;t++)h[c=n[t]].title&&e.push(g.getTitleGroup(this,c));for(var i=0,r=g.HEADER_CHANNELS;i<r.length;i++)for(var a,c=r[i],o=h[c],s=0,l=g.HEADER_TYPES;s<l.length;s++)if(a=l[s],o[a])for(var u=0,f=o[a];u<f.length;u++){var d=f[u],p=g.getHeaderGroup(this,c,a,o,d);p&&e.push(p)}return e},t.prototype.assembleAxes=function(){return u.assembleAxes(this.component.axes)},t.prototype.assembleLegends=function(){return f.assembleLegends(this)},t.prototype.assembleTitle=function(){var t=A.__assign({},o.extractTitleConfig(this.config.title).nonMark,this.title);if(t.text)return d.contains(["unit","layer"],this.type)||(t.anchor&&"start"!==t.anchor&&r.warn(r.message.cannotSetTitleAnchor(this.type)),t.anchor="start"),0<d.keys(t).length?t:void 0},t.prototype.assembleGroup=function(l){void 0===l&&(l=[]);var e={};0<(l=l.concat(this.assembleSelectionSignals())).length&&(e.signals=l);var t=this.assembleLayout();t&&(e.layout=t),e.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var n=!this.parent||C(this.parent)?y.assembleScales(this):[];0<n.length&&(e.scales=n);var i=this.assembleAxes();0<i.length&&(e.axes=i);var a=this.assembleLegends();return 0<a.length&&(e.legends=a),e},t.prototype.hasDescendantWithFieldOnChannel=function(a){for(var e,i=0,t=this.children;i<t.length;i++)if(e=t[i],D(e)){if(e.channelHasField(a))return!0;}else if(e.hasDescendantWithFieldOnChannel(a))return!0;return!1},t.prototype.getName=function(t){return d.varName((this.name?this.name+"_":"")+t)},t.prototype.requestDataName=function(a){var e=this.getName(a),t=this.component.data.outputNodeRefCounts;return t[e]=(t[e]||0)+1,e},t.prototype.getSizeSignalRef=function(u){if(C(this.parent)){var e="width"===u?"x":"y",t=this.component.scales[e];if(t&&!t.merged){var n=t.get("type"),i=t.get("range");if(c.hasDiscreteDomain(n)&&p.isVgRangeStep(i)){var a=t.get("name"),o=_.assembleDomain(this,e),g=_.getFieldFromDomain(o);if(g){var f=s.field({aggregate:"distinct",field:g},{expr:"datum"});return{signal:m.sizeExpr(a,t,f)}}return r.warn("Unknown field for ${channel}.  Cannot calculate view size."),null}}}return{signal:this.layoutSizeNameMap.get(this.getName(u))}},t.prototype.lookupDataSource=function(a){var e=this.component.data.outputNodes[a];return e?e.getSource():a},t.prototype.getSizeName=function(t){return this.layoutSizeNameMap.get(t)},t.prototype.renameLayoutSize=function(a,e){this.layoutSizeNameMap.rename(a,e)},t.prototype.renameScale=function(a,e){this.scaleNameMap.rename(a,e)},t.prototype.scaleName=function(a,e){return e?this.getName(a):n.isChannel(a)&&n.isScaleChannel(a)&&this.component.scales[a]||this.scaleNameMap.has(this.getName(a))?this.scaleNameMap.get(this.getName(a)):void 0},t.prototype.getScaleComponent=function(a){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var e=this.component.scales[a];return e&&!e.merged?e:this.parent?this.parent.getScaleComponent(a):void 0},t.prototype.getSelectionComponent=function(a,e){var t=this.component.selection[a];if(!t&&this.parent&&(t=this.parent.getSelectionComponent(a,e)),!t)throw new Error(r.message.selectionNotFound(e));return t},t}();t.Model=x;var E=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return A.__extends(e,a),e.prototype.field=function(a,e){void 0===e&&(e={});var t=this.fieldDef(a);if(t)return s.field(t,e)},e.prototype.reduceFieldDef=function(a,e,t){return i.reduce(this.getMapping(),function(e,t,n){var i=s.getFieldDef(t);return i?a(e,i,n):e},e,t)},e.prototype.forEachFieldDef=function(a,e){i.forEach(this.getMapping(),function(e,t){var n=s.getFieldDef(e);n&&a(n,t)},e)},e}(x);t.ModelWithField=E},{"../channel":16,"../encoding":99,"../fielddef":101,"../log":106,"../scale":109,"../title":115,"../transform":117,"../util":119,"../vega.schema":121,"./axis/assemble":17,"./layout/header":47,"./layoutsize/assemble":48,"./legend/assemble":50,"./legend/parse":53,"./scale/assemble":71,"./scale/domain":73,"./scale/parse":74,"./split":90,tslib:6,"vega-util":11}],68:[function(d,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d("tslib"),c=d("../log"),i=d("./baseconcat"),a=d("./buildmodel"),o=d("./layoutsize/parse"),s=function(l){function e(e,r,n,i,a){var o=l.call(this,e,r,n,a,e.resolve)||this;return o.type="repeat",e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&c.warn(c.message.REPEAT_CANNOT_SHARE_AXIS),o.repeat=e.repeat,o.children=o._initChildren(e,o.repeat,i,a),o}return n.__extends(e,l),e.prototype._initChildren=function(o,e,t,n){for(var i=[],r=e.row||[t?t.row:null],g=e.column||[t?t.column:null],s=0,l=r;s<l.length;s++)for(var u=l[s],h=0,f=g;h<f.length;h++){var d=f[h],y=(u?"_"+u:"")+(d?"_"+d:"");i.push(a.buildModel(o.spec,this,this.getName("child"+y),void 0,{row:u,column:d},n,!1))}return i},e.prototype.parseLayoutSize=function(){o.parseRepeatLayoutSize(this)},e.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},e}(i.BaseConcatModel);t.RepeatModel=s},{"../log":106,"./baseconcat":23,"./buildmodel":24,"./layoutsize/parse":49,tslib:6}],69:[function(d,e,t){"use strict";function p(a,e){return s.isRepeatRef(a.field)?a.field.repeat in e?o.__assign({},a,{field:e[a.field.repeat]}):void n.warn(n.message.noSuchRepeatedValue(a.field.repeat)):a}function i(a,e){if(void 0!==(a=p(a,e))){if(a.sort&&l.isSortField(a.sort)){var t=p(a.sort,e);a=o.__assign({},a,t?{sort:t}:{})}return a}}function m(a,e){if(!s.isFieldDef(a)){if(s.hasConditionalFieldDef(a)){var t=i(a.condition,e);return t?o.__assign({},a,{condition:t}):(a.condition,o.__rest(a,["condition"]))}return a}return(t=i(a,e))?t:s.isConditionalDef(a)?{condition:a.condition}:void 0}function a(a,l){var e={};for(var t in a)if(a.hasOwnProperty(t)){var n=a[t];if(c.isArray(n))e[t]=n.map(function(t){return m(t,l)}).filter(function(t){return t});else{var i=m(n,l);i&&(e[t]=i)}}return e}Object.defineProperty(t,"__esModule",{value:!0});var o=d("tslib"),s=d("../fielddef"),n=d("../log"),l=d("../sort"),c=d("../util");t.replaceRepeaterInFacet=function(n,e){return a(n,e)},t.replaceRepeaterInEncoding=function(n,e){return a(n,e)}},{"../fielddef":101,"../log":106,"../sort":111,"../util":119,tslib:6}],70:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l("../channel"),i=l("../log"),r=l("../util"),a=l("./model");t.defaultScaleResolve=function(n,e){if(a.isLayerModel(e)||a.isFacetModel(e))return"shared";if(a.isConcatModel(e)||a.isRepeatModel(e))return r.contains(s.POSITION_SCALE_CHANNELS,n)?"independent":"shared";throw new Error("invalid model type for resolve")},t.parseGuideResolve=function(a,e){var t=a.scale[e],n=r.contains(s.POSITION_SCALE_CHANNELS,e)?"axis":"legend";return"independent"===t?("shared"===a[n][e]&&i.warn(i.message.independentScaleMeansIndependentGuide(e)),"independent"):a[n][e]||"shared"}},{"../channel":16,"../log":106,"../util":119,"./model":67}],71:[function(p,e,t){"use strict";function n(t){return r.isLayerModel(t)||r.isConcatModel(t)||r.isRepeatModel(t)?t.children.reduce(function(a,e){return a.concat(n(e))},i(t)):i(t)}function i(o){return s.keys(o.component.scales).reduce(function(e,t){var n=o.component.scales[t];if(n.merged)return e;var i=n.combine(),r=i.domainRaw,d=i.range,h=i.name,y=i.type,_=(i.domainRaw,i.range,a.__rest(i,["name","type","domainRaw","range"]));return d=m(d,h,o,t),r&&g.isRawSelectionDomain(r)&&(r=g.selectionScaleDomain(o,r)),e.push(a.__assign({name:h,type:y,domain:f.assembleDomain(o,t)},r?{domainRaw:r}:{},{range:d},_)),e},[])}function m(s,e,t,n){if("x"===n||"y"===n){if(l.isVgRangeStep(s))return{step:{signal:e+"_step"}};if(o.isArray(s)&&2===s.length){var i=s[0],r=s[1];if(0===i&&l.isVgSignalRef(r))return[0,{signal:t.getSizeName(r.signal)}];if(l.isVgSignalRef(i)&&0===r)return[{signal:t.getSizeName(i.signal)},0]}}return s}Object.defineProperty(t,"__esModule",{value:!0});var a=p("tslib"),o=p("vega-util"),s=p("../../util"),l=p("../../vega.schema"),r=p("../model"),g=p("../selection/selection"),f=p("./domain");t.assembleScales=n,t.assembleScalesForModel=i,t.assembleScaleRange=m},{"../../util":119,"../../vega.schema":121,"../model":67,"../selection/selection":80,"./domain":73,tslib:6,"vega-util":11}],72:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("tslib"),i=function(a){function e(e,o){var n=a.call(this,{},{name:e})||this;return n.merged=!1,n.domains=[],n.setWithExplicit("type",o),n}return n.__extends(e,a),e}(a("../split").Split);t.ScaleComponent=i},{"../split":90,tslib:6}],73:[function(D,e,t){"use strict";function C(t){E.isUnitModel(t)?n(t):i(t)}function n(s){var e=s.specifiedScales,t=s.component.scales;_.keys(t).forEach(function(n){var i=e[n],r=i?i.domain:void 0,a=A(s,n),o=t[n];o.domains=a,h.isSelectionDomain(r)&&o.set("domainRaw",{signal:N.SELECTION_DOMAIN+JSON.stringify(r)},!0)})}function i(l){for(var e=0,t=l.children;e<t.length;e++)C(t[e]);var s=l.component.scales;_.keys(s).forEach(function(e){for(var t,n,o=0,i=l.children;o<i.length;o++)n=i[o].component.scales[e],n&&(t=void 0===t?n.domains:t.concat(n.domains));E.isFacetModel(l)&&t.forEach(function(t){b.isDataRefDomain(t)&&(t.data=x.FACET_SCALE_PREFIX+t.data.replace(x.FACET_SCALE_PREFIX,""))}),s[e].domains=t})}function a(s,e,t,n){if("unaggregated"===s){var i=l(e,t),r=i.valid,d=i.reason;if(!r)return void f.warn(d)}else if(void 0===s&&n.useUnaggregatedDomain&&(r=l(e,t).valid))return"unaggregated";return s}function A(l,e){var t=l.getScaleComponent(e).get("type"),n=a(l.scaleDomain(e),l.fieldDef(e),t,l.config.scale);return n!==l.scaleDomain(e)&&(l.specifiedScales[e]=c.__assign({},l.specifiedScales[e],{domain:n})),"x"===e&&l.channelHasField("x2")?l.channelHasField("x")?o(t,n,l,"x").concat(o(t,n,l,"x2")):o(t,n,l,"x2"):"y"===e&&l.channelHasField("y2")?l.channelHasField("y")?o(t,n,l,"y").concat(o(t,n,l,"y2")):o(t,n,l,"y2"):o(t,n,l,e)}function o(d,e,t,n){var i=t.fieldDef(n);if(e&&"unaggregated"!==e&&!h.isSelectionDomain(e)){if(!i.bin)return g.isDateTime(e[0])?e.map(function(t){return{signal:"{data: "+g.dateTimeExpr(t,!0)+"}"}}):[e];f.warn(f.message.conflictedDomain(n))}var r=t.stack;if(r&&n===r.fieldChannel)return"normalize"===r.offset?[[0,1]]:[{data:s=t.requestDataName(m.MAIN),field:t.field(n,{suffix:"start"})},{data:s,field:t.field(n,{suffix:"end"})}];var a=u.isScaleChannel(n)?P(t,n,d):void 0;if("unaggregated"===e)return[{data:s=t.requestDataName(m.MAIN),field:t.field(n,{aggregate:"min"})},{data:s,field:t.field(n,{aggregate:"max"})}];if(i.bin){if(h.isBinScale(d)){var c=t.getName(p.binToString(i.bin)+"_"+i.field+"_bins");return[{signal:"sequence("+c+".start, "+c+".stop + "+c+".step, "+c+".step)"}]}if(h.hasDiscreteDomain(d))return[{data:_.isBoolean(a)?t.requestDataName(m.MAIN):t.requestDataName(m.RAW),field:t.field(n,v.binRequiresRange(i,n)?{binSuffix:"range"}:{}),sort:!0!==a&&y.isSortField(a)?a:{field:t.field(n,{}),op:"min"}}];if("x"===n||"y"===n){var s=t.requestDataName(m.MAIN);return[{data:s,field:t.field(n,{})},{data:s,field:t.field(n,{binSuffix:"end"})}]}return[{data:t.requestDataName(m.MAIN),field:t.field(n,{})}]}return a?[{data:_.isBoolean(a)?t.requestDataName(m.MAIN):t.requestDataName(m.RAW),field:t.field(n),sort:a}]:[{data:t.requestDataName(m.MAIN),field:t.field(n)}]}function P(a,e,t){if(h.hasDiscreteDomain(t)){var n=a.sort(e);return y.isSortField(n)?n:"descending"===n?{op:"min",field:a.field(e),order:"descending"}:!!_.contains(["ascending",void 0],n)||void 0}}function l(a,e){return a.aggregate?r.SHARED_DOMAIN_OP_INDEX[a.aggregate]?"quantitative"===a.type&&"log"===e?{valid:!1,reason:f.message.unaggregatedDomainWithLogScale(a)}:{valid:!0}:{valid:!1,reason:f.message.unaggregateDomainWithNonSharedDomainOp(a.aggregate)}:{valid:!1,reason:f.message.unaggregateDomainHasNoEffectForRawField(a)}}function s(d){var e=_.unique(d.map(function(t){return b.isDataRefDomain(t)?(t.sort,c.__rest(t,["sort"])):t}),_.hash),p=_.unique(d.map(function(a){if(b.isDataRefDomain(a)){var e=a.sort;return void 0===e||_.isBoolean(e)||("count"===e.op&&delete e.field,"ascending"===e.order&&delete e.order),e}}).filter(function(t){return void 0!==t}),_.hash);if(1===e.length){var n=d[0];if(b.isDataRefDomain(n)&&0<p.length){var i=p[0];return 1<p.length&&(f.warn(f.message.MORE_THAN_ONE_SORT),i=!0),c.__assign({},n,{sort:i})}return n}var u=p.filter(function(t){return!!_.isBoolean(t)||"count"===t.op||(f.warn(f.message.domainSortDropped(t)),!1)}),a=!0;if(1===u.length)a=u[0];else if(1<u.length){var m=u.filter(function(t){return!1!==t});1<m.length?(f.warn(f.message.MORE_THAN_ONE_SORT),a=!0):a=m[0]}var s=_.unique(d.map(function(t){return b.isDataRefDomain(t)?t.data:null}),function(t){return t});return 1===s.length&&null!==s[0]?n={data:s[0],fields:e.map(function(t){return t.field}),sort:a}:{fields:e,sort:a}}Object.defineProperty(t,"__esModule",{value:!0});var c=D("tslib"),d=D("vega-util"),r=D("../../aggregate"),p=D("../../bin"),u=D("../../channel"),m=D("../../data"),g=D("../../datetime"),f=D("../../log"),h=D("../../scale"),y=D("../../sort"),_=D("../../util"),b=D("../../vega.schema"),S=D("../../vega.schema"),v=D("../common"),x=D("../data/optimize"),E=D("../model"),N=D("../selection/selection");t.parseScaleDomain=C,t.parseDomainForChannel=A,t.domainSort=P,t.canUseUnaggregatedDomain=l,t.mergeDomains=s,t.getFieldFromDomain=function(a){if(b.isDataRefDomain(a)&&d.isString(a.field))return a.field;if(S.isDataRefUnionedDomain(a)){for(var e,o=void 0,l=0,n=a.fields;l<n.length;l++)if(e=n[l],b.isDataRefDomain(e)&&d.isString(e.field))if(!o)o=e.field;else if(o!==e.field)return f.warn("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),o;return f.warn("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect."),o}return S.isFieldRefUnionDomain(a)&&d.isString?(f.warn("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),o=a.fields[0],d.isString(o)?o:void 0):void 0},t.assembleDomain=function(a,e){return s(a.component.scales[e].domains.map(function(e){return b.isDataRefDomain(e)&&(e.data=a.lookupDataSource(e.data)),e}))}},{"../../aggregate":13,"../../bin":15,"../../channel":16,"../../data":97,"../../datetime":98,"../../log":106,"../../scale":109,"../../sort":111,"../../util":119,"../../vega.schema":121,"../common":25,"../data/optimize":39,"../model":67,"../selection/selection":80,tslib:6,"vega-util":11}],74:[function(_,e,t){"use strict";function b(t){t.component.scales=o.isUnitModel(t)?n(t):i(t)}function n(s){var e=s.encoding,t=s.config,n=s.mark();return a.SCALE_CHANNELS.reduce(function(i,r){var a,o={},l=e[r];if(S.isFieldDef(l)?(a=l,o=l.scale||{}):S.hasConditionalFieldDef(l)?(a=l.condition,o=l.condition.scale||{}):"x"===r?a=S.getFieldDef(e.x2):"y"===r&&(a=S.getFieldDef(e.y2)),a){var p=o.type,c=h.scaleType(o.type,r,a,n,t.scale);i[r]=new d.ScaleComponent(s.scaleName(r+"",!0),{value:c,explicit:p===c})}return i},{})}function i(p){for(var e=p.component.scales={},m={},n=p.component.resolve,t=0,i=p.children;t<i.length;t++)!function(e){b(e),l.keys(e.component.scales).forEach(function(t){if(n.scale[t]=n.scale[t]||c.defaultScaleResolve(t,p),"shared"===n.scale[t]){var i=m[t],a=e.component.scales[t].getWithExplicit("type");i?s.scaleCompatible(i.value,a.value)?m[t]=u.mergeValuesWithExplicit(i,a,"type","scale",f):(n.scale[t]="independent",delete m[t]):m[t]=a}})}(i[t]);return l.keys(m).forEach(function(t){var n=p.scaleName(t,!0),i=m[t];e[t]=new d.ScaleComponent(n,i);for(var a=0,o=p.children;a<o.length;a++){var s=o[a],l=s.component.scales[t];l&&(s.renameScale(l.get("name"),n),l.merged=!0)}}),e}Object.defineProperty(t,"__esModule",{value:!0});var a=_("../../channel"),S=_("../../fielddef"),s=_("../../scale"),l=_("../../util"),o=_("../model"),c=_("../resolve"),u=_("../split"),d=_("./component"),p=_("./domain"),m=_("./properties"),g=_("./range"),h=_("./type");t.parseScale=function(a){b(a),p.parseScaleDomain(a);for(var e,i=0,t=s.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES;i<t.length;i++)e=t[i],m.parseScaleProperty(a,e);g.parseScaleRange(a)},t.parseScaleCore=b;var f=u.tieBreakByComparing(function(a,e){return s.scaleTypePrecedence(a)-s.scaleTypePrecedence(e)})},{"../../channel":16,"../../fielddef":101,"../../scale":109,"../../util":119,"../model":67,"../resolve":70,"../split":90,"./component":72,"./domain":73,"./properties":75,"./range":76,"./type":77}],75:[function(S,e,t){"use strict";function n(n,e){o.isUnitModel(n)?i(n,e):a(n,e)}function i(a,e){var t=a.component.scales;p.keys(t).forEach(function(n){var i=a.specifiedScales[n],r=t[n],o=a.getScaleComponent(n),s=a.fieldDef(n),l=a.sort(n),u=a.config,c=i[e],g=o.get("type"),d=m.scaleTypeSupportProperty(g,e),p=m.channelScalePropertyIncompatability(n,e);if(void 0!==c&&(d?p&&N.warn(p):N.warn(N.message.scalePropertyNotWorkWithScaleType(g,e,n))),d&&void 0===p)if(void 0!==c)r.copyKeyFromObject(e,i);else{var f=x(e,n,s,l,o.get("type"),o.get("padding"),o.get("paddingInner"),i.domain,a.markDef,u);void 0!==f&&r.set(e,f,!1)}})}function x(d,e,t,n,i,r,y,o,p,m){var g=m.scale;return"nice"===d?E(i,e,t):"padding"===d?s(e,i,g,t,p,m.bar):"paddingInner"===d?l(r,e,g):"paddingOuter"===d?u(r,e,i,y,g):"reverse"===d?c(i,n):"zero"===d?f(e,t,o):g[d]}function a(d,c){for(var e,t=d.component.scales,i=0,l=d.children;i<l.length;i++)e=l[i],"range"===c?y.parseScaleRange(e):n(e,c);p.keys(t).forEach(function(e){for(var n,i,s=0,a=d.children;s<a.length;s++)if(i=a[s].component.scales[e],i){var o=i.getWithExplicit(c);n=h.mergeValuesWithExplicit(n,o,c,"scale",h.tieBreakByComparing(function(t,e){return"range"===c?t.step&&e.step?t.step-e.step:0:0}))}t[e].setWithExplicit(c,n)})}function E(a,e,t){if(!t.bin&&!g.contains([m.ScaleType.TIME,m.ScaleType.UTC],a))return g.contains([d.X,d.Y],e)}function s(l,e,t,n,i,r){if(g.contains([d.X,d.Y],l)){if(m.isContinuousToContinuous(e)){if(void 0!==t.continuousPadding)return t.continuousPadding;var a=i.type,o=i.orient;if("bar"===a&&!n.bin&&("vertical"===o&&"x"===l||"horizontal"===o&&"y"===l))return r.continuousBandSize}if(e===m.ScaleType.POINT)return t.pointPadding}}function l(a,e,t){if(void 0===a)return g.contains([d.X,d.Y],e)?t.bandPaddingInner:void 0}function u(a,e,t,n,i){if(void 0===a)return g.contains([d.X,d.Y],e)&&t===m.ScaleType.BAND?void 0===i.bandPaddingOuter?n/2:i.bandPaddingOuter:void 0}function c(a,e){if(m.hasContinuousDomain(a)&&"descending"===e)return!0}function f(a,e,t){return"size"===a&&"quantitative"===e.type||(!t||"unaggregated"===t)&&!e.bin&&g.contains([d.X,d.Y],a)}Object.defineProperty(t,"__esModule",{value:!0});var d=S("../../channel"),N=S("../../log"),m=S("../../scale"),p=S("../../util"),g=S("../../util"),o=S("../model"),h=S("../split"),y=S("./range");t.parseScaleProperty=n,t.getDefaultValue=x,t.parseNonUnitScaleProperty=a,t.nice=E,t.padding=s,t.paddingInner=l,t.paddingOuter=u,t.reverse=c,t.zero=f},{"../../channel":16,"../../log":106,"../../scale":109,"../../util":119,"../model":67,"../split":90,"./range":76}],76:[function(S,e,E){"use strict";function t(a){var e=a.component.scales;u.SCALE_CHANNELS.forEach(function(t){var n=e[t];if(n){var i=a.getScaleComponent(t),o=a.specifiedScales[t],s=a.fieldDef(t),l="x"===t?"width":"y"===t?"height":void 0,u=l?!!a.component.layoutSize.get(l):void 0,h=i.get("type"),f=p.contains(["point","band"],h)||!!o.rangeStep;l&&a.fit&&!u&&f&&(T.warn(T.message.CANNOT_FIX_RANGE_STEP_WITH_FIT),u=!0);var d=x(a),m=r(t,h,s.type,o,a.config,n.get("zero"),a.mark(),u,a.getName(l),d);n.setWithExplicit("range",m)}})}function x(o){var e=[],t=o.getScaleComponent("x"),n=t&&t.get("range");n&&c.isVgRangeStep(n)&&s.isNumber(n.step)&&e.push(n.step);var i=o.getScaleComponent("y"),l=i&&i.get("range");return l&&c.isVgRangeStep(l)&&s.isNumber(l.step)&&e.push(l.step),e}function r(o,e,t,s,r,p,l,u,m,f){for(var d,y=u||null===s.rangeStep,g=0,h=E.RANGE_PROPERTIES;g<h.length;g++)if(d=h[g],void 0!==s[d]){var b=i.scaleTypeSupportProperty(e,d),v=i.channelScalePropertyIncompatability(o,d);if(!b)T.warn(T.message.scalePropertyNotWorkWithScaleType(e,d,o));else if(v)T.warn(v);else switch(d){case"range":return k.makeExplicit(s[d]);case"scheme":return k.makeExplicit(a(s[d]));case"rangeStep":var S=s[d];if(null!==S){if(!u)return k.makeExplicit({step:S});T.warn(T.message.rangeStepDropped(o))}}}return k.makeImplicit(n(o,e,t,r,p,l,m,f,y))}function a(a){if(i.isExtendedScheme(a)){var n={scheme:a.name};return a.count&&(n.count=a.count),a.extent&&(n.extent=a.extent),n}return{scheme:a}}function n(m,e,t,n,i,r,a,g,f){switch(m){case u.X:case u.Y:if(p.contains(["point","band"],e)&&!f)if(m===u.X&&"text"===r){if(n.scale.textXRangeStep)return{step:n.scale.textXRangeStep};}else if(n.scale.rangeStep)return{step:n.scale.rangeStep};return m===u.Y&&d.hasContinuousDomain(e)?[{signal:a},0]:[0,{signal:a}];case u.SIZE:return[N(r,i,n),l(r,g,n)];case u.SHAPE:return"symbol";case u.COLOR:return"ordinal"===e?"nominal"===t?"category":"ordinal":"rect"===r?"heatmap":"ramp";case u.OPACITY:return[n.scale.minOpacity,n.scale.maxOpacity];}throw new Error("Scale range undefined for channel "+m)}function N(a,e,t){if(e)return 0;switch(a){case"bar":case"tick":return t.scale.minBandSize;case"line":case"rule":return t.scale.minStrokeWidth;case"text":return t.scale.minFontSize;case"point":case"square":case"circle":return t.scale.minSize;}throw new Error(T.message.incompatibleChannel("size",a))}function l(a,e,t){var n=t.scale;switch(a){case"bar":case"tick":return void 0===t.scale.maxBandSize?o(e,t.scale)-1:t.scale.maxBandSize;case"line":case"rule":return t.scale.maxStrokeWidth;case"text":return t.scale.maxFontSize;case"point":case"square":case"circle":if(t.scale.maxSize)return t.scale.maxSize;var i=o(e,n);return(i-2)*(i-2);}throw new Error(T.message.incompatibleChannel("size",a))}function o(a,e){return 0<a.length?Math.min.apply(null,a):e.rangeStep?e.rangeStep:21}Object.defineProperty(E,"__esModule",{value:!0});var s=S("vega-util"),u=S("../../channel"),T=S("../../log"),i=S("../../scale"),d=S("../../scale"),p=S("../../util"),c=S("../../vega.schema"),m=S("../model"),k=S("../split"),g=S("./properties");E.RANGE_PROPERTIES=["range","rangeStep","scheme"],E.parseScaleRange=function(a){m.isUnitModel(a)?t(a):g.parseNonUnitScaleProperty(a,"range")},E.parseRangeForChannel=r,E.defaultRange=n},{"../../channel":16,"../../log":106,"../../scale":109,"../../util":119,"../../vega.schema":121,"../model":67,"../split":90,"./properties":75,"vega-util":11}],77:[function(d,e,t){"use strict";function p(i,e,t){switch(e.type){case"nominal":case"ordinal":if("color"===i||"discrete"===r.rangeType(i))return"shape"===i&&"ordinal"===e.type&&a.warn(a.message.discreteChannelCannotEncode(i,"ordinal")),"ordinal";if(u.contains(["x","y"],i)){if("rect"===t)return"band";if("bar"===t)return"band"}return"point";case"temporal":return"color"===i?"sequential":"discrete"===r.rangeType(i)?(a.warn(a.message.discreteChannelCannotEncode(i,"temporal")),"ordinal"):"time";case"quantitative":return"color"===i?e.bin?"bin-ordinal":"sequential":"discrete"===r.rangeType(i)?(a.warn(a.message.discreteChannelCannotEncode(i,"quantitative")),"ordinal"):e.bin&&"x"!==i&&"y"!==i?"bin-linear":"linear";}throw new Error(a.message.invalidFieldType(e.type))}function i(a,e){var t=e.type;return c.contains([l.Type.ORDINAL,l.Type.NOMINAL],t)?void 0===a||s.hasDiscreteDomain(a):t===l.Type.TEMPORAL?c.contains([o.ScaleType.TIME,o.ScaleType.UTC,o.ScaleType.SEQUENTIAL,void 0],a):t!==l.Type.QUANTITATIVE||(e.bin?c.contains([o.ScaleType.BIN_LINEAR,o.ScaleType.BIN_ORDINAL,o.ScaleType.LINEAR],a):c.contains([o.ScaleType.LOG,o.ScaleType.POW,o.ScaleType.SQRT,o.ScaleType.QUANTILE,o.ScaleType.QUANTIZE,o.ScaleType.LINEAR,o.ScaleType.SEQUENTIAL,void 0],a))}Object.defineProperty(t,"__esModule",{value:!0});var r=d("../../channel"),a=d("../../log"),o=d("../../scale"),s=d("../../scale"),l=d("../../type"),u=d("../../util"),c=d("../../util");t.scaleType=function(s,e,t,n){var l=p(e,t,n);return r.isScaleChannel(e)?void 0===s?l:o.channelSupportScaleType(e,s)?i(s,t)?s:(a.warn(a.message.scaleTypeNotWorkWithFieldDef(s,l)),l):(a.warn(a.message.scaleTypeNotWorkWithChannel(e,s,l)),l):null},t.fieldDefMatchScaleType=i},{"../../channel":16,"../../log":106,"../../scale":109,"../../type":118,"../../util":119}],78:[function(d,e,_){"use strict";function S(l,e,t){var r=u.channelSignalName(e,t,"visual"),f=u.channelSignalName(e,t,"data"),S=c.default.has(e),d=l.scaleName(t),p=E.stringValue(d),m=l.getScaleComponent(t),g=m?m.get("type"):void 0,h=l.getSizeSignalRef(t===x.X?"width":"height").signal,v=t+"(unit)",y=n(e,function(a,e){return a.concat({events:e.between[0],update:"["+v+", "+v+"]"},{events:e,update:"["+r+"[0], clamp("+v+", 0, "+h+")]"})});return y.push({events:{signal:e.name+_.SCALE_TRIGGER},update:o.hasContinuousDomain(g)&&!o.isBinScale(g)?"[scale("+p+", "+f+"[0]), scale("+p+", "+f+"[1])]":"[0, 0]"}),S?[{name:f,on:[]}]:[{name:r,value:[],on:y},{name:f,on:[{events:{signal:r},update:r+"[0] === "+r+"[1] ? null : invert("+p+", "+r+")"}]}]}function n(a,o){return a.events.reduce(function(t,e){return e.between?o(t,e):(i.warn(e+" is not an ordered event stream for interval selections"),t)},[])}Object.defineProperty(_,"__esModule",{value:!0});var b=d("tslib"),x=d("../../channel"),i=d("../../log"),o=d("../../scale"),E=d("../../util"),u=d("./selection"),c=d("./transforms/scales");_.BRUSH="_brush",_.SCALE_TRIGGER="_scale_trigger";_.default={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(l,e){var t=e.name,a=c.default.has(e),s=[],p=[],m=[],g=[];if(e.translate&&!a){var r="!event.item || event.item.mark.name !== "+E.stringValue(t+_.BRUSH);n(e,function(a,e){var t=e.between[0].filter||(e.between[0].filter=[]);0>t.indexOf(r)&&t.push(r)})}return e.project.forEach(function(t){var n=t.channel;if(n===x.X||n===x.Y){var r=S(l,e,n),a=u.channelSignalName(e,n,"data"),c=u.channelSignalName(e,n,"visual"),d=E.stringValue(l.scaleName(n)),f=l.getScaleComponent(n).get("type"),h=o.hasContinuousDomain(f)?"+":"";s.push.apply(s,r),m.push(a),p.push("{encoding: "+E.stringValue(n)+", field: "+E.stringValue(t.field)+", extent: "+a+"}"),g.push({scaleName:l.scaleName(n),expr:"(!isArray("+a+") || ("+h+"invert("+d+", "+c+")[0] === "+h+a+"[0] && "+h+"invert("+d+", "+c+")[1] === "+h+a+"[1]))"})}else i.warn("Interval selections only support x and y encoding channels.")}),a||s.push({name:t+_.SCALE_TRIGGER,update:g.map(function(t){return t.expr}).join(" && ")+" ? "+(t+_.SCALE_TRIGGER)+" : {}"}),s.concat({name:t+u.TUPLE,on:[{events:m.map(function(t){return{signal:t}}),update:m.join(" && ")+" ? {unit: "+u.unitName(l)+", intervals: ["+p.join(", ")+"]} : null"}]})},modifyExpr:function(a,e){return e.name+u.TUPLE+", "+("global"===e.resolve?"true":"{unit: "+u.unitName(a)+"}")},marks:function(a,e,t){var n=e.name,i=u.positionalProjections(e),o=i.xi,s=i.yi,l="data("+E.stringValue(e.name+u.STORE)+")";if(c.default.has(e))return t;var r={x:null===o?{value:0}:{signal:n+"_x[0]"},y:null===s?{value:0}:{signal:n+"_y[0]"},x2:null===o?{field:{group:"width"}}:{signal:n+"_x[1]"},y2:null===s?{field:{group:"height"}}:{signal:n+"_y[1]"}};"global"===e.resolve&&E.keys(r).forEach(function(e){r[e]=[b.__assign({test:l+".length && "+l+"[0].unit === "+u.unitName(a)},r[e]),{value:0}]});var d=e.mark,m=d.fill,f=d.fillOpacity,S=b.__rest(d,["fill","fillOpacity"]),v=E.keys(S).reduce(function(a,e){return a[e]={value:S[e]},a},{});return[{name:n+_.BRUSH+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:m},fillOpacity:{value:f}},update:r}}].concat(t,{name:n+_.BRUSH,type:"rect",clip:!0,encode:{enter:b.__assign({fill:{value:"transparent"}},v),update:r}})}}},{"../../channel":16,"../../log":106,"../../scale":109,"../../util":119,"./selection":80,"./transforms/scales":85,tslib:6}],79:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o("../../util"),i=o("./selection"),r=o("./transforms/nearest");t.default={predicate:"vlMulti",scaleDomain:"vlMultiDomain",signals:function(a,e){var t=e.project,d=r.default.has(e)?"(item().isVoronoi ? datum.datum : datum)":"datum",o=[],n=t.map(function(t){return l.stringValue(t.channel)}).filter(function(t){return t}).join(", "),s=t.map(function(t){return l.stringValue(t.field)}).join(", "),p=t.map(function(e){var t=e.channel,n=a.fieldDef(t);return n&&n.bin?(o.push(e.field),"["+d+l.accessPath(a.field(t,{}))+", "+d+l.accessPath(a.field(t,{binSuffix:"end"}))+"]"):""+d+l.accessPath(e.field)}).join(", ");return[{name:e.name+i.TUPLE,value:{},on:[{events:e.events,update:"datum && item().mark.marktype !== 'group' ? {unit: "+i.unitName(a)+", encodings: ["+n+"], fields: ["+s+"], values: ["+p+"]"+(o.length?", "+o.map(function(t){return l.stringValue("bin_"+t)+": 1"}).join(", "):"")+"} : null",force:!0}]}]},modifyExpr:function(a,e){return e.name+i.TUPLE+", "+("global"===e.resolve?"null":"{unit: "+i.unitName(a)+"}")}}},{"../../util":119,"./selection":80,"./transforms/nearest":83}],80:[function(y,e,_){"use strict";function n(a,e){return b(a,function(t,n){e=n.marks?n.marks(a,t,e):e,p.forEachTransform(t,function(n){n.marks&&(e=n.marks(a,t,e))})}),e}function b(a,e){var t=a.component.selection;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];e(i,S(i.type))}}function S(t){return"single"===t?c.default:"multi"===t?d.default:"interval"===t?l.default:null}function r(a){for(var e=a.parent;e&&!i.isFacetModel(e);)e=e.parent;return e}Object.defineProperty(_,"__esModule",{value:!0});var x=y("tslib"),s=y("vega-event-selector"),o=y("../../channel"),a=y("../../log"),t=y("../../selection"),f=y("../../util"),i=y("../model"),l=y("./interval"),d=y("./multi"),c=y("./single"),p=y("./transforms/transforms");_.STORE="_store",_.TUPLE="_tuple",_.MODIFY="_modify",_.SELECTION_DOMAIN="_selection_domain_",_.parseUnitSelection=function(o,e){var t={},n=o.config.selection;for(var a in e)!function(i){if(!e.hasOwnProperty(i))return"continue";var l=e[i],a=n[l.type];for(var d in a)"encodings"===d&&l.fields||"fields"===d&&l.encodings||("mark"===d&&(l[d]=x.__assign({},a[d],l[d])),void 0!==l[d]&&!0!==l[d]||(l[d]=a[d]||l[d]));i=f.varName(i);var u=t[i]=x.__assign({},l,{name:i,events:f.isString(l.on)?s.selector(l.on,"scope"):l.on});p.forEachTransform(u,function(e){e.parse&&e.parse(o,l,u)})}(a);return t},_.assembleUnitSelectionSignals=function(l,e){b(l,function(t,n){var i=t.name,a=n.modifyExpr(l,t);e.push.apply(e,n.signals(l,t)),p.forEachTransform(t,function(i){i.signals&&(e=i.signals(l,t,e)),i.modifyExpr&&(a=i.modifyExpr(l,t,a))}),e.push({name:i+_.MODIFY,on:[{events:{signal:i+_.TUPLE},update:"modify("+f.stringValue(t.name+_.STORE)+", "+a+")"}]})});var t=r(l);if(e.length&&t){var n=f.stringValue(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:s.selector("mousemove","scope"),update:"isTuple(facet) ? facet : group("+n+").datum"}]})}return e},_.assembleTopLevelSignals=function(a,e){var t=!1;return b(a,function(o,n){n.topLevelSignals&&(e=n.topLevelSignals(a,o,e)),p.forEachTransform(o,function(t){t.topLevelSignals&&(e=t.topLevelSignals(a,o,e))}),t=!0}),t&&(e.filter(function(t){return"unit"===t.name}).length||e.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})),e},_.assembleUnitSelectionData=function(a,n){return b(a,function(a){n.filter(function(e){return e.name===a.name+_.STORE}).length||n.push({name:a.name+_.STORE})}),n},_.assembleUnitSelectionMarks=n,_.assembleLayerSelectionMarks=function(a,o){return a.children.forEach(function(t){i.isUnitModel(t)&&(o=n(t,o))}),o},_.predicate=function(a,e,t){var n=[],i=f.logicalExpr(e,function(e){var i=f.varName(e),o=a.getSelectionComponent(i,e),s=f.stringValue(i+_.STORE);if(o.timeUnit){var l=t||a.component.data.raw,r=o.timeUnit.clone();l.parent?r.insertAsParentOf(l):l.parent=r}return"none"!==o.empty&&n.push(s),S(o.type).predicate+"("+s+", datum"+("global"===o.resolve?")":", "+f.stringValue(o.resolve)+")")});return(n.length?"!("+n.map(function(t){return"length(data("+t+"))"}).join(" || ")+") || ":"")+"("+i+")"},_.isRawSelectionDomain=function(t){return 0<=t.signal.indexOf(_.SELECTION_DOMAIN)},_.selectionScaleDomain=function(n,e){var t=JSON.parse(e.signal.replace(_.SELECTION_DOMAIN,"")),i=f.varName(t.selection),l=n.component.selection&&n.component.selection[i];return l?(a.warn("Use \"bind\": \"scales\" to setup a binding for scales and selections within the same view."),{signal:"null"}):(l=n.getSelectionComponent(i,t.selection),t.encoding||t.field||(t.field=l.project[0].field,1<l.project.length&&a.warn("A \"field\" or \"encoding\" must be specified when using a selection as a scale domain. Using \"field\": "+f.stringValue(t.field)+".")),{signal:S(l.type).scaleDomain+"("+f.stringValue(i+_.STORE)+", "+f.stringValue(t.encoding||null)+", "+f.stringValue(t.field||null)+("global"===l.resolve?")":", "+f.stringValue(l.resolve)+")")})},_.unitName=function(a){var e=f.stringValue(a.name),t=r(a);return t&&(e+=(t.facet.row?" + '_' + facet"+f.accessPath(t.field("row")):"")+(t.facet.column?" + '_' + facet"+f.accessPath(t.field("column")):"")),e},_.requiresSelectionId=function(a){var n=!1;return b(a,function(a){n=n||a.project.some(function(a){return a.field===t.SELECTION_ID})}),n},_.channelSignalName=function(a,e,t){return f.varName(a.name+"_"+("visual"===t?e:a.fields[e]))},_.positionalProjections=function(a){var l=null,s=null,d=null,c=null;return a.project.forEach(function(t,e){t.channel===o.X?(l=t,s=e):t.channel===o.Y&&(d=t,c=e)}),{x:l,xi:s,y:d,yi:c}}},{"../../channel":16,"../../log":106,"../../selection":110,"../../util":119,"../model":67,"./interval":78,"./multi":79,"./single":81,"./transforms/transforms":87,tslib:6,"vega-event-selector":10}],81:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l("../../util"),n=l("./multi"),i=l("./selection"),a={predicate:"vlSingle",scaleDomain:"vlSingleDomain",signals:n.default.signals,topLevelSignals:function(a,l,e){var t=e.filter(function(t){return t.name===l.name}),n="data("+s.stringValue(l.name+i.STORE)+")";return t.length?e:e.concat({name:l.name,update:n+".length && {"+l.project.map(function(a,e){return a.field+": "+(n+"[0].values")+"["+e+"]"}).join(", ")+"}"})},modifyExpr:function(a,e){return e.name+i.TUPLE+", "+("global"===e.resolve?"true":"{unit: "+i.unitName(a)+"}")}};t.default=a},{"../../util":119,"./multi":79,"./selection":80}],82:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=o("../../../util"),n=o("../selection"),i=o("./nearest");t.default={has:function(t){return"single"===t.type&&"global"===t.resolve&&t.bind&&"scales"!==t.bind},topLevelSignals:function(a,c,t){var n=c.name,e=c.project,o=c.bind,s=i.default.has(c)?"(item().isVoronoi ? datum.datum : datum)":"datum";return e.forEach(function(i){var l=d.varName(n+"_"+i.field);t.filter(function(t){return t.name===l}).length||t.unshift({name:l,value:"",on:[{events:c.events,update:"datum && item().mark.marktype !== 'group' ? "+s+d.accessPath(i.field)+" : null"}],bind:o[i.field]||o[i.channel]||o})}),t},signals:function(i,e,t){var r=e.name,a=e.project,o=t.filter(function(t){return t.name===r+n.TUPLE})[0],s=a.map(function(t){return d.stringValue(t.field)}).join(", "),l=a.map(function(t){return d.varName(r+"_"+t.field)});return o.update=l.join(" && ")+" ? {fields: ["+s+"], values: ["+l.join(", ")+"]} : null",delete o.value,delete o.on,t}}},{"../../../util":119,"../selection":80,"./nearest":83}],83:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=a("../../../log"),i=a("../selection");t.default={has:function(t){return"interval"!==t.type&&t.nearest},marks:function(r,e,t){var n=i.positionalProjections(e),a=n.x,p=n.y,m=r.mark();if("line"===m||"area"===m)return d.warn(d.message.nearestNotSupportForContinuous(m)),t;var l={name:r.getName("voronoi"),type:"path",from:{data:r.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:!a&&(a||p)?{expr:"0"}:"datum.x",y:!p&&(a||p)?{expr:"0"}:"datum.y",size:[r.getSizeSignalRef("width"),r.getSizeSignalRef("height")]}]},u=0,c=!1;return t.forEach(function(e,t){var a=e.name||"";a===r.component.mark[0].name?u=t:0<=a.indexOf("voronoi")&&(c=!0)}),c||t.splice(u+1,0,l),t}}},{"../../../log":106,"../selection":80}],84:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o("../../../log"),i=o("../../../util"),r=o("../../data/timeunit");t.default={has:function(t){return void 0!==t.fields||void 0!==t.encodings},parse:function(a,e,t){var d={},o={};(e.fields||[]).forEach(function(t){return d[t]=null}),(e.encodings||[]).forEach(function(e){var t=a.fieldDef(e);if(!t)l.warn(l.message.cannotProjectOnChannelWithoutField(e));else if(t.timeUnit){var i=a.field(e);d[i]=e,o[i]={as:i,field:t.field,timeUnit:t.timeUnit}}else d[t.field]=e});var n=t.project||(t.project=[]);for(var s in d)d.hasOwnProperty(s)&&n.push({field:s,channel:d[s]});var p=t.fields||(t.fields={});n.filter(function(t){return t.channel}).forEach(function(t){return p[t.channel]=t.field}),i.keys(o).length&&(t.timeUnit=new r.TimeUnitNode(o))}}},{"../../../log":106,"../../../util":119,"../../data/timeunit":44}],85:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=l("../../../log"),i=l("../../../scale"),n=l("../../../util"),r=l("../selection");t.default={has:function(t){return"interval"===t.type&&"global"===t.resolve&&t.bind&&"scales"===t.bind},parse:function(o,e,c){var n=c.scales=[];c.project.forEach(function(e){var t=e.channel,a=o.getScaleComponent(t),l=a?a.get("type"):void 0;a&&i.hasContinuousDomain(l)&&!i.isBinScale(l)?(a.set("domainRaw",{signal:r.channelSignalName(c,t,"data")},!0),n.push(t)):d.warn(d.message.SCALE_BINDINGS_CONTINUOUS)})},topLevelSignals:function(a,o,t){if(!a.parent)return t;var e=o.scales.filter(function(a){return!t.filter(function(e){return e.name===r.channelSignalName(o,a,"data")}).length});return t.concat(e.map(function(t){return{name:r.channelSignalName(o,t,"data")}}))},signals:function(a,i,t){return a.parent&&i.scales.forEach(function(a){var e=t.filter(function(e){return e.name===r.channelSignalName(i,a,"data")})[0];e.push="outer",delete e.value,delete e.update}),t}},t.domain=function(a,e){return"domain("+n.stringValue(a.scaleName(e))+")"}},{"../../../log":106,"../../../scale":109,"../../../util":119,"../selection":80}],86:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("../selection");t.default={has:function(t){return"multi"===t.type&&t.toggle},signals:function(a,e,t){return t.concat({name:e.name+"_toggle",value:!1,on:[{events:e.events,update:e.toggle}]})},modifyExpr:function(i,e){var t=e.name+n.TUPLE,o=e.name+"_toggle";return o+" ? null : "+t+", "+("global"===e.resolve?o+" ? null : true, ":o+" ? null : {unit: "+n.unitName(i)+"}, ")+o+" ? "+t+" : null"}}},{"../selection":80}],87:[function(d,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d("./inputs"),i=d("./nearest"),r=d("./project"),a=d("./scales"),o=d("./toggle"),s=d("./translate"),l=d("./zoom"),p={project:r.default,toggle:o.default,scales:a.default,translate:s.default,zoom:l.default,inputs:n.default,nearest:i.default};t.forEachTransform=function(a,e){for(var t in p)p[t].has(a)&&e(p[t])}},{"./inputs":82,"./nearest":83,"./project":84,"./scales":85,"./toggle":86,"./translate":88,"./zoom":89}],88:[function(d,e,t){"use strict";function y(a,c,t,e,n){var r=c.name,p=s.default.has(c),f=n.filter(function(a){return a.name===o.channelSignalName(c,t,p?"data":"visual")})[0],d=r+u,x=a.getSizeSignalRef(e).signal,g=a.getScaleComponent(t),h=g.get("type"),v=p&&t===S.X?"-":"",y=r+l+".extent_"+t,b=(p?"log"===h?"panLog":"pow"===h?"panPow":"panLinear":"panLinear")+"("+y+", "+(""+v+d+"."+t+" / "+(p?""+x:"span("+y+")"))+(p&&"pow"===h?", "+(g.get("exponent")||1):"")+")";f.on.push({events:{signal:d},update:p?b:"clampRange("+b+", 0, "+x+")"})}Object.defineProperty(t,"__esModule",{value:!0});var i=d("vega-event-selector"),S=d("../../../channel"),a=d("../interval"),o=d("../selection"),s=d("./scales"),l="_translate_anchor",u="_translate_delta";t.default={has:function(t){return"interval"===t.type&&t.translate},signals:function(r,e,t){var n=e.name,c=s.default.has(e),d=n+l,f=o.positionalProjections(e),m=f.x,g=f.y,h=i.selector(e.translate,"scope");return c||(h=h.map(function(t){return t.between[0].markname=n+a.BRUSH,t})),t.push({name:d,value:{},on:[{events:h.map(function(t){return t.between[0]}),update:"{x: x(unit), y: y(unit)"+(null===m?"":", extent_x: "+(c?s.domain(r,S.X):"slice("+o.channelSignalName(e,"x","visual")+")"))+(null===g?"":", extent_y: "+(c?s.domain(r,S.Y):"slice("+o.channelSignalName(e,"y","visual")+")"))+"}"}]},{name:n+u,value:{},on:[{events:h,update:"{x: "+d+".x - x(unit), y: "+d+".y - y(unit)}"}]}),null!==m&&y(r,e,S.X,"width",t),null!==g&&y(r,e,S.Y,"height",t),t}}},{"../../../channel":16,"../interval":78,"../selection":80,"./scales":85,"vega-event-selector":10}],89:[function(d,e,t){"use strict";function m(f,y,t,e,n){var r=y.name,a=l.default.has(y),o=n.filter(function(n){return n.name===s.channelSignalName(y,t,a?"data":"visual")})[0],_=f.getSizeSignalRef(e).signal,d=f.getScaleComponent(t),p=d.get("type"),m=a?l.domain(f,t):o.name,g=r+c,b=(a?"log"===p?"zoomLog":"pow"===p?"zoomPow":"zoomLinear":"zoomLinear")+"("+m+", "+(""+r+u+"."+t)+", "+g+(a&&"pow"===p?", "+(d.get("exponent")||1):"")+")";o.on.push({events:{signal:g},update:a?b:"clampRange("+b+", 0, "+_+")"})}Object.defineProperty(t,"__esModule",{value:!0});var i=d("vega-event-selector"),r=d("../../../channel"),a=d("../../../util"),n=d("../interval"),s=d("../selection"),l=d("./scales"),u="_zoom_anchor",c="_zoom_delta";t.default={has:function(t){return"interval"===t.type&&t.zoom},signals:function(o,e,t){var f=e.name,d=l.default.has(e),p=s.positionalProjections(e),g=p.x,h=p.y,S=a.stringValue(o.scaleName(r.X)),y=a.stringValue(o.scaleName(r.Y)),b=i.selector(e.zoom,"scope");return d||(b=b.map(function(t){return t.markname=f+n.BRUSH,t})),t.push({name:f+u,on:[{events:b,update:d?"{"+[S?"x: invert("+S+", x(unit))":"",y?"y: invert("+y+", y(unit))":""].filter(function(t){return!!t}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:f+c,on:[{events:b,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==g&&m(o,e,"x","width",t),null!==h&&m(o,e,"y","height",t),t}}},{"../../../channel":16,"../../../util":119,"../interval":78,"../selection":80,"./scales":85,"vega-event-selector":10}],90:[function(l,e,t){"use strict";function d(a,e,t,n){return a.explicit&&e.explicit&&r.warn(r.message.mergeConflictingProperty(t,n,a.value,e.value)),a}Object.defineProperty(t,"__esModule",{value:!0});var n=l("tslib"),r=l("../log"),a=l("../util"),i=function(){function t(a,n){void 0===a&&(a={}),void 0===n&&(n={}),this.explicit=a,this.implicit=n}return t.prototype.clone=function(){return new t(a.duplicate(this.explicit),a.duplicate(this.implicit))},t.prototype.combine=function(){return n.__assign({},this.explicit,this.implicit)},t.prototype.get=function(t){return void 0===this.explicit[t]?this.implicit[t]:this.explicit[t]},t.prototype.getWithExplicit=function(t){return void 0===this.explicit[t]?void 0===this.implicit[t]?{explicit:!1,value:void 0}:{explicit:!1,value:this.implicit[t]}:{explicit:!0,value:this.explicit[t]}},t.prototype.setWithExplicit=function(a,e){void 0!==e.value&&this.set(a,e.value,e.explicit)},t.prototype.set=function(a,e,t){return delete this[t?"implicit":"explicit"][a],this[t?"explicit":"implicit"][a]=e,this},t.prototype.copyKeyFromSplit=function(a,e){void 0===e.explicit[a]?void 0!==e.implicit[a]&&this.set(a,e.implicit[a],!1):this.set(a,e.explicit[a],!0)},t.prototype.copyKeyFromObject=function(a,e){void 0!==e[a]&&this.set(a,e[a],!0)},t}();t.Split=i,t.makeExplicit=function(t){return{explicit:!0,value:t}},t.makeImplicit=function(t){return{explicit:!1,value:t}},t.tieBreakByComparing=function(i){return function(e,t,n,l){var a=i(e.value,t.value);return 0<a?e:0>a?t:d(e,t,n,l)}},t.defaultTieBreaker=d,t.mergeValuesWithExplicit=function(i,e,t,n,o){return void 0===o&&(o=d),void 0===i||void 0===i.value?e:i.explicit&&!e.explicit?i:e.explicit&&!i.explicit?e:i.value===e.value?i:o(i,e,t,n)}},{"../log":106,"../util":119,tslib:6}],91:[function(S,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var x=S("tslib"),i=S("../channel"),n=S("../encoding"),E=S("../encoding"),N=S("../fielddef"),o=S("../mark"),l=S("../stack"),a=S("../util"),s=S("./axis/parse"),r=S("./data/parse"),d=S("./layoutsize/assemble"),c=S("./layoutsize/parse"),u=S("./mark/init"),p=S("./mark/mark"),m=S("./model"),g=S("./repeater"),f=S("./selection/selection"),h=function(h){function e(e,i,n,r,a,s,c){void 0===r&&(r={});var f=h.call(this,e,i,n,s,void 0)||this;f.fit=c,f.type="unit",f.specifiedScales={},f.specifiedAxes={},f.specifiedLegends={},f.selection={},f.children=[],f.initSize(x.__assign({},r,e.width?{width:e.width}:{},e.height?{height:e.height}:{}));var d=o.isMarkDef(e.mark)?e.mark.type:e.mark,p=f.encoding=E.normalizeEncoding(g.replaceRepeaterInEncoding(e.encoding||{},a),d);return f.markDef=u.normalizeMarkDef(e.mark,p,s),f.stack=l.stack(d,p,f.config.stack),f.specifiedScales=f.initScales(d,p),f.encoding=u.initEncoding(f.markDef,p,f.stack,f.config),f.specifiedAxes=f.initAxes(p),f.specifiedLegends=f.initLegend(p),f.selection=e.selection,f}return x.__extends(e,h),e.prototype.scaleDomain=function(a){var e=this.specifiedScales[a];return e?e.domain:void 0},e.prototype.sort=function(t){return(this.getMapping()[t]||{}).sort},e.prototype.axis=function(t){return this.specifiedAxes[t]},e.prototype.legend=function(t){return this.specifiedLegends[t]},e.prototype.initScales=function(a,o){return i.SCALE_CHANNELS.reduce(function(t,e){var n,i,l=o[e];return N.isFieldDef(l)?(n=l,i=l.scale):N.hasConditionalFieldDef(l)?(n=l.condition,i=l.condition.scale):"x"===e?n=N.getFieldDef(o.x2):"y"===e&&(n=N.getFieldDef(o.y2)),n&&(t[e]=i||{}),t},{})},e.prototype.initAxes=function(l){return[i.X,i.Y].reduce(function(e,t){var n=l[t];if(N.isFieldDef(n)||t===i.X&&N.isFieldDef(l.x2)||t===i.Y&&N.isFieldDef(l.y2)){var a=N.isFieldDef(n)?n.axis:null;null!==a&&!1!==a&&(e[t]=x.__assign({},a))}return e},{})},e.prototype.initLegend=function(o){return i.NONPOSITION_SCALE_CHANNELS.reduce(function(e,t){var n=o[t];if(n){var i=N.isFieldDef(n)?n.legend:N.hasConditionalFieldDef(n)?n.condition.legend:null;null!==i&&!1!==i&&(e[t]=x.__assign({},i))}return e},{})},e.prototype.parseData=function(){this.component.data=r.parseData(this)},e.prototype.parseLayoutSize=function(){c.parseUnitLayoutSize(this)},e.prototype.parseSelection=function(){this.component.selection=f.parseUnitSelection(this,this.selection)},e.prototype.parseMarkGroup=function(){this.component.mark=p.parseMarkGroup(this)},e.prototype.parseAxisAndHeader=function(){this.component.axes=s.parseUnitAxis(this)},e.prototype.assembleSelectionTopLevelSignals=function(t){return f.assembleTopLevelSignals(this,t)},e.prototype.assembleSelectionSignals=function(){return f.assembleUnitSelectionSignals(this,[])},e.prototype.assembleSelectionData=function(t){return f.assembleUnitSelectionData(this,t)},e.prototype.assembleLayout=function(){return null},e.prototype.assembleLayoutSignals=function(){return d.assembleLayoutSignals(this)},e.prototype.assembleMarks=function(){var t=this.component.mark||[];return this.parent&&m.isLayerModel(this.parent)||(t=f.assembleUnitSelectionMarks(this,t)),t.map(this.correctDataNames)},e.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.getMapping=function(){return this.encoding},e.prototype.toSpec=function(o,e){var t,n=a.duplicate(this.encoding);return t={mark:this.markDef,encoding:n},o||(t.config=a.duplicate(this.config)),e||(t.data=a.duplicate(this.data)),t},e.prototype.mark=function(){return this.markDef.type},e.prototype.channelHasField=function(t){return n.channelHasField(this.encoding,t)},e.prototype.fieldDef=function(a){var e=this.encoding[a];return N.getFieldDef(e)},e}(m.ModelWithField);t.UnitModel=h},{"../channel":16,"../encoding":99,"../fielddef":101,"../mark":108,"../stack":113,"../util":119,"./axis/parse":21,"./data/parse":41,"./layoutsize/assemble":48,"./layoutsize/parse":49,"./mark/init":57,"./mark/mark":59,"./model":67,"./repeater":69,"./selection/selection":80,tslib:6}],92:[function(h,e,y){"use strict";function T(t){return!!t.type}function i(a){return k.__assign({},a,{encoding:t.reduce(a.encoding,function(a,e,t){return-1<c.indexOf(t)?a[t]=e:d.warn(d.message.incompatibleChannel(t,y.BOXPLOT)),a},{})})}function r(a){var e=a.mark,t=a.encoding;if(k.__rest(a,["mark","encoding"]),f.isFieldDef(t.x)&&f.isContinuous(t.x)){if(f.isFieldDef(t.y)&&f.isContinuous(t.y)){if(void 0===t.x.aggregate&&t.y.aggregate===y.BOXPLOT)return"vertical";if(void 0===t.y.aggregate&&t.x.aggregate===y.BOXPLOT)return"horizontal";if(t.x.aggregate===y.BOXPLOT&&t.y.aggregate===y.BOXPLOT)throw new Error("Both x and y cannot have aggregate");return T(e)&&e.orient?e.orient:"vertical"}return"horizontal"}if(f.isFieldDef(t.y)&&f.isContinuous(t.y))return"vertical";throw new Error("Need a valid continuous axis for boxplots")}function n(n,e){n.mark;var t,l,c=n.encoding;if(k.__rest(n,["mark","encoding"]),"vertical"===e?(l="y",t=c.y):(l="x",t=c.x),t&&t.aggregate){var a=t.aggregate,p=k.__rest(t,["aggregate"]);a!==y.BOXPLOT&&d.warn("Continuous axis should not have customized aggregation function "+a),t=p}return{continuousAxisChannelDef:t,continuousAxis:l}}function a(d,e,t){var i=n(d,e),r=i.continuousAxisChannelDef,_=i.continuousAxis,b=d.encoding,l=[{op:"q1",field:r.field,as:"lowerBox"},{op:"q3",field:r.field,as:"upperBox"},{op:"median",field:r.field,as:"midBox"}],u=[];void 0===t?(l.push({op:"min",field:r.field,as:"lowerWhisker"}),l.push({op:"max",field:r.field,as:"upperWhisker"})):u=[{calculate:"datum.upperBox - datum.lowerBox",as:"IQR"},{calculate:"datum.lowerBox - datum.IQR * "+t,as:"lowerWhisker"},{calculate:"datum.upperBox + datum.IQR * "+t,as:"upperWhisker"}];var p=[],S=[],g=[],h={};return o.forEach(b,function(n,e){if(e!==_)if(f.isFieldDef(n)){if(n.aggregate&&n.aggregate!==y.BOXPLOT)l.push({op:n.aggregate,field:n.field,as:f.field(n)});else if(void 0===n.aggregate){var t=f.field(n),s=n.bin;if(s){var d=n.field;S.push({bin:s,field:d,as:t})}else if(n.timeUnit){var c=n.timeUnit,m=n.field;g.push({timeUnit:c,field:m,as:t})}p.push(t)}h[e]={field:f.field(n),type:n.type}}else h[e]=b[e]}),{transform:[].concat(S,g,[{aggregate:l,groupby:p}],u),continuousAxisChannelDef:r,continuousAxis:_,encodingWithoutContinuousAxis:h}}Object.defineProperty(y,"__esModule",{value:!0});var k=h("tslib"),l=h("vega-util"),t=h("../encoding"),o=h("./../encoding"),f=h("./../fielddef"),d=h("./../log"),s=h("./common");y.BOXPLOT="box-plot",y.isBoxPlotDef=T,y.BOXPLOT_STYLES=["boxWhisker","box","boxMid"],y.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX={box:["size","color"],boxWhisker:["color"],boxMid:["color"]};var c=["x","y","color","detail","opacity","size"];y.filterUnsupportedChannels=i,y.normalizeBoxPlot=function(u,e){var t,m=(u=i(u)).mark,n=(u.encoding,u.selection),f=k.__rest(u,["mark","encoding","selection"]);T(m)&&m.extent&&l.isNumber(m.extent)&&(t=m.extent);var c=a(u,r(u),t),d=c.transform,D=c.continuousAxisChannelDef,g=c.continuousAxis,h=c.encodingWithoutContinuousAxis,v=(h.color,h.size),C=k.__rest(h,["color","size"]),b=v?{size:v}:s.getMarkSpecificConfigMixins(e.box,"size"),_={};return D.scale&&(_.scale=D.scale),D.axis&&(_.axis=D.axis),k.__assign({},f,{transform:d,layer:[{mark:{type:"rule",style:"boxWhisker"},encoding:k.__assign((S={},S[g]=k.__assign({field:"lowerWhisker",type:D.type},_),S[g+"2"]={field:"lowerBox",type:D.type},S),C,s.getMarkSpecificConfigMixins(e.boxWhisker,"color"))},{mark:{type:"rule",style:"boxWhisker"},encoding:k.__assign((x={},x[g]={field:"upperBox",type:D.type},x[g+"2"]={field:"upperWhisker",type:D.type},x),C,s.getMarkSpecificConfigMixins(e.boxWhisker,"color"))},k.__assign({},n?{selection:n}:{},{mark:{type:"bar",style:"box"},encoding:k.__assign((E={},E[g]={field:"lowerBox",type:D.type},E[g+"2"]={field:"upperBox",type:D.type},E),h,h.color?{}:s.getMarkSpecificConfigMixins(e.box,"color"),b)}),{mark:{type:"tick",style:"boxMid"},encoding:k.__assign((O={},O[g]={field:"midBox",type:D.type},O),C,s.getMarkSpecificConfigMixins(e.boxMid,"color"),b)}]});var S,x,E,O}},{"../encoding":99,"./../encoding":99,"./../fielddef":101,"./../log":106,"./common":93,tslib:6,"vega-util":11}],93:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkSpecificConfigMixins=function(a,e){var t=a[e];return void 0===t?{}:(o={},o[e]={value:t},o);var o}},{}],94:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("tslib");t.ERRORBAR="error-bar",t.normalizeErrorBar=function(i){i.mark,i.selection;var e=i.encoding,t=l.__rest(i,["mark","selection","encoding"]),n=(e.size,l.__rest(e,["size"])),s=(e.x2,e.y2,l.__rest(e,["x2","y2"])),d=(s.x,s.y,l.__rest(s,["x","y"]));if(!e.x2&&!e.y2)throw new Error("Neither x2 or y2 provided");return l.__assign({},t,{layer:[{mark:"rule",encoding:n},{mark:"tick",encoding:s},{mark:"tick",encoding:e.x2?l.__assign({x:e.x2,y:e.y},d):l.__assign({x:e.x,y:e.y2},d)}]})}},{tslib:6}],95:[function(d,e,t){"use strict";function n(a,e){s[a]=e}Object.defineProperty(t,"__esModule",{value:!0});var i=d("tslib"),r=d("./../mark"),a=d("./boxplot"),o=d("./errorbar"),s={};t.add=n,t.remove=function(t){delete s[t]},t.COMPOSITE_MARK_STYLES=a.BOXPLOT_STYLES,t.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=i.__assign({},a.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX),n(a.BOXPLOT,a.normalizeBoxPlot),n(o.ERRORBAR,o.normalizeErrorBar),t.normalize=function(a,e){var t=r.isMarkDef(a.mark)?a.mark.type:a.mark,n=s[t];if(n)return n(a,e);throw new Error("Unregistered composite mark "+t)}},{"./../mark":108,"./boxplot":92,"./errorbar":94,tslib:6}],96:[function(y,e,t){"use strict";function n(o,e,t){var n="title"===e?d.extractTitleConfig(o.title).mark:o[e];"view"===e&&(t="cell");var l=_.__assign({},n,o.style[e]);0<u.keys(l).length&&(o.style[t||e]=l),delete o[e]}Object.defineProperty(t,"__esModule",{value:!0});var _=y("tslib"),i=y("./compositemark"),a=y("./compositemark/index"),b=y("./guide"),o=y("./legend"),l=y("./mark"),s=y("./mark"),r=y("./scale"),c=y("./selection"),d=y("./title"),u=y("./util");t.defaultViewConfig={width:200,height:200},t.defaultConfig={padding:5,timeFormat:"%b %d, %Y",countTitle:"Number of Records",invalidValues:"filter",view:t.defaultViewConfig,mark:s.defaultMarkConfig,area:{},bar:s.defaultBarConfig,circle:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:s.defaultTickConfig,box:{size:14},boxWhisker:{},boxMid:{color:"white"},scale:r.defaultScaleConfig,axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:o.defaultLegendConfig,selection:c.defaultConfig,style:{},title:{}},t.initConfig=function(a){return u.mergeDeep(u.duplicate(t.defaultConfig),a)};var m=["view"].concat(l.PRIMITIVE_MARKS,i.COMPOSITE_MARK_STYLES),p=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"],g=_.__assign({view:["width","height"]},l.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX,a.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);t.stripAndRedirectConfig=function(i){i=u.duplicate(i);for(var e=0,t=p;e<t.length;e++)delete i[E=t[e]];if(i.axis)for(var s=0,r=b.VL_ONLY_GUIDE_CONFIG;s<r.length;s++)E=r[s],delete i.axis[E];if(i.legend)for(var a=0,o=b.VL_ONLY_GUIDE_CONFIG;a<o.length;a++)E=o[a],delete i.legend[E];if(i.mark)for(var h=0,c=l.VL_ONLY_MARK_CONFIG_PROPERTIES;h<c.length;h++)E=c[h],delete i.mark[E];for(var f=0,d=m;f<d.length;f++){for(var v=d[f],y=0,N=l.VL_ONLY_MARK_CONFIG_PROPERTIES;y<N.length;y++)E=N[y],delete i[v][E];var _=g[v];if(_)for(var S=0,x=_;S<x.length;S++)E=x[S],delete i[v][E];n(i,v)}for(var E in n(i,"title","group-title"),i)u.isObject(i[E])&&0===u.keys(i[E]).length&&delete i[E];return 0<u.keys(i).length?i:void 0}},{"./compositemark":95,"./compositemark/index":95,"./guide":103,"./legend":105,"./mark":108,"./scale":109,"./selection":110,"./title":115,"./util":119,tslib:6}],97:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUrlData=function(t){return!!t.url},t.isInlineData=function(t){return!!t.values},t.isNamedData=function(t){return!!t.name},t.MAIN="main",t.RAW="raw"},{}],98:[function(l,e,d){"use strict";function p(t){if(o.isNumber(t))return 4<t&&g.warn(g.message.invalidTimeUnit("quarter",t)),t-1+"";throw new Error(g.message.invalidTimeUnit("quarter",t))}function i(n){if(o.isNumber(n))return n-1+"";var e=n.toLowerCase(),t=d.MONTHS.indexOf(e);if(-1!==t)return t+"";var i=e.substr(0,3),l=d.SHORT_MONTHS.indexOf(i);if(-1!==l)return l+"";throw new Error(g.message.invalidTimeUnit("month",n))}function r(n){if(o.isNumber(n))return n%7+"";var e=n.toLowerCase(),t=d.DAYS.indexOf(e);if(-1!==t)return t+"";var i=e.substr(0,3),l=d.SHORT_DAYS.indexOf(i);if(-1!==l)return l+"";throw new Error(g.message.invalidTimeUnit("day",n))}Object.defineProperty(d,"__esModule",{value:!0});var g=l("./log"),o=l("./util");d.isDateTime=function(t){return t&&(t.year||t.quarter||t.month||t.date||t.day||t.hours||t.minutes||t.seconds||t.milliseconds)},d.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],d.SHORT_MONTHS=d.MONTHS.map(function(t){return t.substr(0,3)}),d.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],d.SHORT_DAYS=d.DAYS.map(function(t){return t.substr(0,3)}),d.dateTimeExpr=function(a,e){void 0===e&&(e=!1);var t=[];if(e&&void 0!==a.day&&1<o.keys(a).length&&(g.warn(g.message.droppedDay(a)),delete(a=o.duplicate(a)).day),void 0===a.year?void 0===a.day?t.push(0):t.push(2006):t.push(a.year),void 0!==a.month){var n=e?i(a.month):a.month;t.push(n)}else if(void 0!==a.quarter){var l=e?p(a.quarter):a.quarter;t.push(l+"*3")}else t.push(0);if(void 0!==a.date)t.push(a.date);else if(void 0!==a.day){var s=e?r(a.day):a.day;t.push(s+"+1")}else t.push(1);for(var c,u=0,d=["hours","minutes","seconds","milliseconds"];u<d.length;u++)c=d[u],void 0===a[c]?t.push(0):t.push(a[c]);return a.utc?"utc("+t.join(", ")+")":"datetime("+t.join(", ")+")"}},{"./log":106,"./util":119}],99:[function(l,e,t){"use strict";function d(a,e){var t=a&&a[e];return!!t&&(o.isArray(t)?o.some(t,function(t){return!!t.field}):p.isFieldDef(t)||p.hasConditionalFieldDef(t))}Object.defineProperty(t,"__esModule",{value:!0});var c=l("./channel"),p=l("./fielddef"),a=l("./log"),o=l("./util");t.channelHasField=d,t.isAggregate=function(a){return o.some(c.CHANNELS,function(e){if(d(a,e)){var t=a[e];if(o.isArray(t))return o.some(t,function(t){return!!t.aggregate});var n=p.getFieldDef(t);return n&&!!n.aggregate}return!1})},t.normalizeEncoding=function(s,e){return o.keys(s).reduce(function(t,n){if(!c.supportMark(n,e))return a.warn(a.message.incompatibleChannel(n,e)),t;if("size"===n&&"line"===e){var i=p.getFieldDef(s[n]);if(i&&i.aggregate)return a.warn(a.message.incompatibleChannel(n,e,"when the field is aggregated.")),t}if("detail"===n||"order"===n)(l=s[n])&&(t[n]=(o.isArray(l)?l:[l]).reduce(function(i,e){return p.isFieldDef(e)?i.push(p.normalizeFieldDef(e,n)):a.warn(a.message.emptyFieldDef(e,n)),i},[]));else{var l=s[n];if(!p.isFieldDef(l)&&!p.isValueDef(l)&&!p.isConditionalDef(l))return a.warn(a.message.emptyFieldDef(l,n)),t;t[n]=p.normalize(l,n)}return t},{})},t.isRanged=function(t){return t&&(!!t.x&&!!t.x2||!!t.y&&!!t.y2)},t.fieldDefs=function(a){var n=[];return c.CHANNELS.forEach(function(e){if(d(a,e)){var t=a[e];(o.isArray(t)?t:[t]).forEach(function(t){p.isFieldDef(t)?n.push(t):p.hasConditionalFieldDef(t)&&n.push(t.condition)})}}),n},t.forEach=function(a,l,t){a&&o.keys(a).forEach(function(n){o.isArray(a[n])?a[n].forEach(function(a){l.call(t,a,n)}):l.call(t,a[n],n)})},t.reduce=function(a,l,e,t){return a?o.keys(a).reduce(function(e,i){return o.isArray(a[i])?a[i].reduce(function(a,e){return l.call(t,a,e,i)},e):l.call(t,e,a[i],i)},e):e}},{"./channel":16,"./fielddef":101,"./log":106,"./util":119}],100:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},{}],101:[function(T,e,t){"use strict";function k(t){return!!t&&!!t.condition&&!v.isArray(t.condition)&&i(t.condition)}function i(t){return t&&(t.field||"count"===t.aggregate)}function n(t){return t&&"value"in t&&void 0!==t.value}function a(t){switch(t.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!t.bin;case"temporal":return!1;}throw new Error(b.message.invalidFieldType(t.type))}function o(t){return!a(t)}function s(t){return"count"===t.aggregate}function l(o,e){var t=o.field,n=o.bin,i=o.timeUnit,l=o.aggregate;return"count"===l?e.countTitle:n?t+" (binned)":i?t+" ("+_.getTimeUnitParts(i).join("-")+")":l?v.titlecase(l)+" of "+t:t}function r(t){var e=t.aggregate||t.timeUnit||t.bin&&"bin";return e?e.toUpperCase()+"("+t.field+")":t.field}function c(t){x=t}function u(a,e){if(a.timeUnit)return"temporal";if(a.bin)return"quantitative";switch(y.rangeType(e)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative";}}function d(l,e){if(l.aggregate&&!f.isAggregateOp(l.aggregate)){l.aggregate;var t=g.__rest(l,["aggregate"]);b.warn(b.message.invalidAggregate(l.aggregate)),l=t}if(l.timeUnit&&(l=g.__assign({},l,{timeUnit:_.normalizeTimeUnit(l.timeUnit)})),l.bin&&(l=g.__assign({},l,{bin:p(l.bin,e)})),l.type){var n=S.getFullName(l.type);l.type!==n&&(l=g.__assign({},l,{type:n})),"quantitative"!==l.type&&f.isCountingAggregateOp(l.aggregate)&&(b.warn(b.message.invalidFieldTypeForCountAggregate(l.type,l.aggregate)),l=g.__assign({},l,{type:"quantitative"}))}else{var d=u(l,e);b.warn(b.message.emptyOrInvalidFieldType(l.type,e,d)),l=g.__assign({},l,{type:d})}var c=m(l,e),a=c.compatible,o=c.warning;return a||b.warn(o),l}function p(a,e){return v.isBoolean(a)?{maxbins:h.autoMaxBins(e)}:a.maxbins||a.step?a:g.__assign({},a,{maxbins:h.autoMaxBins(e)})}function m(n,e){switch(e){case"row":case"column":return o(n)&&!n.timeUnit?{compatible:!1,warning:b.message.facetChannelShouldBeDiscrete(e)}:E;case"x":case"y":case"color":case"text":case"detail":case"tooltip":return E;case"opacity":case"size":case"x2":case"y2":return a(n)&&!n.bin?{compatible:!1,warning:"Channel "+e+" should not be used with discrete field."}:E;case"shape":return"nominal"===n.type?E:{compatible:!1,warning:"Shape channel should be used with nominal data only"};case"order":return"nominal"===n.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:E;}throw new Error("channelCompatability not implemented for channel "+e)}Object.defineProperty(t,"__esModule",{value:!0});var g=T("tslib"),f=T("./aggregate"),h=T("./bin"),y=T("./channel"),b=T("./log"),_=T("./timeunit"),S=T("./type"),v=T("./util");t.isRepeatRef=function(t){return t&&!v.isString(t)&&"repeat"in t},t.isConditionalDef=function(t){return!!t&&!!t.condition},t.hasConditionalFieldDef=k,t.hasConditionalValueDef=function(t){return!!t&&!!t.condition&&(v.isArray(t.condition)||n(t.condition))},t.isFieldDef=i,t.isStringFieldDef=function(t){return i(t)&&v.isString(t.field)},t.isValueDef=n,t.isScaleFieldDef=function(t){return t&&(t.scale||t.sort)},t.field=function(o,e){void 0===e&&(e={});var t=o.field,n=e.prefix,i=e.suffix;if(s(o))t="count_*";else{var l;e.nofn||(o.bin?(l=h.binToString(o.bin),i=e.binSuffix||""):o.aggregate?l=(e.aggregate||o.aggregate)+"":o.timeUnit&&(l=o.timeUnit+"")),l&&(t=l+"_"+t)}return i&&(t=t+"_"+i),n&&(t=n+"_"+t),e.expr&&(t=""+e.expr+v.accessPath(t)),t},t.isDiscrete=a,t.isContinuous=o,t.isCount=s,t.verbalTitleFormatter=l,t.functionalTitleFormatter=r,t.defaultTitleFormatter=function(a,e){switch(e.fieldTitle){case"plain":return a.field;case"functional":return r(a);default:return l(a,e);}};var x=t.defaultTitleFormatter;t.setTitleFormatter=c,t.resetTitleFormatter=function(){c(t.defaultTitleFormatter)},t.title=function(a,e){return x(a,e)},t.defaultType=u,t.getFieldDef=function(t){return i(t)?t:k(t)?t.condition:void 0},t.normalize=function(a,o){if(v.isString(a)||v.isNumber(a)||v.isBoolean(a)){var t=v.isString(a)?"string":v.isNumber(a)?"number":"boolean";return b.warn(b.message.primitiveChannelDef(o,t,a)),{value:a}}return i(a)?d(a,o):k(a)?g.__assign({},a,{condition:d(a.condition,o)}):a},t.normalizeFieldDef=d,t.normalizeBin=p;var E={compatible:!0};t.channelCompatibility=m,t.isNumberFieldDef=function(t){return"quantitative"===t.type||!!t.bin},t.isTimeFieldDef=function(t){return"temporal"===t.type||!!t.timeUnit}},{"./aggregate":13,"./bin":15,"./channel":16,"./log":106,"./timeunit":114,"./type":118,"./util":119,tslib:6}],102:[function(h,e,t){"use strict";function y(t){return t&&t.selection}function _(t){return t&&!!t.field&&void 0!==t.equal}function r(t){return!!(t&&t.field&&u.isArray(t.range)&&2===t.range.length)}function a(t){return t&&!!t.field&&(u.isArray(t.oneOf)||u.isArray(t.in))}function n(t){return a(t)||_(t)||r(t)}function i(c,e){void 0===e&&(e=!0);var t=c.timeUnit?"time("+p.fieldExpr(c.timeUnit,c.field)+")":d.field(c,{expr:"datum"});if(_(c))return t+"==="+o(c.equal,c.timeUnit);if(a(c))return"indexof(["+(c.oneOf||c.in).map(function(e){return o(e,c.timeUnit)}).join(",")+"], "+t+") !== -1";if(r(c)){var n=c.range[0],i=c.range[1];if(null!==n&&null!==i&&e)return"inrange("+t+", ["+o(n,c.timeUnit)+", "+o(i,c.timeUnit)+"])";var s=[];return null!==n&&s.push(t+" >= "+o(n,c.timeUnit)),null!==i&&s.push(t+" <= "+o(i,c.timeUnit)),0<s.length?s.join(" && "):"true"}throw new Error("Invalid field filter: "+JSON.stringify(c))}function o(a,e){if(c.isDateTime(a))return"time("+(n=c.dateTimeExpr(a,!0))+")";if(p.isLocalSingleTimeUnit(e)){var t={};t[e]=a;var n=c.dateTimeExpr(t,!0);return"time("+n+")"}return p.isUtcSingleTimeUnit(e)?o(a,p.getLocalTimeUnit(e)):JSON.stringify(a)}Object.defineProperty(t,"__esModule",{value:!0});var l=h("tslib"),s=h("./compile/selection/selection"),c=h("./datetime"),d=h("./fielddef"),p=h("./timeunit"),u=h("./util");t.isSelectionFilter=y,t.isEqualFilter=_,t.isRangeFilter=r,t.isOneOfFilter=a,t.isFieldFilter=n,t.expression=function(a,e,o){return u.logicalExpr(e,function(e){return u.isString(e)?e:y(e)?s.predicate(a,e.selection,o):i(e)})},t.fieldFilterExpression=i,t.normalizeFilter=function(t){return n(t)&&t.timeUnit?l.__assign({},t,{timeUnit:p.normalizeTimeUnit(t.timeUnit)}):t}},{"./compile/selection/selection":80,"./datetime":98,"./fielddef":101,"./timeunit":114,"./util":119,tslib:6}],103:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VL_ONLY_GUIDE_CONFIG=["shortTimeLabels"]},{}],104:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.axis=a("./axis"),t.aggregate=a("./aggregate"),t.bin=a("./bin"),t.channel=a("./channel"),t.compositeMark=a("./compositemark");var n=a("./compile/compile");t.compile=n.compile,t.config=a("./config"),t.data=a("./data"),t.datetime=a("./datetime"),t.encoding=a("./encoding"),t.facet=a("./facet"),t.fieldDef=a("./fielddef"),t.legend=a("./legend"),t.mark=a("./mark"),t.scale=a("./scale"),t.sort=a("./sort"),t.spec=a("./spec"),t.stack=a("./stack"),t.timeUnit=a("./timeunit"),t.transform=a("./transform"),t.type=a("./type"),t.util=a("./util"),t.validate=a("./validate"),t.version=a("../package.json").version},{"../package.json":12,"./aggregate":13,"./axis":14,"./bin":15,"./channel":16,"./compile/compile":26,"./compositemark":95,"./config":96,"./data":97,"./datetime":98,"./encoding":99,"./facet":100,"./fielddef":101,"./legend":105,"./mark":108,"./scale":109,"./sort":111,"./spec":112,"./stack":113,"./timeunit":114,"./transform":117,"./type":118,"./util":119,"./validate":120}],105:[function(l,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l("tslib"),i=l("./util");t.defaultLegendConfig={};var s={entryPadding:1,format:1,offset:1,orient:1,padding:1,tickCount:1,title:1,type:1,values:1,zindex:1},a=n.__assign({},s,{opacity:1,shape:1,stroke:1,fill:1,size:1,encode:1});t.LEGEND_PROPERTIES=i.flagKeys(s),t.VG_LEGEND_PROPERTIES=i.flagKeys(a)},{"./util":119,tslib:6}],106:[function(l,e,t){"use strict";function n(){return a=r}Object.defineProperty(t,"__esModule",{value:!0});var i=l("vega-util"),r=i.logger(i.Warn),a=r,o=function(){function t(){this.warns=[],this.infos=[],this.debugs=[]}return t.prototype.level=function(){return this},t.prototype.warn=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return(t=this.warns).push.apply(t,a),this;var t},t.prototype.info=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return(t=this.infos).push.apply(t,a),this;var t},t.prototype.debug=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return(t=this.debugs).push.apply(t,a),this;var t},t}();t.LocalLogger=o,t.wrap=function(i){return function(){var e=a=new o;i(e),n()}},t.set=function(t){return a=t},t.reset=n,t.warn=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];a.warn.apply(a,arguments)},t.info=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];a.info.apply(a,arguments)},t.debug=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];a.debug.apply(a,arguments)},!function(t){t.INVALID_SPEC="Invalid spec",t.FIT_NON_SINGLE="Autosize \"fit\" only works for single views and layered views.",t.CANNOT_FIX_RANGE_STEP_WITH_FIT="Cannot use a fixed value of \"rangeStep\" when \"autosize\" is \"fit\".",t.cannotProjectOnChannelWithoutField=function(t){return"Cannot project a selection on encoding channel \""+t+"\", which has no field."},t.nearestNotSupportForContinuous=function(t){return"The \"nearest\" transform is not supported for "+t+" marks."},t.selectionNotFound=function(t){return"Cannot find a selection named \""+t+"\""},t.SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.",t.noSuchRepeatedValue=function(t){return"Unknown repeated value \""+t+"\"."},t.CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated views.",t.REPEAT_CANNOT_SHARE_AXIS="Axes cannot be shared in repeated views.",t.cannotSetTitleAnchor=function(t){return"Cannot set title \"anchor\" for a "+t+" spec"},t.unrecognizedParse=function(t){return"Unrecognized parse \""+t+"\"."},t.differentParse=function(a,e,t){return"An ancestor parsed field \""+a+"\" as "+t+" but a child wants to parse the field as "+e+"."},t.invalidTransformIgnored=function(t){return"Ignoring an invalid transform: "+JSON.stringify(t)+"."},t.NO_FIELDS_NEEDS_AS="If \"from.fields\" is not specified, \"as\" has to be a string that specifies the key to be used for the the data from the secondary source.",t.primitiveChannelDef=function(a,e,t){return"Channel "+a+" is a "+e+". Converted to {value: "+t+"}."},t.invalidFieldType=function(t){return"Invalid field type \""+t+"\""},t.invalidFieldTypeForCountAggregate=function(a,e){return"Invalid field type \""+a+"\" for aggregate: \""+e+"\", using \"quantitative\" instead."},t.invalidAggregate=function(t){return"Invalid aggregation operator \""+t+"\""},t.emptyOrInvalidFieldType=function(a,e,t){return"Invalid field type \""+a+"\" for channel \""+e+"\", using \""+t+"\" instead."},t.emptyFieldDef=function(a,e){return"Dropping "+JSON.stringify(a)+" from channel \""+e+"\" since it does not contain data field or value."},t.incompatibleChannel=function(a,e,t){return a+" dropped as it is incompatible with \""+e+"\""+(t?" when "+t:"")+"."},t.facetChannelShouldBeDiscrete=function(t){return t+" encoding should be discrete (ordinal / nominal / binned)."},t.discreteChannelCannotEncode=function(a,e){return"Using discrete channel \""+a+"\" to encode \""+e+"\" field can be misleading as it does not encode "+("ordinal"===e?"order":"magnitude")+"."},t.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",t.unclearOrientContinuous=function(t){return"Cannot clearly determine orientation for \""+t+"\" since both x and y channel encode continous fields. In this case, we use vertical by default"},t.unclearOrientDiscreteOrEmpty=function(t){return"Cannot clearly determine orientation for \""+t+"\" since both x and y channel encode discrete or empty fields."},t.orientOverridden=function(a,e){return"Specified orient \""+a+"\" overridden with \""+e+"\""},t.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",t.cannotUseScalePropertyWithNonColor=function(t){return"Cannot use the scale property \""+t+"\" with non-color channel."},t.unaggregateDomainHasNoEffectForRawField=function(t){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(t)+")."},t.unaggregateDomainWithNonSharedDomainOp=function(t){return"Unaggregated domain not applicable for \""+t+"\" since it produces values outside the origin domain of the source data."},t.unaggregatedDomainWithLogScale=function(t){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(t)+")."},t.cannotUseSizeFieldWithBandSize=function(t){return"Using size field when "+t+"-channel has a band scale is not supported."},t.cannotApplySizeToNonOrientedMark=function(t){return"Cannot apply size to non-oriented mark \""+t+"\"."},t.rangeStepDropped=function(t){return"rangeStep for \""+t+"\" is dropped as top-level "+("x"===t?"width":"height")+" is provided."},t.scaleTypeNotWorkWithChannel=function(a,e,t){return"Channel \""+a+"\" does not work with \""+e+"\" scale. We are using \""+t+"\" scale instead."},t.scaleTypeNotWorkWithFieldDef=function(a,e){return"FieldDef does not work with \""+a+"\" scale. We are using \""+e+"\" scale instead."},t.scalePropertyNotWorkWithScaleType=function(a,e,t){return t+"-scale's \""+e+"\" is dropped as it does not work with "+a+" scale."},t.scaleTypeNotWorkWithMark=function(a,e){return"Scale type \""+e+"\" does not work with mark \""+a+"\"."},t.mergeConflictingProperty=function(a,e,t,n){return"Conflicting "+e+" property \""+a+"\" (\""+t+"\" and \""+n+"\").  Using \""+t+"\"."},t.independentScaleMeansIndependentGuide=function(t){return"Setting the scale to be independent for \""+t+"\" means we also have to set the guide (axis or legend) to be independent."},t.conflictedDomain=function(t){return"Cannot set "+t+"-scale's \"domain\" as it is binned. Please use \"bin\"'s \"extent\" instead."},t.domainSortDropped=function(t){return"Dropping sort property \""+JSON.stringify(t)+"\" as unioned domains only support boolean or op 'count'."},t.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",t.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",t.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",t.cannotStackRangedMark=function(t){return"Cannot stack \""+t+"\" if there is already \""+t+"2\""},t.cannotStackNonLinearScale=function(t){return"Cannot stack non-linear scale ("+t+")"},t.stackNonSummativeAggregate=function(t){return"Stacking is applied even though the aggregate function is non-summative (\""+t+"\")"},t.invalidTimeUnit=function(a,e){return"Invalid "+a+": \""+e+"\""},t.dayReplacedWithDate=function(t){return"Time unit \""+t+"\" is not supported. We are replacing it with "+t.replace("day","date")+"."},t.droppedDay=function(t){return"Dropping day from datetime "+JSON.stringify(t)+" as day cannot be combined with other units."}}(t.message||(t.message={}))},{"vega-util":11}],107:[function(l,e,t){"use strict";function d(t){return!!t.or}function i(t){return!!t.and}function r(t){return!!t.not}function a(o,e){if(r(o))a(o.not,e);else if(i(o))for(var t=0,n=o.and;t<n.length;t++)a(s=n[t],e);else if(d(o))for(var s,c=0,l=o.or;c<l.length;c++)s=l[c],a(s,e);else e(o)}function n(a,o){return r(a)?{not:n(a.not,o)}:i(a)?{and:a.and.map(function(t){return n(t,o)})}:d(a)?{or:a.or.map(function(t){return n(t,o)})}:o(a)}Object.defineProperty(t,"__esModule",{value:!0}),t.isLogicalOr=d,t.isLogicalAnd=i,t.isLogicalNot=r,t.forEachLeave=a,t.normalizeLogicalOperand=n},{}],108:[function(l,e,t){"use strict";function n(t){return t.type}Object.defineProperty(t,"__esModule",{value:!0});var i,r=l("./util");!function(t){t.AREA="area",t.BAR="bar",t.LINE="line",t.POINT="point",t.RECT="rect",t.RULE="rule",t.TEXT="text",t.TICK="tick",t.CIRCLE="circle",t.SQUARE="square"}(i=t.Mark||(t.Mark={})),t.AREA=i.AREA,t.BAR=i.BAR,t.LINE=i.LINE,t.POINT=i.POINT,t.TEXT=i.TEXT,t.TICK=i.TICK,t.RECT=i.RECT,t.RULE=i.RULE,t.CIRCLE=i.CIRCLE,t.SQUARE=i.SQUARE;var a={area:1,bar:1,line:1,point:1,text:1,tick:1,rect:1,rule:1,circle:1,square:1};t.isMark=function(t){return!!a[t]},t.PRIMITIVE_MARKS=r.flagKeys(a),t.isMarkDef=n;var o=r.toSet(t.PRIMITIVE_MARKS);t.isPrimitiveMark=function(t){return(n(t)?t.type:t)in o},t.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],t.FILL_CONFIG=["fill","fillOpacity"],t.FILL_STROKE_CONFIG=[].concat(t.STROKE_CONFIG,t.FILL_CONFIG),t.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],t.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={bar:["binSpacing","continuousBandSize","discreteBandSize"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},t.defaultMarkConfig={color:"#4c78a8"},t.defaultBarConfig={binSpacing:1,continuousBandSize:5},t.defaultTickConfig={thickness:1}},{"./util":119}],109:[function(y,e,t){"use strict";function n(t){return t in f}function i(t){return t in c}Object.defineProperty(t,"__esModule",{value:!0});var r=y("tslib"),a=y("./channel"),o=y("./log"),s=y("./util");!function(t){t.LINEAR="linear",t.BIN_LINEAR="bin-linear",t.LOG="log",t.POW="pow",t.SQRT="sqrt",t.TIME="time",t.UTC="utc",t.SEQUENTIAL="sequential",t.QUANTILE="quantile",t.QUANTIZE="quantize",t.THRESHOLD="threshold",t.ORDINAL="ordinal",t.BIN_ORDINAL="bin-ordinal",t.POINT="point",t.BAND="band"}(t.ScaleType||(t.ScaleType={}));var l={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};t.SCALE_TYPES=s.keys(l),t.scaleCompatible=function(a,e){var t=l[a],n=l[e];return t===n||"ordinal-position"===t&&"time"===n||"ordinal-position"===n&&"time"===t};var u={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};t.scaleTypePrecedence=function(t){return u[t]},t.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var c=s.toSet(t.CONTINUOUS_TO_CONTINUOUS_SCALES);t.CONTINUOUS_DOMAIN_SCALES=t.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var f=s.toSet(t.CONTINUOUS_DOMAIN_SCALES);t.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var d=s.toSet(t.DISCRETE_DOMAIN_SCALES),p=s.toSet(["bin-linear","bin-ordinal"]);t.TIME_SCALE_TYPES=["time","utc"],t.hasDiscreteDomain=function(t){return t in d},t.isBinScale=function(t){return t in p},t.hasContinuousDomain=n,t.isContinuousToContinuous=i,t.defaultScaleConfig={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4},t.isExtendedScheme=function(t){return t&&!!t.name},t.isSelectionDomain=function(t){return t&&t.selection};var m={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};t.SCALE_PROPERTIES=s.flagKeys(m);var g=r.__rest(m,["type","domain","range","rangeStep","scheme"]);t.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=s.flagKeys(g),t.scaleTypeSupportProperty=function(a,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return s.contains(["sequential","ordinal","bin-ordinal","quantile","quantize"],a);case"interpolate":return s.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],a);case"round":return i(a)||"band"===a||"point"===a;case"padding":return i(a)||s.contains(["point","band"],a);case"paddingOuter":case"rangeStep":return s.contains(["point","band"],a);case"paddingInner":return"band"===a;case"clamp":return i(a)||"sequential"===a;case"nice":return i(a)||"sequential"===a||"quantize"===a;case"exponent":return"pow"===a;case"base":return"log"===a;case"zero":return n(a)&&!s.contains(["log","time","utc","bin-linear","threshold","quantile"],a);}throw new Error("Invalid scale property "+e+".")},t.channelScalePropertyIncompatability=function(a,e){switch(e){case"interpolate":case"scheme":return"color"===a?void 0:o.message.cannotUseScalePropertyWithNonColor(a);case"type":case"domain":case"range":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return;}throw new Error("Invalid scale property \""+e+"\".")},t.channelSupportScaleType=function(n,e){return n===a.Channel.X||n===a.Channel.Y||n===a.Channel.SIZE||n===a.Channel.OPACITY?i(e)||s.contains(["band","point"],e):n===a.Channel.COLOR?"band"!==e:!(n!==a.Channel.SHAPE)&&"ordinal"===e}},{"./channel":16,"./log":106,"./util":119,tslib:6}],110:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SELECTION_ID="_vgsid_",t.defaultConfig={single:{on:"click",fields:[t.SELECTION_ID],resolve:"global",empty:"all"},multi:{on:"click",fields:[t.SELECTION_ID],toggle:"event.shiftKey",resolve:"global",empty:"all"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}}},{}],111:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSortField=function(t){return t&&("count"===t.op||t.field)&&t.op}},{}],112:[function(P,e,t){"use strict";function M(t){return void 0!==t.facet}function i(t){return!!t.mark}function r(t){return void 0!==t.layer}function a(t){return void 0!==t.repeat}function n(t){return o(t)||l(t)}function o(t){return void 0!==t.vconcat}function l(t){return void 0!==t.hconcat}function s(f,e){if(M(f))return c(f,e);if(r(f))return u(f,e);if(a(f))return d(f,e);if(o(f))return p(f,e);if(l(f))return m(f,e);if(i(f)){var t=N.channelHasField(f.encoding,x.ROW),n=N.channelHasField(f.encoding,x.COLUMN);return t||n?g(f,e):h(f,e)}throw new Error(T.message.INVALID_SPEC)}function c(a,e){var t=a.spec,n=v.__rest(a,["spec"]);return v.__assign({},n,{spec:s(t,e)})}function u(a,o){var e=a.layer,t=v.__rest(a,["layer"]);return v.__assign({},t,{layer:e.map(function(t){return r(t)?u(t,o):h(t,o)})})}function d(a,e){var t=a.spec,n=v.__rest(a,["spec"]);return v.__assign({},n,{spec:s(t,e)})}function p(a,o){var e=a.vconcat,t=v.__rest(a,["vconcat"]);return v.__assign({},t,{vconcat:e.map(function(t){return s(t,o)})})}function m(a,o){var e=a.hconcat,t=v.__rest(a,["hconcat"]);return v.__assign({},t,{hconcat:e.map(function(t){return s(t,o)})})}function g(d,e){var t=d.encoding,n=t.row,p=t.column,m=v.__rest(t,["row","column"]),g=d.mark,f=d.width,y=d.height,_=d.selection,b=(d.encoding,v.__rest(d,["mark","width","height","selection","encoding"]));return v.__assign({},b,{facet:v.__assign({},n?{row:n}:{},p?{column:p}:{}),spec:h(v.__assign({mark:g},f?{width:f}:{},y?{height:y}:{},{encoding:m},_?{selection:_}:{}),e)})}function f(t){return k.isPrimitiveMark(t.mark)}function h(a,e){if(f(a)){if(N.isRanged(a.encoding))return y(a);var t=e&&e.overlay,n=t&&a.mark===k.AREA&&C.contains(["linepoint","line"],t.area),i=t&&(t.line&&a.mark===k.LINE||"linepoint"===t.area&&a.mark===k.AREA);return i||n?b(a,i,n,e):a}return E.normalize(a,e)}function y(o){var e=N.channelHasField(o.encoding,x.X),l=N.channelHasField(o.encoding,x.Y),s=N.channelHasField(o.encoding,x.X2),i=N.channelHasField(o.encoding,x.Y2);if(s&&!e||i&&!l){var r=C.duplicate(o);return s&&!e&&(r.encoding.x=r.encoding.x2,delete r.encoding.x2),i&&!l&&(r.encoding.y=r.encoding.y2,delete r.encoding.y2),r}return o}function b(m,e,t,n){var i=m.mark,g=m.selection,h=m.encoding,y=v.__rest(m,["mark","selection","encoding"]),s=[{mark:i,encoding:h}],_=D.stack(i,h,n?n.stack:void 0),u=h;if(_){var b=_.fieldChannel,f=_.offset;u=v.__assign({},h,(S={},S[b]=v.__assign({},h[b],f?{stack:f}:{}),S))}return t&&s.push(v.__assign({mark:{type:"line",style:"lineOverlay"}},g?{selection:g}:{},{encoding:u})),e&&s.push(v.__assign({mark:{type:"point",filled:!0,style:"pointOverlay"}},g?{selection:g}:{},{encoding:u})),v.__assign({},y,{layer:s});var S}function _(a,e){return e.forEach(function(o){var e=["field","type","value","timeUnit","bin","aggregate"].reduce(function(t,e){return void 0!==o[e]&&(t[e]=o[e]),t},{}),t=C.hash(e);a[t]=a[t]||o}),a}function S(l,s){return void 0===s&&(s={}),r(l)?l.layer.forEach(function(t){i(t)?_(s,O.fieldDefs(t.encoding)):S(t,s)}):M(l)?(_(s,O.fieldDefs(l.facet)),S(l.spec,s)):a(l)?S(l.spec,s):n(l)?(o(l)?l.vconcat:l.hconcat).forEach(function(t){return S(t,s)}):_(s,O.fieldDefs(l.encoding)),s}Object.defineProperty(t,"__esModule",{value:!0});var v=P("tslib"),x=P("./channel"),E=P("./compositemark"),N=P("./encoding"),O=P("./encoding"),T=P("./log"),k=P("./mark"),D=P("./stack"),C=P("./util");t.isFacetSpec=M,t.isUnitSpec=i,t.isLayerSpec=r,t.isRepeatSpec=a,t.isConcatSpec=n,t.isVConcatSpec=o,t.isHConcatSpec=l,t.normalize=s,t.fieldDefs=function(t){return C.vals(S(t))},t.isStacked=function(a,e){return e=e||a.config,!!k.isPrimitiveMark(a.mark)&&null!==D.stack(a.mark,a.encoding,e?e.stack:void 0)}},{"./channel":16,"./compositemark":95,"./encoding":99,"./log":106,"./mark":108,"./stack":113,"./util":119,tslib:6}],113:[function(m,e,E){"use strict";function n(a){return!!t[a]}function i(a){var e=a.x,t=a.y;if(!(s.isFieldDef(e)&&s.isFieldDef(t))){if(s.isFieldDef(e)&&"quantitative"===e.type)return"x";if(s.isFieldDef(t)&&"quantitative"===t.type)return"y"}else if("quantitative"===e.type&&"quantitative"===t.type){if(e.stack)return"x";if(t.stack)return"y";if(!!e.aggregate!=!!t.aggregate)return e.aggregate?"x":"y"}else{if("quantitative"===e.type)return"x";if("quantitative"===t.type)return"y"}}Object.defineProperty(E,"__esModule",{value:!0});var r=m("./aggregate"),a=m("./channel"),o=m("./encoding"),s=m("./fielddef"),l=m("./log"),u=m("./mark"),c=m("./scale"),f=m("./util"),t={zero:1,center:1,normalize:1};E.isStackOffset=n,E.STACKABLE_MARKS=[u.BAR,u.AREA,u.RULE,u.POINT,u.CIRCLE,u.SQUARE,u.LINE,u.TEXT,u.TICK],E.STACK_BY_DEFAULT_MARKS=[u.BAR,u.AREA],E.stack=function(d,N,e){var t=u.isMarkDef(d)?d.type:d;if(!f.contains(E.STACKABLE_MARKS,t))return null;var p=i(N);if(!p)return null;var m=N[p],h=s.isStringFieldDef(m)?s.field(m,{}):void 0,v="x"===p?"y":"x",y=N[v],b=s.isStringFieldDef(y)?s.field(y,{}):void 0,_=a.NONPOSITION_CHANNELS.reduce(function(t,e){if(o.channelHasField(N,e)){var a=N[e];(f.isArray(a)?a:[a]).forEach(function(a){var o=s.getFieldDef(a);if(!o.aggregate){var l=s.isStringFieldDef(o)?s.field(o,{}):void 0;l&&(l===b||l===h)||t.push({channel:e,fieldDef:o})}})}return t},[]);if(0===_.length)return null;var T;return(T=void 0===m.stack?f.contains(E.STACK_BY_DEFAULT_MARKS,t)&&void 0===e?"zero":e:m.stack)&&n(T)?m.scale&&m.scale.type&&m.scale.type!==c.ScaleType.LINEAR?(l.warn(l.message.cannotStackNonLinearScale(m.scale.type)),null):o.channelHasField(N,p===a.X?a.X2:a.Y2)?(l.warn(l.message.cannotStackRangedMark(p)),null):(m.aggregate&&!f.contains(r.SUM_OPS,m.aggregate)&&l.warn(l.message.stackNonSummativeAggregate(m.aggregate)),{groupbyChannel:y?v:void 0,fieldChannel:p,impute:f.contains(["area","line"],t),stackBy:_,offset:T}):null}},{"./aggregate":13,"./channel":16,"./encoding":99,"./fielddef":101,"./log":106,"./mark":108,"./scale":109,"./util":119}],114:[function(y,e,_){"use strict";function n(t){return!!c[t]}function b(a,e){var t=u[a];return{setDateMethod:e?"setUTC"+t.substr(3):t,getDateMethod:"get"+(e?"UTC":"")+t.substr(3)}}function S(i,e){var t=i.indexOf(e);return-1<t&&(e!==a.SECONDS||0===t||"i"!==i.charAt(t-1))}Object.defineProperty(_,"__esModule",{value:!0});var a,t=y("tslib"),i=y("./datetime"),o=y("./log"),l=y("./util");!function(t){t.YEAR="year",t.MONTH="month",t.DAY="day",t.DATE="date",t.HOURS="hours",t.MINUTES="minutes",t.SECONDS="seconds",t.MILLISECONDS="milliseconds",t.YEARMONTH="yearmonth",t.YEARMONTHDATE="yearmonthdate",t.YEARMONTHDATEHOURS="yearmonthdatehours",t.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",t.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",t.MONTHDATE="monthdate",t.HOURSMINUTES="hoursminutes",t.HOURSMINUTESSECONDS="hoursminutesseconds",t.MINUTESSECONDS="minutesseconds",t.SECONDSMILLISECONDS="secondsmilliseconds",t.QUARTER="quarter",t.YEARQUARTER="yearquarter",t.QUARTERMONTH="quartermonth",t.YEARQUARTERMONTH="yearquartermonth",t.UTCYEAR="utcyear",t.UTCMONTH="utcmonth",t.UTCDAY="utcday",t.UTCDATE="utcdate",t.UTCHOURS="utchours",t.UTCMINUTES="utcminutes",t.UTCSECONDS="utcseconds",t.UTCMILLISECONDS="utcmilliseconds",t.UTCYEARMONTH="utcyearmonth",t.UTCYEARMONTHDATE="utcyearmonthdate",t.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",t.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",t.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",t.UTCMONTHDATE="utcmonthdate",t.UTCHOURSMINUTES="utchoursminutes",t.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",t.UTCMINUTESSECONDS="utcminutesseconds",t.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",t.UTCQUARTER="utcquarter",t.UTCYEARQUARTER="utcyearquarter",t.UTCQUARTERMONTH="utcquartermonth",t.UTCYEARQUARTERMONTH="utcyearquartermonth"}(a=_.TimeUnit||(_.TimeUnit={}));var s={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};_.TIMEUNIT_PARTS=l.flagKeys(s),_.isLocalSingleTimeUnit=function(t){return!!s[t]};var r={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};_.isUtcSingleTimeUnit=function(t){return!!r[t]};var d={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},c=t.__assign({},r,d);_.isUTCTimeUnit=n,_.getLocalTimeUnit=function(t){return t.substr(3)};var p=t.__assign({},s,r,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},d);_.TIMEUNITS=l.flagKeys(p),_.isTimeUnit=function(t){return!!p[t]};var u={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};_.convert=function(o,e){var t=n(o),s=t?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0);return _.TIMEUNIT_PARTS.forEach(function(l){if(S(o,l))switch(l){case a.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case a.QUARTER:var n=b("month",t),i=n.getDateMethod,r=n.setDateMethod;s[r](3*Math.floor(e[i]()/3));break;default:var c=b(l,t),u=c.getDateMethod,d=c.setDateMethod;s[d](e[u]());}}),s},_.getTimeUnitParts=function(a){return _.TIMEUNIT_PARTS.reduce(function(e,t){return S(a,t)?e.concat(t):e},[])},_.containsTimeUnit=S,_.fieldExpr=function(o,e){function d(n){return n===a.QUARTER?"("+s+"quarter("+t+")-1)":""+s+n+"("+t+")"}var t="datum"+l.accessPath(e),s=n(o)?"utc":"",r=_.TIMEUNIT_PARTS.reduce(function(e,t){return S(o,t)&&(e[t]=d(t)),e},{});return i.dateTimeExpr(r)},_.formatExpression=function(o,e,t,n){if(o){var i=[],r="",s=S(o,a.YEAR);S(o,a.QUARTER)&&(r="'Q' + quarter("+e+")"),S(o,a.MONTH)&&i.push(!1===t?"%B":"%b"),S(o,a.DAY)?i.push(t?"%a":"%A"):S(o,a.DATE)&&i.push("%d"+(s?",":"")),s&&i.push(t?"%y":"%Y");var l=[];S(o,a.HOURS)&&l.push("%H"),S(o,a.MINUTES)&&l.push("%M"),S(o,a.SECONDS)&&l.push("%S"),S(o,a.MILLISECONDS)&&l.push("%L");var d=[];return 0<i.length&&d.push(i.join(" ")),0<l.length&&d.push(l.join(":")),0<d.length&&(r&&(r+=" + ' ' + "),r+=n?"utcFormat("+e+", '"+d.join(" ")+"')":"timeFormat("+e+", '"+d.join(" ")+"')"),r||void 0}},_.normalizeTimeUnit=function(t){return"day"!==t&&0<=t.indexOf("day")?(o.warn(o.message.dayReplacedWithDate(t)),t.replace("day","date")):t}},{"./datetime":98,"./log":106,"./util":119,tslib:6}],115:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("tslib");t.extractTitleConfig=function(i){var e=i.anchor,s=i.offset,d=i.orient,c=i.color,p=l.__rest(i,["anchor","offset","orient","color"]);return{mark:l.__assign({},p,c?{fill:c}:{}),nonMark:l.__assign({},e?{anchor:e}:{},s?{offset:s}:{},d?{orient:d}:{})}}},{tslib:6}],116:[function(l,e,t){"use strict";function d(t){return n.isString(t)?{type:t}:t||{}}Object.defineProperty(t,"__esModule",{value:!0});var i=l("tslib"),n=l("util"),r=l("./log");t.normalizeAutoSize=function(o,e,t){void 0===t&&(t=!0);var n=i.__assign({type:"pad"},d(e),d(o));return"fit"===n.type&&(t||(r.warn(r.message.FIT_NON_SINGLE),n.type="pad")),n};var a=["background","padding"];t.extractTopLevelProperties=function(i){return a.reduce(function(e,t){return i&&void 0!==i[t]&&(e[t]=i[t]),e},{})}},{"./log":106,tslib:6,util:9}],117:[function(o,e,t){"use strict";function n(t){return void 0!==t.filter}Object.defineProperty(t,"__esModule",{value:!0});var i=o("./filter"),l=o("./logical");t.isFilter=n,t.isLookup=function(t){return void 0!==t.lookup},t.isCalculate=function(t){return void 0!==t.calculate},t.isBin=function(t){return!!t.bin},t.isTimeUnit=function(t){return void 0!==t.timeUnit},t.isAggregate=function(t){return void 0!==t.aggregate},t.normalizeTransform=function(t){return t.map(function(t){return n(t)?{filter:l.normalizeLogicalOperand(t.filter,i.normalizeFilter)}:t})}},{"./filter":102,"./logical":107}],118:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(t){t.QUANTITATIVE="quantitative",t.ORDINAL="ordinal",t.TEMPORAL="temporal",t.NOMINAL="nominal"}(n=t.Type||(t.Type={}));var i={quantitative:1,ordinal:1,temporal:1,nominal:1};t.isType=function(t){return!!i[t]},t.QUANTITATIVE=n.QUANTITATIVE,t.ORDINAL=n.ORDINAL,t.TEMPORAL=n.TEMPORAL,t.NOMINAL=n.NOMINAL,t.getFullName=function(a){if(a)switch(a=a.toLowerCase()){case"q":case t.QUANTITATIVE:return"quantitative";case"t":case t.TEMPORAL:return"temporal";case"o":case t.ORDINAL:return"ordinal";case"n":case t.NOMINAL:return"nominal";}}},{}],119:[function(m,e,g){"use strict";function n(a,e){return-1<a.indexOf(e)}function i(a,i){return a.filter(function(t){return!n(i,t)})}function r(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var n=0,i=e;n<i.length;n++)o=a(o,i[n]);return o}function a(a,e){if("object"!=typeof e||null===e)return a;for(var i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&("object"!=typeof e[i]||c.isArray(e[i])||null===e[i]?a[i]=e[i]:"object"!=typeof a[i]||null===a[i]?a[i]=r(c.isArray(e[i].constructor)?[]:{},e[i]):r(a[i],e[i]));return a}function o(t){return JSON.parse(JSON.stringify(t))}function s(t){return!0===t||!1===t}function l(a,n){return f.isLogicalNot(a)?"!("+l(a.not,n)+")":f.isLogicalAnd(a)?"("+a.and.map(function(t){return l(t,n)}).join(") && (")+")":f.isLogicalOr(a)?"("+a.or.map(function(t){return l(t,n)}).join(") || (")+")":n(a)}Object.defineProperty(g,"__esModule",{value:!0});var u=m("json-stable-stringify"),c=m("vega-util"),f=m("./logical"),t=m("vega-util");g.isArray=t.isArray,g.isObject=t.isObject,g.isNumber=t.isNumber,g.isString=t.isString,g.truncate=t.truncate,g.toSet=t.toSet,g.stringValue=t.stringValue,g.splitAccessPath=t.splitAccessPath,g.pick=function(a,e){var i={};return e.forEach(function(e){a.hasOwnProperty(e)&&(i[e]=a[e])}),i},g.omit=function(a,e){var t=o(a);return e.forEach(function(a){delete t[a]}),t},g.hash=function(a){if(c.isString(a)||c.isNumber(a)||s(a))return a+"";var e=u(a);if(100>e.length)return e;for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t},g.contains=n,g.without=i,g.union=function(a,e){return a.concat(i(e,a))},g.some=function(a,e){for(var t=0,n=0;n<a.length;n++)if(e(a[n],n,t++))return!0;return!1},g.every=function(a,e){for(var t=0,n=0;n<a.length;n++)if(!e(a[n],n,t++))return!1;return!0},g.flatten=function(t){return[].concat.apply([],t)},g.mergeDeep=r,g.unique=function(l,e){for(var t,n,s=[],i={},r=0,a=l;r<a.length;r++)n=a[r],(t=e(n))in i||(i[t]=1,s.push(n));return s},g.differ=function(a,e){for(var t in a)if(a.hasOwnProperty(t)&&e[t]&&a[t]&&e[t]!==a[t])return!0;return!1},g.hasIntersection=function(a,e){for(var t in a)if(t in e)return!0;return!1},g.isNumeric=function(t){return!isNaN(t)},g.differArray=function(a,e){if(a.length!==e.length)return!0;a.sort(),e.sort();for(var t=0;t<a.length;t++)if(e[t]!==a[t])return!0;return!1},g.keys=Object.keys,g.vals=function(a){var e=[];for(var t in a)a.hasOwnProperty(t)&&e.push(a[t]);return e},g.flagKeys=function(t){return g.keys(t)},g.duplicate=o,g.isBoolean=s,g.varName=function(a){var e=a.replace(/\W/g,"_");return(a.match(/^\d+/)?"_":"")+e},g.logicalExpr=l,g.deleteNestedProperty=function(n,e){for(var t=!0;0<e.length&&t;){for(var i=n,o=0;o<e.length-1;o++)i=i[e[o]];delete i[e.pop()],0!==g.keys(i).length&&(t=!1)}},g.titlecase=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},g.accessPath=function(t){return"["+c.splitAccessPath(t).map(c.stringValue).join("][")+"]"}},{"./logical":107,"json-stable-stringify":1,"vega-util":11}],120:[function(o,e,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});var n=o("./mark"),i=o("./mark"),t=o("./util");d.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},d.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:t.toSet(["row","column","x","y","size","color","detail"]),line:t.toSet(["row","column","x","y","color","detail"]),area:t.toSet(["row","column","x","y","color","detail"]),tick:t.toSet(["row","column","x","y","color","detail"]),circle:t.toSet(["row","column","x","y","color","size","detail"]),square:t.toSet(["row","column","x","y","color","size","detail"]),point:t.toSet(["row","column","x","y","color","size","detail","shape"]),text:t.toSet(["row","column","size","color","text"])},d.getEncodingMappingError=function(r,e,t){void 0===e&&(e=d.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===t&&(t=d.DEFAULT_SUPPORTED_CHANNEL_TYPE);var a=n.isMarkDef(r.mark)?r.mark.type:r.mark,o=r.encoding,s=e[a],l=t[a];for(var p in s)if(!(s[p]in o))return"Missing encoding channel \""+s[p]+"\" for mark \""+a+"\"";for(var c in o)if(!l[c])return"Encoding channel \""+c+"\" is not supported by mark type \""+a+"\"";return a!==i.BAR||o.x||o.y?null:"Missing both x and y for bar"}},{"./mark":108,"./util":119}],121:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("./util");t.isVgSignalRef=function(t){return!!t.signal},t.isVgRangeStep=function(t){return!!t.step},t.isDataRefUnionedDomain=function(t){return!n.isArray(t)&&"fields"in t&&!("data"in t)},t.isFieldRefUnionDomain=function(t){return!n.isArray(t)&&"fields"in t&&"data"in t},t.isDataRefDomain=function(t){return!n.isArray(t)&&"field"in t&&"data"in t},t.isSignalRefDomain=function(t){return!n.isArray(t)&&"signal"in t},t.VG_MARK_CONFIGS=n.flagKeys({opacity:1,fill:1,fillOpacity:1,stroke:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,limit:1,dx:1,dy:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1})},{"./util":119}]},{},[104])(104)});